2016-08-10 07:37:17  threadproc_votes
2016-08-10 07:37:17  started creating Lucene index using folder C:\btnet364\www\App_Data\lucene_index
2016-08-10 07:37:17  sql=

if exists (select * from dbo.sysobjects where id = object_id(N'[votes_view]'))
drop view [votes_view]
2016-08-10 07:37:18  sql=

/* get searchable cols */					
select sc.name
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
and st.[name] in ('nvarchar','varchar')
and sc.length > 30
2016-08-10 07:37:21  sql=

create view votes_view as
select bu_bug as vote_bug, sum(bu_vote) as vote_total
from bug_user
group by bu_bug
having sum(bu_vote) > 0
2016-08-10 07:37:21  elapsed milliseconds:2075
2016-08-10 07:37:21  sql=

select bg_id, 	

isnull(bg_tags,'') bg_tags,
bg_short_desc
from bugs
2016-08-10 07:37:21  sql=

select bu_bug, count(1)
from bug_user 
where bu_vote = 1
group by bu_bug
2016-08-10 07:37:21  elapsed milliseconds:0056
2016-08-10 07:37:21  elapsed milliseconds:0102
2016-08-10 07:37:21  sql=

select bp_bug, bp_id, 
isnull(bp_comment_search,bp_comment) [text] 
from bug_posts 
where bp_type <> 'update'
and bp_hidden_from_external_users = 0
2016-08-10 07:37:21  elapsed milliseconds:0060
2016-08-10 07:37:21  done creating Lucene index
2016-08-10 07:37:22 http://192.168.6.173/Default.aspx sql=
select count(1) from users
2016-08-10 07:39:01 http://192.168.6.173/Default.aspx sql=
select count(1) from users
2016-08-10 07:39:01 http://192.168.6.173/Default.aspx sql=

select us_username, us_id, us_password, isnull(us_salt,0) us_salt, us_active
from users
where us_username = N'admin'
2016-08-10 07:39:01 http://192.168.6.173/Default.aspx elapsed milliseconds:0037
2016-08-10 07:39:01 http://192.168.6.173/Default.aspx sql=
update users set us_most_recent_login_datetime = getdate() where us_id = 1
2016-08-10 07:39:01 http://192.168.6.173/Default.aspx sql=
select us_id from users where us_username = N'admin'
2016-08-10 07:39:01 http://192.168.6.173/Default.aspx elapsed milliseconds:0001
2016-08-10 07:39:01 http://192.168.6.173/Default.aspx guid=b9972486-9a4c-4cf3-ab5d-20809193b8a2
2016-08-10 07:39:01 http://192.168.6.173/Default.aspx sql=
insert into sessions (se_id, se_user) values('b9972486-9a4c-4cf3-ab5d-20809193b8a2', 1)
2016-08-10 07:39:01 http://192.168.6.173/Default.aspx AppPath:
2016-08-10 07:39:01 http://192.168.6.173/bugs.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 07:39:01 http://192.168.6.173/bugs.aspx elapsed milliseconds:0113
2016-08-10 07:39:01 http://192.168.6.173/bugs.aspx sql=

/* custom columns */ select sc.name, st.[name] [datatype], 
case when st.[name] = 'nvarchar' or st.[name] = 'nchar' then sc.length/2 else sc.length end as [length], 
sc.xprec, sc.xscale, sc.isnullable,
mm.text [default value], 
dflts.name [default name], 
isnull(ccm_dropdown_type,'') [dropdown type],
isnull(ccm_dropdown_vals,'') [vals],
isnull(ccm_sort_seq, sc.colorder) [column order],
sc.colorder
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
left outer join syscomments mm on sc.cdefault = mm.id
left outer join custom_col_metadata on ccm_colorder = sc.colorder
left outer join sysobjects dflts on dflts.id = mm.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
order by sc.id, isnull(ccm_sort_seq,sc.colorder)
2016-08-10 07:39:02 http://192.168.6.173/bugs.aspx elapsed milliseconds:0396
2016-08-10 07:39:02 http://192.168.6.173/bugs.aspx sql=
/* query dropdown */
select qu_id, qu_desc
from queries
where (isnull(qu_user,0) = 0 and isnull(qu_org,0) = 0)
or isnull(qu_user,0) = 1
or isnull(qu_org,0) = 6
order by qu_desc
2016-08-10 07:39:02 http://192.168.6.173/bugs.aspx elapsed milliseconds:0002
2016-08-10 07:39:02 http://192.168.6.173/bugs.aspx sql=
select qu_id, qu_sql from queries where qu_id in
			(select us_default_query from users where us_id = 1)
2016-08-10 07:39:02 http://192.168.6.173/bugs.aspx elapsed milliseconds:0013
2016-08-10 07:39:02 http://192.168.6.173/bugs.aspx sql=
select isnull(pr_background_color,'#ffffff'), bg_id [id], isnull(bu_flag,0) [$FLAG], 
 bg_short_desc [desc], isnull(pj_name,'') [project], isnull(og_name,'') [organization], isnull(ct_name,'') [category], rpt.us_username [reported by],
 bg_reported_date [reported on], isnull(pr_name,'') [priority], isnull(asg.us_username,'') [assigned to],
 isnull(st_name,'') [status], isnull(lu.us_username,'') [last updated by], bg_last_updated_date [last updated on]
 from bugs 
 left outer join bug_user on bu_bug = bg_id and bu_user = 1 
 left outer join users rpt on rpt.us_id = bg_reported_user
 left outer join users asg on asg.us_id = bg_assigned_to_user
 left outer join users lu on lu.us_id = bg_last_updated_user
 left outer join projects on pj_id = bg_project
 left outer join orgs on og_id = bg_org
 left outer join categories on ct_id = bg_category
 left outer join priorities on pr_id = bg_priority
 left outer join statuses on st_id = bg_status
  /* altered - just order by  */ WHERE  (bugs.bg_project not in (
					select pu_project
					from project_user_xref
					where pu_user = 1
					and pu_permission_level = 0)) order by bg_id desc
2016-08-10 07:39:02 http://192.168.6.173/bugs.aspx elapsed milliseconds:0020
2016-08-10 07:39:10 http://192.168.6.173/bugs.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 07:39:10 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 07:39:10 http://192.168.6.173/bugs.aspx sql=
/* query dropdown */
select qu_id, qu_desc
from queries
where (isnull(qu_user,0) = 0 and isnull(qu_org,0) = 0)
or isnull(qu_user,0) = 1
or isnull(qu_org,0) = 6
order by qu_desc
2016-08-10 07:39:10 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 07:39:10 http://192.168.6.173/bugs.aspx sql=
select qu_sql from queries where qu_id = 1
2016-08-10 07:39:10 http://192.168.6.173/bugs.aspx sql=
select isnull(pr_background_color,'#ffffff'), bg_id [id], isnull(bu_flag,0) [$FLAG], 
 bg_short_desc [desc], isnull(pj_name,'') [project], isnull(og_name,'') [organization], isnull(ct_name,'') [category], rpt.us_username [reported by],
 bg_reported_date [reported on], isnull(pr_name,'') [priority], isnull(asg.us_username,'') [assigned to],
 isnull(st_name,'') [status], isnull(lu.us_username,'') [last updated by], bg_last_updated_date [last updated on]
 from bugs 
 left outer join bug_user on bu_bug = bg_id and bu_user = 1 
 left outer join users rpt on rpt.us_id = bg_reported_user
 left outer join users asg on asg.us_id = bg_assigned_to_user
 left outer join users lu on lu.us_id = bg_last_updated_user
 left outer join projects on pj_id = bg_project
 left outer join orgs on og_id = bg_org
 left outer join categories on ct_id = bg_category
 left outer join priorities on pr_id = bg_priority
 left outer join statuses on st_id = bg_status
  /* altered - just order by  */ WHERE  (bugs.bg_project not in (
					select pu_project
					from project_user_xref
					where pu_user = 1
					and pu_permission_level = 0)) order by bg_id desc
2016-08-10 07:39:10 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 07:39:11 http://192.168.6.173/edit_bug.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 07:39:11 http://192.168.6.173/edit_bug.aspx elapsed milliseconds:0000
2016-08-10 07:39:11 http://192.168.6.173/edit_bug.aspx sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 07:39:12 http://192.168.6.173/edit_bug.aspx elapsed milliseconds:0021
2016-08-10 07:39:12 http://192.168.6.173/edit_bug.aspx sql=

select top 1 pj_id from projects where pj_default = 1 order by pj_name;
select top 1 ct_id from categories where ct_default = 1 order by ct_name;
select top 1 pr_id from priorities where pr_default = 1 order by pr_name;
select top 1 st_id from statuses where st_default = 1 order by st_name;
select top 1 udf_id from user_defined_attribute where udf_default = 1 order by udf_name;
2016-08-10 07:39:12 http://192.168.6.173/edit_bug.aspx elapsed milliseconds:0006
2016-08-10 07:39:12 http://192.168.6.173/edit_bug.aspx sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 07:39:12 http://192.168.6.173/edit_bug.aspx elapsed milliseconds:0007
2016-08-10 07:39:12 http://192.168.6.173/edit_bug.aspx sql=
select isnull(pj_default_user,0)
					from projects
					where pj_id = 3
2016-08-10 07:39:12 http://192.168.6.173/edit_bug.aspx sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 07:39:12 http://192.168.6.173/edit_bug.aspx elapsed milliseconds:0001
2016-08-10 07:40:10 http://192.168.6.173/bugs.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 07:40:10 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 07:40:10 http://192.168.6.173/bugs.aspx sql=
/* query dropdown */
select qu_id, qu_desc
from queries
where (isnull(qu_user,0) = 0 and isnull(qu_org,0) = 0)
or isnull(qu_user,0) = 1
or isnull(qu_org,0) = 6
order by qu_desc
2016-08-10 07:40:10 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 07:40:10 http://192.168.6.173/bugs.aspx sql=
select qu_sql from queries where qu_id = 1
2016-08-10 07:40:10 http://192.168.6.173/bugs.aspx sql=
select isnull(pr_background_color,'#ffffff'), bg_id [id], isnull(bu_flag,0) [$FLAG], 
 bg_short_desc [desc], isnull(pj_name,'') [project], isnull(og_name,'') [organization], isnull(ct_name,'') [category], rpt.us_username [reported by],
 bg_reported_date [reported on], isnull(pr_name,'') [priority], isnull(asg.us_username,'') [assigned to],
 isnull(st_name,'') [status], isnull(lu.us_username,'') [last updated by], bg_last_updated_date [last updated on]
 from bugs 
 left outer join bug_user on bu_bug = bg_id and bu_user = 1 
 left outer join users rpt on rpt.us_id = bg_reported_user
 left outer join users asg on asg.us_id = bg_assigned_to_user
 left outer join users lu on lu.us_id = bg_last_updated_user
 left outer join projects on pj_id = bg_project
 left outer join orgs on og_id = bg_org
 left outer join categories on ct_id = bg_category
 left outer join priorities on pr_id = bg_priority
 left outer join statuses on st_id = bg_status
  /* altered - just order by  */ WHERE  (bugs.bg_project not in (
					select pu_project
					from project_user_xref
					where pu_user = 1
					and pu_permission_level = 0)) order by bg_id desc
2016-08-10 07:40:10 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 07:43:11 http://192.168.6.173/ajax.aspx?bugid=4 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 07:43:11 http://192.168.6.173/ajax.aspx?bugid=4 elapsed milliseconds:0000
2016-08-10 07:43:11 http://192.168.6.173/ajax.aspx?bugid=4 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 4
2016-08-10 07:43:11 http://192.168.6.173/ajax.aspx?bugid=4 elapsed milliseconds:0002
2016-08-10 07:43:11 http://192.168.6.173/ajax.aspx?bugid=4 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 4
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 07:43:11 http://192.168.6.173/ajax.aspx?bugid=4 elapsed milliseconds:0204
2016-08-10 07:43:11 http://192.168.6.173/ajax.aspx?bugid=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 07:43:11 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 07:43:11 http://192.168.6.173/ajax.aspx?bugid=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 07:43:11 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0003
2016-08-10 07:43:11 http://192.168.6.173/ajax.aspx?bugid=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 07:43:11 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0009
2016-08-10 07:43:23 http://192.168.6.173/edit_bug.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 07:43:23 http://192.168.6.173/edit_bug.aspx elapsed milliseconds:0000
2016-08-10 07:43:23 http://192.168.6.173/edit_bug.aspx sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 07:43:23 http://192.168.6.173/edit_bug.aspx elapsed milliseconds:0000
2016-08-10 07:43:23 http://192.168.6.173/edit_bug.aspx sql=

select top 1 pj_id from projects where pj_default = 1 order by pj_name;
select top 1 ct_id from categories where ct_default = 1 order by ct_name;
select top 1 pr_id from priorities where pr_default = 1 order by pr_name;
select top 1 st_id from statuses where st_default = 1 order by st_name;
select top 1 udf_id from user_defined_attribute where udf_default = 1 order by udf_name;
2016-08-10 07:43:23 http://192.168.6.173/edit_bug.aspx elapsed milliseconds:0000
2016-08-10 07:43:23 http://192.168.6.173/edit_bug.aspx sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 07:43:23 http://192.168.6.173/edit_bug.aspx elapsed milliseconds:0000
2016-08-10 07:43:23 http://192.168.6.173/edit_bug.aspx sql=
select isnull(pj_default_user,0)
					from projects
					where pj_id = 3
2016-08-10 07:43:23 http://192.168.6.173/edit_bug.aspx sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 07:43:23 http://192.168.6.173/edit_bug.aspx elapsed milliseconds:0000
2016-08-10 07:43:24 http://192.168.6.173/edit_bug.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 07:43:24 http://192.168.6.173/edit_bug.aspx elapsed milliseconds:0000
2016-08-10 07:43:24 http://192.168.6.173/edit_bug.aspx sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 07:43:24 http://192.168.6.173/edit_bug.aspx elapsed milliseconds:0000
2016-08-10 07:43:24 http://192.168.6.173/edit_bug.aspx sql=

select top 1 pj_id from projects where pj_default = 1 order by pj_name;
select top 1 ct_id from categories where ct_default = 1 order by ct_name;
select top 1 pr_id from priorities where pr_default = 1 order by pr_name;
select top 1 st_id from statuses where st_default = 1 order by st_name;
select top 1 udf_id from user_defined_attribute where udf_default = 1 order by udf_name;
2016-08-10 07:43:24 http://192.168.6.173/edit_bug.aspx elapsed milliseconds:0000
2016-08-10 07:43:24 http://192.168.6.173/edit_bug.aspx sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 07:43:24 http://192.168.6.173/edit_bug.aspx elapsed milliseconds:0000
2016-08-10 07:43:24 http://192.168.6.173/edit_bug.aspx sql=
select isnull(pj_default_user,0)
					from projects
					where pj_id = 3
2016-08-10 07:43:24 http://192.168.6.173/edit_bug.aspx sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 07:43:24 http://192.168.6.173/edit_bug.aspx elapsed milliseconds:0000
2016-08-10 07:45:01 http://192.168.6.173/queries.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 07:45:01 http://192.168.6.173/queries.aspx elapsed milliseconds:0000
2016-08-10 07:45:01 http://192.168.6.173/queries.aspx sql=
select
			qu_desc [query],
			case
				when isnull(qu_user,0) = 0 and isnull(qu_org,0) is null then 'everybody'
				when isnull(qu_user,0) <> 0 then 'user:' + us_username
				when isnull(qu_org,0) <> 0 then 'org:' + og_name
				else ' '
				end [visibility],
			'<a href=bugs.aspx?qu_id=' + convert(varchar,qu_id) + '>view list</a>' [view list],
			'<a target=_blank href=print_bugs.aspx?qu_id=' + convert(varchar,qu_id) + '>print list</a>' [print list],
			'<a target=_blank href=print_bugs.aspx?format=excel&qu_id=' + convert(varchar,qu_id) + '>export as excel</a>' [export as excel],
			'<a target=_blank href=print_bugs2.aspx?qu_id=' + convert(varchar,qu_id) + '>print detail</a>' [print list<br>with detail],
			'<a href=edit_query.aspx?id=' + convert(varchar,qu_id) + '>edit</a>' [edit],
			'<a href=delete_query.aspx?id=' + convert(varchar,qu_id) + '>delete</a>' [delete],
			replace(convert(nvarchar(4000),qu_sql), char(10),'<br>') [sql]
			from queries
			left outer join users on qu_user = us_id
			left outer join orgs on qu_org = og_id
			where 1 = 0 /* all */
			or isnull(qu_user,0) = 1
			or isnull(qu_user,0) = 0
			order by qu_desc
2016-08-10 07:45:01 http://192.168.6.173/queries.aspx elapsed milliseconds:0008
2016-08-10 07:45:09 http://192.168.6.173/reports.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 07:45:09 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 07:45:09 http://192.168.6.173/reports.aspx sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>pie</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>line</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>bar</a>'
	else
		'&nbsp;' end [view<br>chart],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>data</a>' [view<br>data]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>edit</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>delete</a>' [delete] 
from reports order by rp_desc
2016-08-10 07:45:09 http://192.168.6.173/reports.aspx elapsed milliseconds:0016
2016-08-10 07:47:22 http://192.168.6.173/dashboard.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 07:47:22 http://192.168.6.173/dashboard.aspx elapsed milliseconds:0000
2016-08-10 07:47:22 http://192.168.6.173/dashboard.aspx sql=

select ds.*, rp_desc
from dashboard_items ds
inner join reports on rp_id = ds_report
where ds_user = 1
order by ds_col, ds_row
2016-08-10 07:47:22 http://192.168.6.173/dashboard.aspx elapsed milliseconds:0036
2016-08-10 07:47:24 http://192.168.6.173/edit_dashboard.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 07:47:24 http://192.168.6.173/edit_dashboard.aspx elapsed milliseconds:0000
2016-08-10 07:47:24 http://192.168.6.173/edit_dashboard.aspx sql=

select ds_id, ds_col, ds_row, ds_chart_type, rp_desc
from dashboard_items ds
inner join reports on rp_id = ds_report
where ds_user = 1
order by ds_col, ds_row
2016-08-10 07:47:24 http://192.168.6.173/edit_dashboard.aspx elapsed milliseconds:0002
2016-08-10 07:47:29 http://192.168.6.173/dashboard.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 07:47:29 http://192.168.6.173/dashboard.aspx elapsed milliseconds:0000
2016-08-10 07:47:29 http://192.168.6.173/dashboard.aspx sql=

select ds.*, rp_desc
from dashboard_items ds
inner join reports on rp_id = ds_report
where ds_user = 1
order by ds_col, ds_row
2016-08-10 07:47:29 http://192.168.6.173/dashboard.aspx elapsed milliseconds:0000
2016-08-10 07:47:31 http://192.168.6.173/reports.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 07:47:31 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 07:47:31 http://192.168.6.173/reports.aspx sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>pie</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>line</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>bar</a>'
	else
		'&nbsp;' end [view<br>chart],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>data</a>' [view<br>data]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>edit</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>delete</a>' [delete] 
from reports order by rp_desc
2016-08-10 07:47:31 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 07:47:36 http://192.168.6.173/admin.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 07:47:36 http://192.168.6.173/admin.aspx elapsed milliseconds:0000
2016-08-10 07:47:36 http://192.168.6.173/admin.aspx sql=
select count(1) from bugs
2016-08-10 07:47:43 http://192.168.6.173/bugs.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 07:47:43 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 07:47:43 http://192.168.6.173/bugs.aspx sql=
/* query dropdown */
select qu_id, qu_desc
from queries
where (isnull(qu_user,0) = 0 and isnull(qu_org,0) = 0)
or isnull(qu_user,0) = 1
or isnull(qu_org,0) = 6
order by qu_desc
2016-08-10 07:47:43 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 07:47:43 http://192.168.6.173/bugs.aspx sql=
select qu_sql from queries where qu_id = 1
2016-08-10 07:47:43 http://192.168.6.173/bugs.aspx sql=
select isnull(pr_background_color,'#ffffff'), bg_id [id], isnull(bu_flag,0) [$FLAG], 
 bg_short_desc [desc], isnull(pj_name,'') [project], isnull(og_name,'') [organization], isnull(ct_name,'') [category], rpt.us_username [reported by],
 bg_reported_date [reported on], isnull(pr_name,'') [priority], isnull(asg.us_username,'') [assigned to],
 isnull(st_name,'') [status], isnull(lu.us_username,'') [last updated by], bg_last_updated_date [last updated on]
 from bugs 
 left outer join bug_user on bu_bug = bg_id and bu_user = 1 
 left outer join users rpt on rpt.us_id = bg_reported_user
 left outer join users asg on asg.us_id = bg_assigned_to_user
 left outer join users lu on lu.us_id = bg_last_updated_user
 left outer join projects on pj_id = bg_project
 left outer join orgs on og_id = bg_org
 left outer join categories on ct_id = bg_category
 left outer join priorities on pr_id = bg_priority
 left outer join statuses on st_id = bg_status
  /* altered - just order by  */ WHERE  (bugs.bg_project not in (
					select pu_project
					from project_user_xref
					where pu_user = 1
					and pu_permission_level = 0)) order by bg_id desc
2016-08-10 07:47:43 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 07:47:44 http://192.168.6.173/ajax.aspx?bugid=4 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 07:47:44 http://192.168.6.173/ajax.aspx?bugid=4 elapsed milliseconds:0000
2016-08-10 07:47:44 http://192.168.6.173/ajax.aspx?bugid=4 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 4
2016-08-10 07:47:44 http://192.168.6.173/ajax.aspx?bugid=4 elapsed milliseconds:0000
2016-08-10 07:47:44 http://192.168.6.173/ajax.aspx?bugid=4 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 4
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 07:47:44 http://192.168.6.173/ajax.aspx?bugid=4 elapsed milliseconds:0000
2016-08-10 07:47:44 http://192.168.6.173/ajax.aspx?bugid=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 07:47:44 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 07:47:44 http://192.168.6.173/ajax.aspx?bugid=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 07:47:44 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 07:47:44 http://192.168.6.173/ajax.aspx?bugid=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 07:47:44 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 07:47:45 http://192.168.6.173/edit_bug.aspx?id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 07:47:45 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 07:47:45 http://192.168.6.173/edit_bug.aspx?id=5 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 5
2016-08-10 07:47:45 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0028
2016-08-10 07:47:45 http://192.168.6.173/edit_bug.aspx?id=5 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 07:47:45 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0001
2016-08-10 07:47:45 http://192.168.6.173/edit_bug.aspx?id=5 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 07:47:45 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 07:47:45 http://192.168.6.173/edit_bug.aspx?id=5 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 07:47:45 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 07:47:45 http://192.168.6.173/edit_bug.aspx?id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 07:47:45 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0008
2016-08-10 07:50:14 http://192.168.6.173/edit_bug.aspx?id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 07:50:14 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 07:50:14 http://192.168.6.173/edit_bug.aspx?id=5 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 5
2016-08-10 07:50:14 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 07:50:14 http://192.168.6.173/edit_bug.aspx?id=5 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 07:50:14 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 07:50:14 http://192.168.6.173/edit_bug.aspx?id=5 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 07:50:14 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 07:50:14 http://192.168.6.173/edit_bug.aspx?id=5 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 07:50:14 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 07:50:14 http://192.168.6.173/edit_bug.aspx?id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 07:50:14 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 07:58:00 http://192.168.6.173/edit_bug.aspx?id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 07:58:00 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 07:58:00 http://192.168.6.173/edit_bug.aspx?id=5 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 5
2016-08-10 07:58:00 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 07:58:00 http://192.168.6.173/edit_bug.aspx?id=5 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 07:58:00 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 07:58:00 http://192.168.6.173/edit_bug.aspx?id=5 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 07:58:00 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 07:58:00 http://192.168.6.173/edit_bug.aspx?id=5 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 07:58:00 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 07:58:00 http://192.168.6.173/edit_bug.aspx?id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 07:58:00 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 07:58:21 http://192.168.6.173/subscribe.aspx?ses=b9972486-9a4c-4cf3-ab5d-20809193b8a2&id=5&actn=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 07:58:21 http://192.168.6.173/subscribe.aspx?ses=b9972486-9a4c-4cf3-ab5d-20809193b8a2&id=5&actn=1 elapsed milliseconds:0000
2016-08-10 07:58:21 http://192.168.6.173/subscribe.aspx?ses=b9972486-9a4c-4cf3-ab5d-20809193b8a2&id=5&actn=1 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 07:58:21 http://192.168.6.173/subscribe.aspx?ses=b9972486-9a4c-4cf3-ab5d-20809193b8a2&id=5&actn=1 elapsed milliseconds:0000
2016-08-10 07:58:21 http://192.168.6.173/subscribe.aspx?ses=b9972486-9a4c-4cf3-ab5d-20809193b8a2&id=5&actn=1 sql=
insert into bug_subscriptions (bs_bug, bs_user)
			values(5, 1)
2016-08-10 07:58:26 http://192.168.6.173/subscribe.aspx?ses=b9972486-9a4c-4cf3-ab5d-20809193b8a2&id=5&actn=0 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 07:58:26 http://192.168.6.173/subscribe.aspx?ses=b9972486-9a4c-4cf3-ab5d-20809193b8a2&id=5&actn=0 elapsed milliseconds:0000
2016-08-10 07:58:26 http://192.168.6.173/subscribe.aspx?ses=b9972486-9a4c-4cf3-ab5d-20809193b8a2&id=5&actn=0 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 07:58:26 http://192.168.6.173/subscribe.aspx?ses=b9972486-9a4c-4cf3-ab5d-20809193b8a2&id=5&actn=0 elapsed milliseconds:0000
2016-08-10 07:58:26 http://192.168.6.173/subscribe.aspx?ses=b9972486-9a4c-4cf3-ab5d-20809193b8a2&id=5&actn=0 sql=
delete from bug_subscriptions
			where bs_bug = 5 and bs_user = 1
2016-08-10 07:59:22 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 07:59:22 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 elapsed milliseconds:0000
2016-08-10 07:59:22 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 07:59:22 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 elapsed milliseconds:0000
2016-08-10 07:59:22 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 07:59:22 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 elapsed milliseconds:0000
2016-08-10 07:59:22 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 08:00:35 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=1&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:00:35 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=1&id=5 elapsed milliseconds:0000
2016-08-10 08:00:35 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=1&id=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:00:35 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=1&id=5 elapsed milliseconds:0000
2016-08-10 08:00:36 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=1&id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:00:36 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=1&id=5 elapsed milliseconds:0000
2016-08-10 08:00:36 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:00:36 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 elapsed milliseconds:0000
2016-08-10 08:00:36 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:00:36 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 elapsed milliseconds:0001
2016-08-10 08:00:36 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:00:36 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 elapsed milliseconds:0000
2016-08-10 08:00:37 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=1&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:00:37 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=1&id=5 elapsed milliseconds:0001
2016-08-10 08:00:37 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=1&id=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:00:37 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=1&id=5 elapsed milliseconds:0000
2016-08-10 08:00:37 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=1&id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:00:37 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=1&id=5 elapsed milliseconds:0006
2016-08-10 08:00:38 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 08:00:38 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 08:00:38 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 08:06:08 http://192.168.6.173/edit_bug.aspx?id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:06:08 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 08:06:08 http://192.168.6.173/edit_bug.aspx?id=5 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:06:08 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 08:06:08 http://192.168.6.173/edit_bug.aspx?id=5 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 08:06:08 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 08:06:08 http://192.168.6.173/edit_bug.aspx?id=5 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 08:06:08 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 08:06:08 http://192.168.6.173/edit_bug.aspx?id=5 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 08:06:08 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 08:06:08 http://192.168.6.173/edit_bug.aspx?id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:06:08 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 08:06:31 http://192.168.6.173/edit_bug.aspx?id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:06:31 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 08:06:31 http://192.168.6.173/edit_bug.aspx?id=5 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:06:31 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 08:06:31 http://192.168.6.173/edit_bug.aspx?id=5 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 08:06:31 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 08:06:31 http://192.168.6.173/edit_bug.aspx?id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:06:31 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 08:07:42 http://192.168.6.173/edit_bug.aspx?id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:07:42 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 08:07:42 http://192.168.6.173/edit_bug.aspx?id=5 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:07:42 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 08:07:42 http://192.168.6.173/edit_bug.aspx?id=5 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 08:07:42 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 08:07:42 http://192.168.6.173/edit_bug.aspx?id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:07:42 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 08:13:49  threadproc_votes
2016-08-10 08:13:49  sql=

if exists (select * from dbo.sysobjects where id = object_id(N'[votes_view]'))
drop view [votes_view]
2016-08-10 08:13:49  sql=

create view votes_view as
select bu_bug as vote_bug, sum(bu_vote) as vote_total
from bug_user
group by bu_bug
having sum(bu_vote) > 0
2016-08-10 08:13:49  sql=

select bu_bug, count(1)
from bug_user 
where bu_vote = 1
group by bu_bug
2016-08-10 08:13:49  elapsed milliseconds:0000
2016-08-10 08:13:49  started creating Lucene index using folder C:\btnet364\www\App_Data\lucene_index
2016-08-10 08:13:49  sql=

/* get searchable cols */					
select sc.name
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
and st.[name] in ('nvarchar','varchar')
and sc.length > 30
2016-08-10 08:13:49  elapsed milliseconds:0000
2016-08-10 08:13:49  sql=

select bg_id, 	

isnull(bg_tags,'') bg_tags,
bg_short_desc
from bugs
2016-08-10 08:13:49  elapsed milliseconds:0000
2016-08-10 08:13:49  sql=

select bp_bug, bp_id, 
isnull(bp_comment_search,bp_comment) [text] 
from bug_posts 
where bp_type <> 'update'
and bp_hidden_from_external_users = 0
2016-08-10 08:13:49  elapsed milliseconds:0000
2016-08-10 08:13:49  done creating Lucene index
2016-08-10 08:13:53 http://192.168.6.173/edit_bug.aspx?id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:13:53 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 08:13:53 http://192.168.6.173/edit_bug.aspx?id=5 sql=

/* custom columns */ select sc.name, st.[name] [datatype], 
case when st.[name] = 'nvarchar' or st.[name] = 'nchar' then sc.length/2 else sc.length end as [length], 
sc.xprec, sc.xscale, sc.isnullable,
mm.text [default value], 
dflts.name [default name], 
isnull(ccm_dropdown_type,'') [dropdown type],
isnull(ccm_dropdown_vals,'') [vals],
isnull(ccm_sort_seq, sc.colorder) [column order],
sc.colorder
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
left outer join syscomments mm on sc.cdefault = mm.id
left outer join custom_col_metadata on ccm_colorder = sc.colorder
left outer join sysobjects dflts on dflts.id = mm.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
order by sc.id, isnull(ccm_sort_seq,sc.colorder)
2016-08-10 08:13:53 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 08:13:53 http://192.168.6.173/edit_bug.aspx?id=5 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:13:53 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 08:13:53 http://192.168.6.173/edit_bug.aspx?id=5 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 08:13:53 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 08:13:53 http://192.168.6.173/edit_bug.aspx?id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:13:53 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 08:14:04 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:14:04 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 elapsed milliseconds:0000
2016-08-10 08:14:04 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:14:04 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 elapsed milliseconds:0000
2016-08-10 08:14:04 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:14:04 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 elapsed milliseconds:0000
2016-08-10 08:14:04 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 08:14:05 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=1&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:14:05 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=1&id=5 elapsed milliseconds:0000
2016-08-10 08:14:05 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=1&id=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:14:05 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=1&id=5 elapsed milliseconds:0000
2016-08-10 08:14:05 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=1&id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:14:05 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=1&id=5 elapsed milliseconds:0000
2016-08-10 08:14:05 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 08:14:06 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:14:06 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 elapsed milliseconds:0000
2016-08-10 08:14:06 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:14:06 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 elapsed milliseconds:0000
2016-08-10 08:14:06 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:14:06 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 elapsed milliseconds:0000
2016-08-10 08:14:06 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 08:14:08 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:14:09 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:14:09 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:14:09 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:14:09 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:14:09 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:14:09 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 08:14:09 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:14:09 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 elapsed milliseconds:0000
2016-08-10 08:14:09 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:14:09 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 elapsed milliseconds:0000
2016-08-10 08:14:09 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:14:09 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 elapsed milliseconds:0000
2016-08-10 08:14:10 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 08:14:10 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:14:10 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:14:10 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:14:10 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:14:10 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:14:10 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:14:10 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 08:16:24 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:16:24 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 elapsed milliseconds:0000
2016-08-10 08:16:24 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:16:24 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 elapsed milliseconds:0017
2016-08-10 08:16:24 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:16:24 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 elapsed milliseconds:0001
2016-08-10 08:16:24 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 08:16:25 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:16:25 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:16:25 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:16:25 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:16:25 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:16:25 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:16:26 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 08:16:26 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:16:26 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:16:26 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:16:26 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:16:26 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:16:26 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:16:26 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 08:16:28 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:16:28 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:16:28 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:16:28 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:16:28 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:16:28 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:16:28 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 08:16:29 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:16:29 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:16:29 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:16:29 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:16:29 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:16:29 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:16:29 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 08:17:13 http://192.168.6.173/edit_bug.aspx?id=4 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:17:13 http://192.168.6.173/edit_bug.aspx?id=4 elapsed milliseconds:0000
2016-08-10 08:17:13 http://192.168.6.173/edit_bug.aspx?id=4 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 4
2016-08-10 08:17:13 http://192.168.6.173/edit_bug.aspx?id=4 elapsed milliseconds:0026
2016-08-10 08:17:13 http://192.168.6.173/edit_bug.aspx?id=4 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 08:17:13 http://192.168.6.173/edit_bug.aspx?id=4 elapsed milliseconds:0000
2016-08-10 08:17:13 http://192.168.6.173/edit_bug.aspx?id=4 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 08:17:13 http://192.168.6.173/edit_bug.aspx?id=4 elapsed milliseconds:0000
2016-08-10 08:17:13 http://192.168.6.173/edit_bug.aspx?id=4 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 08:17:13 http://192.168.6.173/edit_bug.aspx?id=4 elapsed milliseconds:0000
2016-08-10 08:17:13 http://192.168.6.173/edit_bug.aspx?id=4 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 4
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:17:13 http://192.168.6.173/edit_bug.aspx?id=4 elapsed milliseconds:0000
2016-08-10 08:21:14 http://192.168.6.173/edit_bug.aspx?id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:21:14 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 08:21:14 http://192.168.6.173/edit_bug.aspx?id=5 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:21:14 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 08:21:14 http://192.168.6.173/edit_bug.aspx?id=5 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 08:21:14 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 08:21:14 http://192.168.6.173/edit_bug.aspx?id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:21:14 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 08:21:20 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:21:20 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:21:20 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:21:20 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0031
2016-08-10 08:21:20 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:21:20 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:21:20 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 08:21:21 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:21:21 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:21:21 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:21:21 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:21:21 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:21:21 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:21:21 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 08:21:22 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:21:22 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:21:22 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:21:22 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:21:22 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:21:22 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:21:22 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 08:21:23 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:21:23 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 elapsed milliseconds:0000
2016-08-10 08:21:23 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:21:23 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 elapsed milliseconds:0000
2016-08-10 08:21:23 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:21:23 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 elapsed milliseconds:0000
2016-08-10 08:21:23 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 08:21:23 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:21:23 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0001
2016-08-10 08:21:23 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:21:23 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:21:23 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:21:23 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:21:23 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 08:21:23 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:21:23 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 elapsed milliseconds:0001
2016-08-10 08:21:23 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:21:23 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 elapsed milliseconds:0000
2016-08-10 08:21:23 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:21:23 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=5 elapsed milliseconds:0000
2016-08-10 08:21:23 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 08:21:25 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:21:25 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:21:25 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:21:25 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:21:25 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:21:25 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:21:25 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 08:21:26 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:21:26 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:21:26 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:21:26 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:21:26 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:21:26 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:21:26 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 08:21:27 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:21:27 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:21:27 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:21:27 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:21:27 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:21:27 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:21:27 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 08:21:28 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:21:28 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:21:28 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:21:28 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:21:28 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:21:28 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:21:28 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 08:21:28 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:21:28 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:21:28 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:21:28 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:21:28 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:21:28 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:21:28 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 08:21:29 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:21:29 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:21:29 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:21:29 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:21:29 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:21:29 http://192.168.6.173/write_posts.aspx?images_inline=0&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:21:29 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 08:21:30 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:21:30 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:21:30 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:21:30 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:21:30 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:21:30 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=5 elapsed milliseconds:0000
2016-08-10 08:21:30 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 08:21:34 http://192.168.6.173/edit_bug.aspx?id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b9972486-9a4c-4cf3-ab5d-20809193b8a2'
and us_active = 1
2016-08-10 08:21:34 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 08:21:34 http://192.168.6.173/edit_bug.aspx?id=5 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 5
2016-08-10 08:21:34 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 08:21:34 http://192.168.6.173/edit_bug.aspx?id=5 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 08:21:34 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 08:21:34 http://192.168.6.173/edit_bug.aspx?id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:21:34 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 08:21:58 http://192.168.6.173/Default.aspx sql=
select count(1) from users
2016-08-10 08:22:00 http://192.168.6.173/Default.aspx sql=
select count(1) from users
2016-08-10 08:22:00 http://192.168.6.173/Default.aspx sql=

select us_username, us_id, us_password, isnull(us_salt,0) us_salt, us_active
from users
where us_username = N'admin'
2016-08-10 08:22:00 http://192.168.6.173/Default.aspx elapsed milliseconds:0006
2016-08-10 08:22:00 http://192.168.6.173/Default.aspx sql=
update users set us_most_recent_login_datetime = getdate() where us_id = 1
2016-08-10 08:22:00 http://192.168.6.173/Default.aspx sql=
select us_id from users where us_username = N'admin'
2016-08-10 08:22:00 http://192.168.6.173/Default.aspx elapsed milliseconds:0001
2016-08-10 08:22:00 http://192.168.6.173/Default.aspx guid=b4aebceb-f8b5-4641-8d8e-c86947f042b8
2016-08-10 08:22:00 http://192.168.6.173/Default.aspx sql=
insert into sessions (se_id, se_user) values('b4aebceb-f8b5-4641-8d8e-c86947f042b8', 1)
2016-08-10 08:22:00 http://192.168.6.173/Default.aspx AppPath:
2016-08-10 08:22:00 http://192.168.6.173/bugs.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 08:22:00 http://192.168.6.173/bugs.aspx elapsed milliseconds:0011
2016-08-10 08:22:00 http://192.168.6.173/bugs.aspx sql=
/* query dropdown */
select qu_id, qu_desc
from queries
where (isnull(qu_user,0) = 0 and isnull(qu_org,0) = 0)
or isnull(qu_user,0) = 1
or isnull(qu_org,0) = 6
order by qu_desc
2016-08-10 08:22:00 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 08:22:00 http://192.168.6.173/bugs.aspx sql=
select qu_id, qu_sql from queries where qu_id in
			(select us_default_query from users where us_id = 1)
2016-08-10 08:22:00 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 08:22:00 http://192.168.6.173/bugs.aspx sql=
select isnull(pr_background_color,'#ffffff'), bg_id [id], isnull(bu_flag,0) [$FLAG], 
 bg_short_desc [desc], isnull(pj_name,'') [project], isnull(og_name,'') [organization], isnull(ct_name,'') [category], rpt.us_username [reported by],
 bg_reported_date [reported on], isnull(pr_name,'') [priority], isnull(asg.us_username,'') [assigned to],
 isnull(st_name,'') [status], isnull(lu.us_username,'') [last updated by], bg_last_updated_date [last updated on]
 from bugs 
 left outer join bug_user on bu_bug = bg_id and bu_user = 1 
 left outer join users rpt on rpt.us_id = bg_reported_user
 left outer join users asg on asg.us_id = bg_assigned_to_user
 left outer join users lu on lu.us_id = bg_last_updated_user
 left outer join projects on pj_id = bg_project
 left outer join orgs on og_id = bg_org
 left outer join categories on ct_id = bg_category
 left outer join priorities on pr_id = bg_priority
 left outer join statuses on st_id = bg_status
  /* altered - just order by  */ WHERE  (bugs.bg_project not in (
					select pu_project
					from project_user_xref
					where pu_user = 1
					and pu_permission_level = 0)) order by bg_id desc
2016-08-10 08:22:00 http://192.168.6.173/bugs.aspx elapsed milliseconds:0004
2016-08-10 08:22:02 http://192.168.6.173/ajax.aspx?bugid=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 08:22:02 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0001
2016-08-10 08:22:02 http://192.168.6.173/ajax.aspx?bugid=1 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 1
2016-08-10 08:22:02 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0003
2016-08-10 08:22:02 http://192.168.6.173/ajax.aspx?bugid=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:22:02 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0009
2016-08-10 08:22:02 http://192.168.6.173/ajax.aspx?bugid=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 08:22:02 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 08:22:02 http://192.168.6.173/ajax.aspx?bugid=1 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 1
2016-08-10 08:22:02 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 08:22:02 http://192.168.6.173/ajax.aspx?bugid=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:22:02 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 08:22:03 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 08:22:03 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:22:03 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 08:22:03 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0027
2016-08-10 08:22:03 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 08:22:03 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:22:03 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 08:22:03 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:22:03 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 08:22:03 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:22:03 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:22:03 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:25:49 http://192.168.6.173/send_email.aspx?quote=1&bp_id=1&reply=forward sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 08:25:49 http://192.168.6.173/send_email.aspx?quote=1&bp_id=1&reply=forward elapsed milliseconds:0000
2016-08-10 08:25:49 http://192.168.6.173/send_email.aspx?quote=1&bp_id=1&reply=forward sql=
select
				bp_parent,
                bp_file,
                bp_id,
				bg_id,
				bg_short_desc,
				bp_email_from,
				bp_comment,
				bp_email_from,
				bp_date,
				bp_type,
                bp_content_type,
				bg_project,
                bp_hidden_from_external_users,
				isnull(us_signature,'') [us_signature],
				isnull(pj_pop3_email_from,'') [pj_pop3_email_from],
				isnull(us_email,'') [us_email],
				isnull(us_firstname,'') [us_firstname],
				isnull(us_lastname,'') [us_lastname]				
				from bug_posts
				inner join bugs on bp_bug = bg_id
				inner join users on us_id = 1
				left outer join projects on bg_project = pj_id
				where bp_id = 1
				or (bp_parent = 1 and bp_type='file')
2016-08-10 08:25:49 http://192.168.6.173/send_email.aspx?quote=1&bp_id=1&reply=forward elapsed milliseconds:0010
2016-08-10 08:25:49 http://192.168.6.173/send_email.aspx?quote=1&bp_id=1&reply=forward sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 1
2016-08-10 08:25:49 http://192.168.6.173/send_email.aspx?quote=1&bp_id=1&reply=forward elapsed milliseconds:0000
2016-08-10 08:25:49 http://192.168.6.173/send_email.aspx?quote=1&bp_id=1&reply=forward sql=
select us_id
						from users
						where us_active = 1
						and len(us_email) > 0
						and us_id not in
							(select pu_user from project_user_xref
							where pu_project = 3
							and pu_permission_level = 0)
						order by us_email
2016-08-10 08:25:49 http://192.168.6.173/send_email.aspx?quote=1&bp_id=1&reply=forward elapsed milliseconds:0004
2016-08-10 08:25:50 http://192.168.6.173/send_email.aspx?quote=1&bp_id=1&reply=forward sql=

/* get related users 2 */
select  pj_id, us_id,
case when 1 = 1 then
    case when len(isnull(us_firstname,'') + ' ' + isnull(us_lastname,'')) > 1
	then isnull(us_firstname,'') + ' ' + isnull(us_lastname,'')
    else us_username end
else us_username end us_username,
isnull(us_email,'') us_email
into #temp
from projects, users
where pj_id not in
(
	select pu_project from project_user_xref
	where pu_permission_level = 0 and pu_user = 1
)





if 0 = 1 -- external
and 2 = 0 -- other orgs
begin
	select distinct a.us_id, a.us_username, a.us_email
	from #temp a
	inner join users b on a.us_id = b.us_id
	inner join orgs on b.us_org = og_id
	where og_external_user = 0 or b.us_org = 6
	order by a.us_username
end
else
begin

	select distinct us_id, us_username, us_email
		from #temp
		left outer join project_user_xref on pj_id = pu_project
		and us_id = pu_user
		where isnull(pu_permission_level,2) <> 0
		order by us_username
end

drop table #temp
2016-08-10 08:25:50 http://192.168.6.173/send_email.aspx?quote=1&bp_id=1&reply=forward elapsed milliseconds:0387
2016-08-10 08:27:01 http://192.168.6.173/send_email.aspx?quote=1&bp_id=2&reply=forward sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 08:27:01 http://192.168.6.173/send_email.aspx?quote=1&bp_id=2&reply=forward elapsed milliseconds:0000
2016-08-10 08:27:01 http://192.168.6.173/send_email.aspx?quote=1&bp_id=2&reply=forward sql=
select
				bp_parent,
                bp_file,
                bp_id,
				bg_id,
				bg_short_desc,
				bp_email_from,
				bp_comment,
				bp_email_from,
				bp_date,
				bp_type,
                bp_content_type,
				bg_project,
                bp_hidden_from_external_users,
				isnull(us_signature,'') [us_signature],
				isnull(pj_pop3_email_from,'') [pj_pop3_email_from],
				isnull(us_email,'') [us_email],
				isnull(us_firstname,'') [us_firstname],
				isnull(us_lastname,'') [us_lastname]				
				from bug_posts
				inner join bugs on bp_bug = bg_id
				inner join users on us_id = 1
				left outer join projects on bg_project = pj_id
				where bp_id = 2
				or (bp_parent = 2 and bp_type='file')
2016-08-10 08:27:01 http://192.168.6.173/send_email.aspx?quote=1&bp_id=2&reply=forward elapsed milliseconds:0006
2016-08-10 08:27:01 http://192.168.6.173/send_email.aspx?quote=1&bp_id=2&reply=forward sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 1
2016-08-10 08:27:01 http://192.168.6.173/send_email.aspx?quote=1&bp_id=2&reply=forward elapsed milliseconds:0000
2016-08-10 08:27:01 http://192.168.6.173/send_email.aspx?quote=1&bp_id=2&reply=forward sql=
select us_id
						from users
						where us_active = 1
						and len(us_email) > 0
						and us_id not in
							(select pu_user from project_user_xref
							where pu_project = 3
							and pu_permission_level = 0)
						order by us_email
2016-08-10 08:27:01 http://192.168.6.173/send_email.aspx?quote=1&bp_id=2&reply=forward elapsed milliseconds:0000
2016-08-10 08:27:01 http://192.168.6.173/send_email.aspx?quote=1&bp_id=2&reply=forward sql=

/* get related users 2 */
select  pj_id, us_id,
case when 1 = 1 then
    case when len(isnull(us_firstname,'') + ' ' + isnull(us_lastname,'')) > 1
	then isnull(us_firstname,'') + ' ' + isnull(us_lastname,'')
    else us_username end
else us_username end us_username,
isnull(us_email,'') us_email
into #temp
from projects, users
where pj_id not in
(
	select pu_project from project_user_xref
	where pu_permission_level = 0 and pu_user = 1
)





if 0 = 1 -- external
and 2 = 0 -- other orgs
begin
	select distinct a.us_id, a.us_username, a.us_email
	from #temp a
	inner join users b on a.us_id = b.us_id
	inner join orgs on b.us_org = og_id
	where og_external_user = 0 or b.us_org = 6
	order by a.us_username
end
else
begin

	select distinct us_id, us_username, us_email
		from #temp
		left outer join project_user_xref on pj_id = pu_project
		and us_id = pu_user
		where isnull(pu_permission_level,2) <> 0
		order by us_username
end

drop table #temp
2016-08-10 08:27:01 http://192.168.6.173/send_email.aspx?quote=1&bp_id=2&reply=forward elapsed milliseconds:0012
2016-08-10 08:27:18 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 08:27:18 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:27:18 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 08:27:18 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:27:18 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 08:27:18 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:27:18 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 08:27:18 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:27:18 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 08:27:18 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:27:18 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:27:18 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:30:02  threadproc_votes
2016-08-10 08:30:02  sql=

if exists (select * from dbo.sysobjects where id = object_id(N'[votes_view]'))
drop view [votes_view]
2016-08-10 08:30:02  sql=

create view votes_view as
select bu_bug as vote_bug, sum(bu_vote) as vote_total
from bug_user
group by bu_bug
having sum(bu_vote) > 0
2016-08-10 08:30:02  sql=

select bu_bug, count(1)
from bug_user 
where bu_vote = 1
group by bu_bug
2016-08-10 08:30:02  elapsed milliseconds:0000
2016-08-10 08:30:02  started creating Lucene index using folder C:\btnet364\www\App_Data\lucene_index
2016-08-10 08:30:02  sql=

/* get searchable cols */					
select sc.name
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
and st.[name] in ('nvarchar','varchar')
and sc.length > 30
2016-08-10 08:30:02  elapsed milliseconds:0000
2016-08-10 08:30:02  sql=

select bg_id, 	

isnull(bg_tags,'') bg_tags,
bg_short_desc
from bugs
2016-08-10 08:30:02  elapsed milliseconds:0000
2016-08-10 08:30:02  sql=

select bp_bug, bp_id, 
isnull(bp_comment_search,bp_comment) [text] 
from bug_posts 
where bp_type <> 'update'
and bp_hidden_from_external_users = 0
2016-08-10 08:30:02  elapsed milliseconds:0000
2016-08-10 08:30:03  done creating Lucene index
2016-08-10 08:30:07 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 08:30:07 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:30:07 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* custom columns */ select sc.name, st.[name] [datatype], 
case when st.[name] = 'nvarchar' or st.[name] = 'nchar' then sc.length/2 else sc.length end as [length], 
sc.xprec, sc.xscale, sc.isnullable,
mm.text [default value], 
dflts.name [default name], 
isnull(ccm_dropdown_type,'') [dropdown type],
isnull(ccm_dropdown_vals,'') [vals],
isnull(ccm_sort_seq, sc.colorder) [column order],
sc.colorder
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
left outer join syscomments mm on sc.cdefault = mm.id
left outer join custom_col_metadata on ccm_colorder = sc.colorder
left outer join sysobjects dflts on dflts.id = mm.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
order by sc.id, isnull(ccm_sort_seq,sc.colorder)
2016-08-10 08:30:07 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:30:07 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 08:30:07 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:30:07 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 08:30:07 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:30:07 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 08:30:07 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:30:07 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 08:30:07 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:30:07 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:30:07 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:30:50 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 08:30:50 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:30:50 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 08:30:50 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:30:50 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 08:30:50 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:30:50 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 08:30:50 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:30:50 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 08:30:50 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:30:50 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:30:50 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:33:48  threadproc_votes
2016-08-10 08:33:49  sql=

if exists (select * from dbo.sysobjects where id = object_id(N'[votes_view]'))
drop view [votes_view]
2016-08-10 08:33:49  sql=

create view votes_view as
select bu_bug as vote_bug, sum(bu_vote) as vote_total
from bug_user
group by bu_bug
having sum(bu_vote) > 0
2016-08-10 08:33:49  sql=

select bu_bug, count(1)
from bug_user 
where bu_vote = 1
group by bu_bug
2016-08-10 08:33:49  elapsed milliseconds:0000
2016-08-10 08:33:49  started creating Lucene index using folder C:\btnet364\www\App_Data\lucene_index
2016-08-10 08:33:49  sql=

/* get searchable cols */					
select sc.name
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
and st.[name] in ('nvarchar','varchar')
and sc.length > 30
2016-08-10 08:33:49  elapsed milliseconds:0000
2016-08-10 08:33:49  sql=

select bg_id, 	

isnull(bg_tags,'') bg_tags,
bg_short_desc
from bugs
2016-08-10 08:33:49  elapsed milliseconds:0000
2016-08-10 08:33:49  sql=

select bp_bug, bp_id, 
isnull(bp_comment_search,bp_comment) [text] 
from bug_posts 
where bp_type <> 'update'
and bp_hidden_from_external_users = 0
2016-08-10 08:33:49  elapsed milliseconds:0000
2016-08-10 08:33:49  done creating Lucene index
2016-08-10 08:33:53 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 08:33:53 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:33:53 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* custom columns */ select sc.name, st.[name] [datatype], 
case when st.[name] = 'nvarchar' or st.[name] = 'nchar' then sc.length/2 else sc.length end as [length], 
sc.xprec, sc.xscale, sc.isnullable,
mm.text [default value], 
dflts.name [default name], 
isnull(ccm_dropdown_type,'') [dropdown type],
isnull(ccm_dropdown_vals,'') [vals],
isnull(ccm_sort_seq, sc.colorder) [column order],
sc.colorder
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
left outer join syscomments mm on sc.cdefault = mm.id
left outer join custom_col_metadata on ccm_colorder = sc.colorder
left outer join sysobjects dflts on dflts.id = mm.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
order by sc.id, isnull(ccm_sort_seq,sc.colorder)
2016-08-10 08:33:53 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:33:53 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 08:33:53 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:33:53 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 08:33:53 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:33:53 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 08:33:53 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:33:53 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 08:33:53 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:33:53 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:33:53 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:34:37  threadproc_votes
2016-08-10 08:34:37  sql=

if exists (select * from dbo.sysobjects where id = object_id(N'[votes_view]'))
drop view [votes_view]
2016-08-10 08:34:37  sql=

create view votes_view as
select bu_bug as vote_bug, sum(bu_vote) as vote_total
from bug_user
group by bu_bug
having sum(bu_vote) > 0
2016-08-10 08:34:37  sql=

select bu_bug, count(1)
from bug_user 
where bu_vote = 1
group by bu_bug
2016-08-10 08:34:37  elapsed milliseconds:0000
2016-08-10 08:34:37  started creating Lucene index using folder C:\btnet364\www\App_Data\lucene_index
2016-08-10 08:34:37  sql=

/* get searchable cols */					
select sc.name
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
and st.[name] in ('nvarchar','varchar')
and sc.length > 30
2016-08-10 08:34:37  elapsed milliseconds:0000
2016-08-10 08:34:37  sql=

select bg_id, 	

isnull(bg_tags,'') bg_tags,
bg_short_desc
from bugs
2016-08-10 08:34:37  elapsed milliseconds:0000
2016-08-10 08:34:37  sql=

select bp_bug, bp_id, 
isnull(bp_comment_search,bp_comment) [text] 
from bug_posts 
where bp_type <> 'update'
and bp_hidden_from_external_users = 0
2016-08-10 08:34:37  elapsed milliseconds:0001
2016-08-10 08:34:37  done creating Lucene index
2016-08-10 08:34:41 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 08:34:41 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:34:41 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* custom columns */ select sc.name, st.[name] [datatype], 
case when st.[name] = 'nvarchar' or st.[name] = 'nchar' then sc.length/2 else sc.length end as [length], 
sc.xprec, sc.xscale, sc.isnullable,
mm.text [default value], 
dflts.name [default name], 
isnull(ccm_dropdown_type,'') [dropdown type],
isnull(ccm_dropdown_vals,'') [vals],
isnull(ccm_sort_seq, sc.colorder) [column order],
sc.colorder
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
left outer join syscomments mm on sc.cdefault = mm.id
left outer join custom_col_metadata on ccm_colorder = sc.colorder
left outer join sysobjects dflts on dflts.id = mm.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
order by sc.id, isnull(ccm_sort_seq,sc.colorder)
2016-08-10 08:34:41 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:34:41 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 08:34:41 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:34:41 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 08:34:41 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:34:41 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 08:34:41 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:34:41 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 08:34:41 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:34:41 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:34:41 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:36:17  threadproc_votes
2016-08-10 08:36:17  sql=

if exists (select * from dbo.sysobjects where id = object_id(N'[votes_view]'))
drop view [votes_view]
2016-08-10 08:36:17  sql=

create view votes_view as
select bu_bug as vote_bug, sum(bu_vote) as vote_total
from bug_user
group by bu_bug
having sum(bu_vote) > 0
2016-08-10 08:36:17  sql=

select bu_bug, count(1)
from bug_user 
where bu_vote = 1
group by bu_bug
2016-08-10 08:36:17  elapsed milliseconds:0000
2016-08-10 08:36:17  started creating Lucene index using folder C:\btnet364\www\App_Data\lucene_index
2016-08-10 08:36:17  sql=

/* get searchable cols */					
select sc.name
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
and st.[name] in ('nvarchar','varchar')
and sc.length > 30
2016-08-10 08:36:17  elapsed milliseconds:0000
2016-08-10 08:36:17  sql=

select bg_id, 	

isnull(bg_tags,'') bg_tags,
bg_short_desc
from bugs
2016-08-10 08:36:17  elapsed milliseconds:0000
2016-08-10 08:36:17  sql=

select bp_bug, bp_id, 
isnull(bp_comment_search,bp_comment) [text] 
from bug_posts 
where bp_type <> 'update'
and bp_hidden_from_external_users = 0
2016-08-10 08:36:17  elapsed milliseconds:0000
2016-08-10 08:36:17  done creating Lucene index
2016-08-10 08:36:22 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 08:36:22 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:36:22 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* custom columns */ select sc.name, st.[name] [datatype], 
case when st.[name] = 'nvarchar' or st.[name] = 'nchar' then sc.length/2 else sc.length end as [length], 
sc.xprec, sc.xscale, sc.isnullable,
mm.text [default value], 
dflts.name [default name], 
isnull(ccm_dropdown_type,'') [dropdown type],
isnull(ccm_dropdown_vals,'') [vals],
isnull(ccm_sort_seq, sc.colorder) [column order],
sc.colorder
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
left outer join syscomments mm on sc.cdefault = mm.id
left outer join custom_col_metadata on ccm_colorder = sc.colorder
left outer join sysobjects dflts on dflts.id = mm.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
order by sc.id, isnull(ccm_sort_seq,sc.colorder)
2016-08-10 08:36:22 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:36:22 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 08:36:22 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:36:22 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 08:36:22 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:36:22 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 08:36:22 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:36:22 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 08:36:22 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:36:22 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:36:22 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:38:46  threadproc_votes
2016-08-10 08:38:46  sql=

if exists (select * from dbo.sysobjects where id = object_id(N'[votes_view]'))
drop view [votes_view]
2016-08-10 08:38:46  sql=

create view votes_view as
select bu_bug as vote_bug, sum(bu_vote) as vote_total
from bug_user
group by bu_bug
having sum(bu_vote) > 0
2016-08-10 08:38:46  sql=

select bu_bug, count(1)
from bug_user 
where bu_vote = 1
group by bu_bug
2016-08-10 08:38:46  elapsed milliseconds:0000
2016-08-10 08:38:46  started creating Lucene index using folder C:\btnet364\www\App_Data\lucene_index
2016-08-10 08:38:46  sql=

/* get searchable cols */					
select sc.name
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
and st.[name] in ('nvarchar','varchar')
and sc.length > 30
2016-08-10 08:38:46  elapsed milliseconds:0000
2016-08-10 08:38:46  sql=

select bg_id, 	

isnull(bg_tags,'') bg_tags,
bg_short_desc
from bugs
2016-08-10 08:38:46  elapsed milliseconds:0000
2016-08-10 08:38:46  sql=

select bp_bug, bp_id, 
isnull(bp_comment_search,bp_comment) [text] 
from bug_posts 
where bp_type <> 'update'
and bp_hidden_from_external_users = 0
2016-08-10 08:38:46  elapsed milliseconds:0001
2016-08-10 08:38:46  done creating Lucene index
2016-08-10 08:38:50 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 08:38:50 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:38:50 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* custom columns */ select sc.name, st.[name] [datatype], 
case when st.[name] = 'nvarchar' or st.[name] = 'nchar' then sc.length/2 else sc.length end as [length], 
sc.xprec, sc.xscale, sc.isnullable,
mm.text [default value], 
dflts.name [default name], 
isnull(ccm_dropdown_type,'') [dropdown type],
isnull(ccm_dropdown_vals,'') [vals],
isnull(ccm_sort_seq, sc.colorder) [column order],
sc.colorder
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
left outer join syscomments mm on sc.cdefault = mm.id
left outer join custom_col_metadata on ccm_colorder = sc.colorder
left outer join sysobjects dflts on dflts.id = mm.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
order by sc.id, isnull(ccm_sort_seq,sc.colorder)
2016-08-10 08:38:50 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:38:50 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 08:38:50 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:38:50 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 08:38:50 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:38:50 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 08:38:50 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:38:50 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 08:38:50 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:38:50 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:38:50 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:46:16 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 08:46:16 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:46:16 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 08:46:16 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:46:16 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 08:46:16 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:46:16 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 08:46:16 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:46:16 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 08:46:16 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:46:16 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:46:16 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:46:50  threadproc_votes
2016-08-10 08:46:50  sql=

if exists (select * from dbo.sysobjects where id = object_id(N'[votes_view]'))
drop view [votes_view]
2016-08-10 08:46:50  sql=

create view votes_view as
select bu_bug as vote_bug, sum(bu_vote) as vote_total
from bug_user
group by bu_bug
having sum(bu_vote) > 0
2016-08-10 08:46:50  sql=

select bu_bug, count(1)
from bug_user 
where bu_vote = 1
group by bu_bug
2016-08-10 08:46:50  elapsed milliseconds:0000
2016-08-10 08:46:50  started creating Lucene index using folder C:\btnet364\www\App_Data\lucene_index
2016-08-10 08:46:50  sql=

/* get searchable cols */					
select sc.name
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
and st.[name] in ('nvarchar','varchar')
and sc.length > 30
2016-08-10 08:46:50  elapsed milliseconds:0000
2016-08-10 08:46:50  sql=

select bg_id, 	

isnull(bg_tags,'') bg_tags,
bg_short_desc
from bugs
2016-08-10 08:46:50  elapsed milliseconds:0000
2016-08-10 08:46:50  sql=

select bp_bug, bp_id, 
isnull(bp_comment_search,bp_comment) [text] 
from bug_posts 
where bp_type <> 'update'
and bp_hidden_from_external_users = 0
2016-08-10 08:46:50  elapsed milliseconds:0000
2016-08-10 08:46:50  done creating Lucene index
2016-08-10 08:46:54 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 08:46:54 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:46:54 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* custom columns */ select sc.name, st.[name] [datatype], 
case when st.[name] = 'nvarchar' or st.[name] = 'nchar' then sc.length/2 else sc.length end as [length], 
sc.xprec, sc.xscale, sc.isnullable,
mm.text [default value], 
dflts.name [default name], 
isnull(ccm_dropdown_type,'') [dropdown type],
isnull(ccm_dropdown_vals,'') [vals],
isnull(ccm_sort_seq, sc.colorder) [column order],
sc.colorder
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
left outer join syscomments mm on sc.cdefault = mm.id
left outer join custom_col_metadata on ccm_colorder = sc.colorder
left outer join sysobjects dflts on dflts.id = mm.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
order by sc.id, isnull(ccm_sort_seq,sc.colorder)
2016-08-10 08:46:54 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:46:54 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 08:46:54 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:46:54 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 08:46:54 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:46:54 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 08:46:54 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:46:54 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 08:46:54 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:46:54 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:46:54 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:48:44  threadproc_votes
2016-08-10 08:48:44  sql=

if exists (select * from dbo.sysobjects where id = object_id(N'[votes_view]'))
drop view [votes_view]
2016-08-10 08:48:44  sql=

create view votes_view as
select bu_bug as vote_bug, sum(bu_vote) as vote_total
from bug_user
group by bu_bug
having sum(bu_vote) > 0
2016-08-10 08:48:44  sql=

select bu_bug, count(1)
from bug_user 
where bu_vote = 1
group by bu_bug
2016-08-10 08:48:44  elapsed milliseconds:0000
2016-08-10 08:48:44  started creating Lucene index using folder C:\btnet364\www\App_Data\lucene_index
2016-08-10 08:48:44  sql=

/* get searchable cols */					
select sc.name
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
and st.[name] in ('nvarchar','varchar')
and sc.length > 30
2016-08-10 08:48:44  elapsed milliseconds:0000
2016-08-10 08:48:44  sql=

select bg_id, 	

isnull(bg_tags,'') bg_tags,
bg_short_desc
from bugs
2016-08-10 08:48:44  elapsed milliseconds:0000
2016-08-10 08:48:44  sql=

select bp_bug, bp_id, 
isnull(bp_comment_search,bp_comment) [text] 
from bug_posts 
where bp_type <> 'update'
and bp_hidden_from_external_users = 0
2016-08-10 08:48:44  elapsed milliseconds:0000
2016-08-10 08:48:44  done creating Lucene index
2016-08-10 08:48:49 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 08:48:49 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:48:49 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* custom columns */ select sc.name, st.[name] [datatype], 
case when st.[name] = 'nvarchar' or st.[name] = 'nchar' then sc.length/2 else sc.length end as [length], 
sc.xprec, sc.xscale, sc.isnullable,
mm.text [default value], 
dflts.name [default name], 
isnull(ccm_dropdown_type,'') [dropdown type],
isnull(ccm_dropdown_vals,'') [vals],
isnull(ccm_sort_seq, sc.colorder) [column order],
sc.colorder
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
left outer join syscomments mm on sc.cdefault = mm.id
left outer join custom_col_metadata on ccm_colorder = sc.colorder
left outer join sysobjects dflts on dflts.id = mm.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
order by sc.id, isnull(ccm_sort_seq,sc.colorder)
2016-08-10 08:48:49 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:48:49 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 08:48:49 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:48:49 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 08:48:49 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:48:49 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 08:48:49 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:48:49 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 08:48:49 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:48:49 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:48:49 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:49:18  threadproc_votes
2016-08-10 08:49:18  sql=

if exists (select * from dbo.sysobjects where id = object_id(N'[votes_view]'))
drop view [votes_view]
2016-08-10 08:49:18  sql=

create view votes_view as
select bu_bug as vote_bug, sum(bu_vote) as vote_total
from bug_user
group by bu_bug
having sum(bu_vote) > 0
2016-08-10 08:49:18  sql=

select bu_bug, count(1)
from bug_user 
where bu_vote = 1
group by bu_bug
2016-08-10 08:49:18  elapsed milliseconds:0000
2016-08-10 08:49:18  started creating Lucene index using folder C:\btnet364\www\App_Data\lucene_index
2016-08-10 08:49:18  sql=

/* get searchable cols */					
select sc.name
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
and st.[name] in ('nvarchar','varchar')
and sc.length > 30
2016-08-10 08:49:18  elapsed milliseconds:0000
2016-08-10 08:49:18  sql=

select bg_id, 	

isnull(bg_tags,'') bg_tags,
bg_short_desc
from bugs
2016-08-10 08:49:18  elapsed milliseconds:0000
2016-08-10 08:49:18  sql=

select bp_bug, bp_id, 
isnull(bp_comment_search,bp_comment) [text] 
from bug_posts 
where bp_type <> 'update'
and bp_hidden_from_external_users = 0
2016-08-10 08:49:18  elapsed milliseconds:0000
2016-08-10 08:49:18  done creating Lucene index
2016-08-10 08:49:23 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 08:49:23 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:49:23 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* custom columns */ select sc.name, st.[name] [datatype], 
case when st.[name] = 'nvarchar' or st.[name] = 'nchar' then sc.length/2 else sc.length end as [length], 
sc.xprec, sc.xscale, sc.isnullable,
mm.text [default value], 
dflts.name [default name], 
isnull(ccm_dropdown_type,'') [dropdown type],
isnull(ccm_dropdown_vals,'') [vals],
isnull(ccm_sort_seq, sc.colorder) [column order],
sc.colorder
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
left outer join syscomments mm on sc.cdefault = mm.id
left outer join custom_col_metadata on ccm_colorder = sc.colorder
left outer join sysobjects dflts on dflts.id = mm.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
order by sc.id, isnull(ccm_sort_seq,sc.colorder)
2016-08-10 08:49:23 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:49:23 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 08:49:23 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:49:23 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 08:49:23 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:49:23 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 08:49:23 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:49:23 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 08:49:23 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:49:23 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:49:23 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:51:34  threadproc_votes
2016-08-10 08:51:34  sql=

if exists (select * from dbo.sysobjects where id = object_id(N'[votes_view]'))
drop view [votes_view]
2016-08-10 08:51:34  sql=

create view votes_view as
select bu_bug as vote_bug, sum(bu_vote) as vote_total
from bug_user
group by bu_bug
having sum(bu_vote) > 0
2016-08-10 08:51:34  sql=

select bu_bug, count(1)
from bug_user 
where bu_vote = 1
group by bu_bug
2016-08-10 08:51:35  elapsed milliseconds:0000
2016-08-10 08:51:35  started creating Lucene index using folder C:\btnet364\www\App_Data\lucene_index
2016-08-10 08:51:35  sql=

/* get searchable cols */					
select sc.name
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
and st.[name] in ('nvarchar','varchar')
and sc.length > 30
2016-08-10 08:51:35  elapsed milliseconds:0000
2016-08-10 08:51:35  sql=

select bg_id, 	

isnull(bg_tags,'') bg_tags,
bg_short_desc
from bugs
2016-08-10 08:51:35  elapsed milliseconds:0000
2016-08-10 08:51:35  sql=

select bp_bug, bp_id, 
isnull(bp_comment_search,bp_comment) [text] 
from bug_posts 
where bp_type <> 'update'
and bp_hidden_from_external_users = 0
2016-08-10 08:51:35  elapsed milliseconds:0000
2016-08-10 08:51:35  done creating Lucene index
2016-08-10 08:51:39 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 08:51:39 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:51:39 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* custom columns */ select sc.name, st.[name] [datatype], 
case when st.[name] = 'nvarchar' or st.[name] = 'nchar' then sc.length/2 else sc.length end as [length], 
sc.xprec, sc.xscale, sc.isnullable,
mm.text [default value], 
dflts.name [default name], 
isnull(ccm_dropdown_type,'') [dropdown type],
isnull(ccm_dropdown_vals,'') [vals],
isnull(ccm_sort_seq, sc.colorder) [column order],
sc.colorder
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
left outer join syscomments mm on sc.cdefault = mm.id
left outer join custom_col_metadata on ccm_colorder = sc.colorder
left outer join sysobjects dflts on dflts.id = mm.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
order by sc.id, isnull(ccm_sort_seq,sc.colorder)
2016-08-10 08:51:39 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:51:39 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 08:51:39 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:51:39 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 08:51:39 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:51:39 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 08:51:39 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:51:39 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 08:51:39 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:51:39 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:51:39 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:55:10  threadproc_votes
2016-08-10 08:55:10  sql=

if exists (select * from dbo.sysobjects where id = object_id(N'[votes_view]'))
drop view [votes_view]
2016-08-10 08:55:10  sql=

create view votes_view as
select bu_bug as vote_bug, sum(bu_vote) as vote_total
from bug_user
group by bu_bug
having sum(bu_vote) > 0
2016-08-10 08:55:10  sql=

select bu_bug, count(1)
from bug_user 
where bu_vote = 1
group by bu_bug
2016-08-10 08:55:10  elapsed milliseconds:0000
2016-08-10 08:55:10  started creating Lucene index using folder C:\btnet364\www\App_Data\lucene_index
2016-08-10 08:55:10  sql=

/* get searchable cols */					
select sc.name
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
and st.[name] in ('nvarchar','varchar')
and sc.length > 30
2016-08-10 08:55:10  elapsed milliseconds:0000
2016-08-10 08:55:10  sql=

select bg_id, 	

isnull(bg_tags,'') bg_tags,
bg_short_desc
from bugs
2016-08-10 08:55:10  elapsed milliseconds:0000
2016-08-10 08:55:10  sql=

select bp_bug, bp_id, 
isnull(bp_comment_search,bp_comment) [text] 
from bug_posts 
where bp_type <> 'update'
and bp_hidden_from_external_users = 0
2016-08-10 08:55:10  elapsed milliseconds:0000
2016-08-10 08:55:10  done creating Lucene index
2016-08-10 08:55:15 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 08:55:15 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:55:15 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* custom columns */ select sc.name, st.[name] [datatype], 
case when st.[name] = 'nvarchar' or st.[name] = 'nchar' then sc.length/2 else sc.length end as [length], 
sc.xprec, sc.xscale, sc.isnullable,
mm.text [default value], 
dflts.name [default name], 
isnull(ccm_dropdown_type,'') [dropdown type],
isnull(ccm_dropdown_vals,'') [vals],
isnull(ccm_sort_seq, sc.colorder) [column order],
sc.colorder
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
left outer join syscomments mm on sc.cdefault = mm.id
left outer join custom_col_metadata on ccm_colorder = sc.colorder
left outer join sysobjects dflts on dflts.id = mm.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
order by sc.id, isnull(ccm_sort_seq,sc.colorder)
2016-08-10 08:55:15 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:55:15 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 08:55:15 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:55:15 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 08:55:15 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:55:15 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 08:55:15 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:55:15 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 08:55:15 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:55:15 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:55:15 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:57:08 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 08:57:08 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:57:08 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 08:57:08 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:57:08 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 08:57:08 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:57:08 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 08:57:08 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:57:08 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 08:57:08 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:57:08 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:57:08 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0001
2016-08-10 08:58:26  threadproc_votes
2016-08-10 08:58:26  sql=

if exists (select * from dbo.sysobjects where id = object_id(N'[votes_view]'))
drop view [votes_view]
2016-08-10 08:58:26  sql=

create view votes_view as
select bu_bug as vote_bug, sum(bu_vote) as vote_total
from bug_user
group by bu_bug
having sum(bu_vote) > 0
2016-08-10 08:58:26  sql=

select bu_bug, count(1)
from bug_user 
where bu_vote = 1
group by bu_bug
2016-08-10 08:58:26  elapsed milliseconds:0000
2016-08-10 08:58:26  started creating Lucene index using folder C:\btnet364\www\App_Data\lucene_index
2016-08-10 08:58:26  sql=

/* get searchable cols */					
select sc.name
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
and st.[name] in ('nvarchar','varchar')
and sc.length > 30
2016-08-10 08:58:26  elapsed milliseconds:0000
2016-08-10 08:58:26  sql=

select bg_id, 	

isnull(bg_tags,'') bg_tags,
bg_short_desc
from bugs
2016-08-10 08:58:26  elapsed milliseconds:0000
2016-08-10 08:58:26  sql=

select bp_bug, bp_id, 
isnull(bp_comment_search,bp_comment) [text] 
from bug_posts 
where bp_type <> 'update'
and bp_hidden_from_external_users = 0
2016-08-10 08:58:26  elapsed milliseconds:0000
2016-08-10 08:58:26  done creating Lucene index
2016-08-10 08:58:31 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 08:58:31 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:58:31 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* custom columns */ select sc.name, st.[name] [datatype], 
case when st.[name] = 'nvarchar' or st.[name] = 'nchar' then sc.length/2 else sc.length end as [length], 
sc.xprec, sc.xscale, sc.isnullable,
mm.text [default value], 
dflts.name [default name], 
isnull(ccm_dropdown_type,'') [dropdown type],
isnull(ccm_dropdown_vals,'') [vals],
isnull(ccm_sort_seq, sc.colorder) [column order],
sc.colorder
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
left outer join syscomments mm on sc.cdefault = mm.id
left outer join custom_col_metadata on ccm_colorder = sc.colorder
left outer join sysobjects dflts on dflts.id = mm.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
order by sc.id, isnull(ccm_sort_seq,sc.colorder)
2016-08-10 08:58:31 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:58:31 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 08:58:31 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:58:31 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 08:58:31 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:58:31 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 08:58:31 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:58:31 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 08:58:31 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 08:58:31 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 08:58:31 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:05:23  threadproc_votes
2016-08-10 09:05:23  sql=

if exists (select * from dbo.sysobjects where id = object_id(N'[votes_view]'))
drop view [votes_view]
2016-08-10 09:05:23  sql=

create view votes_view as
select bu_bug as vote_bug, sum(bu_vote) as vote_total
from bug_user
group by bu_bug
having sum(bu_vote) > 0
2016-08-10 09:05:23  sql=

select bu_bug, count(1)
from bug_user 
where bu_vote = 1
group by bu_bug
2016-08-10 09:05:23  elapsed milliseconds:0000
2016-08-10 09:05:23  started creating Lucene index using folder C:\btnet364\www\App_Data\lucene_index
2016-08-10 09:05:23  sql=

/* get searchable cols */					
select sc.name
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
and st.[name] in ('nvarchar','varchar')
and sc.length > 30
2016-08-10 09:05:23  elapsed milliseconds:0000
2016-08-10 09:05:23  sql=

select bg_id, 	

isnull(bg_tags,'') bg_tags,
bg_short_desc
from bugs
2016-08-10 09:05:23  elapsed milliseconds:0000
2016-08-10 09:05:24  sql=

select bp_bug, bp_id, 
isnull(bp_comment_search,bp_comment) [text] 
from bug_posts 
where bp_type <> 'update'
and bp_hidden_from_external_users = 0
2016-08-10 09:05:24  elapsed milliseconds:0000
2016-08-10 09:05:24  done creating Lucene index
2016-08-10 09:05:28 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 09:05:28 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:05:28 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* custom columns */ select sc.name, st.[name] [datatype], 
case when st.[name] = 'nvarchar' or st.[name] = 'nchar' then sc.length/2 else sc.length end as [length], 
sc.xprec, sc.xscale, sc.isnullable,
mm.text [default value], 
dflts.name [default name], 
isnull(ccm_dropdown_type,'') [dropdown type],
isnull(ccm_dropdown_vals,'') [vals],
isnull(ccm_sort_seq, sc.colorder) [column order],
sc.colorder
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
left outer join syscomments mm on sc.cdefault = mm.id
left outer join custom_col_metadata on ccm_colorder = sc.colorder
left outer join sysobjects dflts on dflts.id = mm.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
order by sc.id, isnull(ccm_sort_seq,sc.colorder)
2016-08-10 09:05:28 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:05:28 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 09:05:28 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:05:28 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 09:05:28 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:05:28 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 09:05:28 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:05:28 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 09:05:28 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:05:28 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 09:05:28 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:06:23  threadproc_votes
2016-08-10 09:06:23  sql=

if exists (select * from dbo.sysobjects where id = object_id(N'[votes_view]'))
drop view [votes_view]
2016-08-10 09:06:23  sql=

create view votes_view as
select bu_bug as vote_bug, sum(bu_vote) as vote_total
from bug_user
group by bu_bug
having sum(bu_vote) > 0
2016-08-10 09:06:23  sql=

select bu_bug, count(1)
from bug_user 
where bu_vote = 1
group by bu_bug
2016-08-10 09:06:23  elapsed milliseconds:0000
2016-08-10 09:06:23  started creating Lucene index using folder C:\btnet364\www\App_Data\lucene_index
2016-08-10 09:06:23  sql=

/* get searchable cols */					
select sc.name
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
and st.[name] in ('nvarchar','varchar')
and sc.length > 30
2016-08-10 09:06:23  elapsed milliseconds:0000
2016-08-10 09:06:23  sql=

select bg_id, 	

isnull(bg_tags,'') bg_tags,
bg_short_desc
from bugs
2016-08-10 09:06:23  elapsed milliseconds:0000
2016-08-10 09:06:23  sql=

select bp_bug, bp_id, 
isnull(bp_comment_search,bp_comment) [text] 
from bug_posts 
where bp_type <> 'update'
and bp_hidden_from_external_users = 0
2016-08-10 09:06:23  elapsed milliseconds:0000
2016-08-10 09:06:23  done creating Lucene index
2016-08-10 09:06:28 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 09:06:28 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0001
2016-08-10 09:06:28 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* custom columns */ select sc.name, st.[name] [datatype], 
case when st.[name] = 'nvarchar' or st.[name] = 'nchar' then sc.length/2 else sc.length end as [length], 
sc.xprec, sc.xscale, sc.isnullable,
mm.text [default value], 
dflts.name [default name], 
isnull(ccm_dropdown_type,'') [dropdown type],
isnull(ccm_dropdown_vals,'') [vals],
isnull(ccm_sort_seq, sc.colorder) [column order],
sc.colorder
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
left outer join syscomments mm on sc.cdefault = mm.id
left outer join custom_col_metadata on ccm_colorder = sc.colorder
left outer join sysobjects dflts on dflts.id = mm.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
order by sc.id, isnull(ccm_sort_seq,sc.colorder)
2016-08-10 09:06:28 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:06:28 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 09:06:28 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:06:28 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 09:06:28 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:06:28 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 09:06:28 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:06:28 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 09:06:28 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:06:28 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 09:06:28 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:07:30  threadproc_votes
2016-08-10 09:07:30  sql=

if exists (select * from dbo.sysobjects where id = object_id(N'[votes_view]'))
drop view [votes_view]
2016-08-10 09:07:30  sql=

create view votes_view as
select bu_bug as vote_bug, sum(bu_vote) as vote_total
from bug_user
group by bu_bug
having sum(bu_vote) > 0
2016-08-10 09:07:30  sql=

select bu_bug, count(1)
from bug_user 
where bu_vote = 1
group by bu_bug
2016-08-10 09:07:30  elapsed milliseconds:0000
2016-08-10 09:07:30  started creating Lucene index using folder C:\btnet364\www\App_Data\lucene_index
2016-08-10 09:07:30  sql=

/* get searchable cols */					
select sc.name
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
and st.[name] in ('nvarchar','varchar')
and sc.length > 30
2016-08-10 09:07:30  elapsed milliseconds:0000
2016-08-10 09:07:30  sql=

select bg_id, 	

isnull(bg_tags,'') bg_tags,
bg_short_desc
from bugs
2016-08-10 09:07:30  elapsed milliseconds:0000
2016-08-10 09:07:30  sql=

select bp_bug, bp_id, 
isnull(bp_comment_search,bp_comment) [text] 
from bug_posts 
where bp_type <> 'update'
and bp_hidden_from_external_users = 0
2016-08-10 09:07:30  elapsed milliseconds:0001
2016-08-10 09:07:30  done creating Lucene index
2016-08-10 09:07:34 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 09:07:34 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:07:34 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* custom columns */ select sc.name, st.[name] [datatype], 
case when st.[name] = 'nvarchar' or st.[name] = 'nchar' then sc.length/2 else sc.length end as [length], 
sc.xprec, sc.xscale, sc.isnullable,
mm.text [default value], 
dflts.name [default name], 
isnull(ccm_dropdown_type,'') [dropdown type],
isnull(ccm_dropdown_vals,'') [vals],
isnull(ccm_sort_seq, sc.colorder) [column order],
sc.colorder
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
left outer join syscomments mm on sc.cdefault = mm.id
left outer join custom_col_metadata on ccm_colorder = sc.colorder
left outer join sysobjects dflts on dflts.id = mm.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
order by sc.id, isnull(ccm_sort_seq,sc.colorder)
2016-08-10 09:07:34 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:07:34 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 09:07:34 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:07:34 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 09:07:34 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:07:34 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 09:07:34 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:07:35 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 09:07:35 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:07:35 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 09:07:35 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:09:52  threadproc_votes
2016-08-10 09:09:52  sql=

if exists (select * from dbo.sysobjects where id = object_id(N'[votes_view]'))
drop view [votes_view]
2016-08-10 09:09:52  sql=

create view votes_view as
select bu_bug as vote_bug, sum(bu_vote) as vote_total
from bug_user
group by bu_bug
having sum(bu_vote) > 0
2016-08-10 09:09:52  sql=

select bu_bug, count(1)
from bug_user 
where bu_vote = 1
group by bu_bug
2016-08-10 09:09:52  elapsed milliseconds:0000
2016-08-10 09:09:52  started creating Lucene index using folder C:\btnet364\www\App_Data\lucene_index
2016-08-10 09:09:52  sql=

/* get searchable cols */					
select sc.name
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
and st.[name] in ('nvarchar','varchar')
and sc.length > 30
2016-08-10 09:09:52  elapsed milliseconds:0000
2016-08-10 09:09:52  sql=

select bg_id, 	

isnull(bg_tags,'') bg_tags,
bg_short_desc
from bugs
2016-08-10 09:09:52  elapsed milliseconds:0000
2016-08-10 09:09:52  sql=

select bp_bug, bp_id, 
isnull(bp_comment_search,bp_comment) [text] 
from bug_posts 
where bp_type <> 'update'
and bp_hidden_from_external_users = 0
2016-08-10 09:09:52  elapsed milliseconds:0000
2016-08-10 09:09:52  done creating Lucene index
2016-08-10 09:09:56 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 09:09:56 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:09:56 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* custom columns */ select sc.name, st.[name] [datatype], 
case when st.[name] = 'nvarchar' or st.[name] = 'nchar' then sc.length/2 else sc.length end as [length], 
sc.xprec, sc.xscale, sc.isnullable,
mm.text [default value], 
dflts.name [default name], 
isnull(ccm_dropdown_type,'') [dropdown type],
isnull(ccm_dropdown_vals,'') [vals],
isnull(ccm_sort_seq, sc.colorder) [column order],
sc.colorder
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
left outer join syscomments mm on sc.cdefault = mm.id
left outer join custom_col_metadata on ccm_colorder = sc.colorder
left outer join sysobjects dflts on dflts.id = mm.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
order by sc.id, isnull(ccm_sort_seq,sc.colorder)
2016-08-10 09:09:56 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:09:56 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 09:09:57 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:09:57 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 09:09:57 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:09:57 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 09:09:57 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:09:57 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 09:09:57 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:09:57 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 09:09:57 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:12:42  threadproc_votes
2016-08-10 09:12:42  sql=

if exists (select * from dbo.sysobjects where id = object_id(N'[votes_view]'))
drop view [votes_view]
2016-08-10 09:12:42  sql=

create view votes_view as
select bu_bug as vote_bug, sum(bu_vote) as vote_total
from bug_user
group by bu_bug
having sum(bu_vote) > 0
2016-08-10 09:12:42  sql=

select bu_bug, count(1)
from bug_user 
where bu_vote = 1
group by bu_bug
2016-08-10 09:12:42  elapsed milliseconds:0000
2016-08-10 09:12:42  started creating Lucene index using folder C:\btnet364\www\App_Data\lucene_index
2016-08-10 09:12:42  sql=

/* get searchable cols */					
select sc.name
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
and st.[name] in ('nvarchar','varchar')
and sc.length > 30
2016-08-10 09:12:42  elapsed milliseconds:0000
2016-08-10 09:12:42  sql=

select bg_id, 	

isnull(bg_tags,'') bg_tags,
bg_short_desc
from bugs
2016-08-10 09:12:42  elapsed milliseconds:0000
2016-08-10 09:12:42  sql=

select bp_bug, bp_id, 
isnull(bp_comment_search,bp_comment) [text] 
from bug_posts 
where bp_type <> 'update'
and bp_hidden_from_external_users = 0
2016-08-10 09:12:42  elapsed milliseconds:0000
2016-08-10 09:12:42  done creating Lucene index
2016-08-10 09:12:46 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 09:12:46 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:12:46 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* custom columns */ select sc.name, st.[name] [datatype], 
case when st.[name] = 'nvarchar' or st.[name] = 'nchar' then sc.length/2 else sc.length end as [length], 
sc.xprec, sc.xscale, sc.isnullable,
mm.text [default value], 
dflts.name [default name], 
isnull(ccm_dropdown_type,'') [dropdown type],
isnull(ccm_dropdown_vals,'') [vals],
isnull(ccm_sort_seq, sc.colorder) [column order],
sc.colorder
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
left outer join syscomments mm on sc.cdefault = mm.id
left outer join custom_col_metadata on ccm_colorder = sc.colorder
left outer join sysobjects dflts on dflts.id = mm.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
order by sc.id, isnull(ccm_sort_seq,sc.colorder)
2016-08-10 09:12:46 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:12:46 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 09:12:46 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:12:46 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 09:12:46 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0001
2016-08-10 09:12:46 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 09:12:46 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:12:46 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 09:12:46 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:12:46 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 09:12:46 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:40:21  threadproc_votes
2016-08-10 09:40:21  sql=

if exists (select * from dbo.sysobjects where id = object_id(N'[votes_view]'))
drop view [votes_view]
2016-08-10 09:40:21  sql=

create view votes_view as
select bu_bug as vote_bug, sum(bu_vote) as vote_total
from bug_user
group by bu_bug
having sum(bu_vote) > 0
2016-08-10 09:40:21  sql=

select bu_bug, count(1)
from bug_user 
where bu_vote = 1
group by bu_bug
2016-08-10 09:40:21  elapsed milliseconds:0000
2016-08-10 09:40:22  started creating Lucene index using folder C:\btnet364\www\App_Data\lucene_index
2016-08-10 09:40:22  sql=

/* get searchable cols */					
select sc.name
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
and st.[name] in ('nvarchar','varchar')
and sc.length > 30
2016-08-10 09:40:22  elapsed milliseconds:0000
2016-08-10 09:40:22  sql=

select bg_id, 	

isnull(bg_tags,'') bg_tags,
bg_short_desc
from bugs
2016-08-10 09:40:22  elapsed milliseconds:0000
2016-08-10 09:40:22  sql=

select bp_bug, bp_id, 
isnull(bp_comment_search,bp_comment) [text] 
from bug_posts 
where bp_type <> 'update'
and bp_hidden_from_external_users = 0
2016-08-10 09:40:22  elapsed milliseconds:0000
2016-08-10 09:40:22  done creating Lucene index
2016-08-10 09:40:26 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 09:40:26 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:40:26 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* custom columns */ select sc.name, st.[name] [datatype], 
case when st.[name] = 'nvarchar' or st.[name] = 'nchar' then sc.length/2 else sc.length end as [length], 
sc.xprec, sc.xscale, sc.isnullable,
mm.text [default value], 
dflts.name [default name], 
isnull(ccm_dropdown_type,'') [dropdown type],
isnull(ccm_dropdown_vals,'') [vals],
isnull(ccm_sort_seq, sc.colorder) [column order],
sc.colorder
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
left outer join syscomments mm on sc.cdefault = mm.id
left outer join custom_col_metadata on ccm_colorder = sc.colorder
left outer join sysobjects dflts on dflts.id = mm.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
order by sc.id, isnull(ccm_sort_seq,sc.colorder)
2016-08-10 09:40:26 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:40:26 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 09:40:26 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:40:26 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 09:40:26 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:40:26 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 09:40:26 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:40:26 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 09:40:26 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:40:26 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 09:40:26 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:44:16 http://192.168.6.173/admin.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 09:44:16 http://192.168.6.173/admin.aspx elapsed milliseconds:0000
2016-08-10 09:44:16 http://192.168.6.173/admin.aspx sql=
select count(1) from bugs
2016-08-10 09:44:20 http://192.168.6.173/edit_self.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 09:44:20 http://192.168.6.173/edit_self.aspx elapsed milliseconds:0000
2016-08-10 09:44:20 http://192.168.6.173/edit_self.aspx sql=
declare @org int
			select @org = us_org from users where us_id = 1

			select qu_id, qu_desc
			from queries
			where (isnull(qu_user,0) = 0 and isnull(qu_org,0) = 0)
			or isnull(qu_user,0) = 1
			or isnull(qu_org,0) = @org
			order by qu_desc
2016-08-10 09:44:20 http://192.168.6.173/edit_self.aspx elapsed milliseconds:0002
2016-08-10 09:44:20 http://192.168.6.173/edit_self.aspx sql=
select pj_id, pj_name, isnull(pu_auto_subscribe,0) [pu_auto_subscribe]
			from projects
			left outer join project_user_xref on pj_id = pu_project and 1 = pu_user
			where isnull(pu_permission_level,2) <> 0
			order by pj_name
2016-08-10 09:44:20 http://192.168.6.173/edit_self.aspx elapsed milliseconds:0002
2016-08-10 09:44:20 http://192.168.6.173/edit_self.aspx sql=
select
			us_username [username],
			isnull(us_firstname,'') [firstname],
			isnull(us_lastname,'') [lastname],
			isnull(us_bugs_per_page,10) [us_bugs_per_page],
			us_use_fckeditor,
			us_enable_bug_list_popups,
			isnull(us_email,'') [email],
			us_enable_notifications,
			us_send_notifications_to_self,
            us_reported_notifications,
            us_assigned_notifications,
            us_subscribed_notifications,
			us_auto_subscribe,
			us_auto_subscribe_own_bugs,
			us_auto_subscribe_reported_bugs,
			us_default_query,
			isnull(us_signature,'') [signature]
			from users
			where us_id = 1
2016-08-10 09:44:20 http://192.168.6.173/edit_self.aspx elapsed milliseconds:0001
2016-08-10 09:44:31 http://192.168.6.173/admin.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 09:44:31 http://192.168.6.173/admin.aspx elapsed milliseconds:0000
2016-08-10 09:44:31 http://192.168.6.173/admin.aspx sql=
select count(1) from bugs
2016-08-10 09:44:33 http://192.168.6.173/bugs.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 09:44:33 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 09:44:33 http://192.168.6.173/bugs.aspx sql=
/* query dropdown */
select qu_id, qu_desc
from queries
where (isnull(qu_user,0) = 0 and isnull(qu_org,0) = 0)
or isnull(qu_user,0) = 1
or isnull(qu_org,0) = 6
order by qu_desc
2016-08-10 09:44:33 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 09:44:33 http://192.168.6.173/bugs.aspx sql=
select qu_id, qu_sql from queries where qu_id in
			(select us_default_query from users where us_id = 1)
2016-08-10 09:44:33 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 09:44:33 http://192.168.6.173/bugs.aspx sql=
select isnull(pr_background_color,'#ffffff'), bg_id [id], isnull(bu_flag,0) [$FLAG], 
 bg_short_desc [desc], isnull(pj_name,'') [project], isnull(og_name,'') [organization], isnull(ct_name,'') [category], rpt.us_username [reported by],
 bg_reported_date [reported on], isnull(pr_name,'') [priority], isnull(asg.us_username,'') [assigned to],
 isnull(st_name,'') [status], isnull(lu.us_username,'') [last updated by], bg_last_updated_date [last updated on]
 from bugs 
 left outer join bug_user on bu_bug = bg_id and bu_user = 1 
 left outer join users rpt on rpt.us_id = bg_reported_user
 left outer join users asg on asg.us_id = bg_assigned_to_user
 left outer join users lu on lu.us_id = bg_last_updated_user
 left outer join projects on pj_id = bg_project
 left outer join orgs on og_id = bg_org
 left outer join categories on ct_id = bg_category
 left outer join priorities on pr_id = bg_priority
 left outer join statuses on st_id = bg_status
  /* altered - just order by  */ WHERE  (bugs.bg_project not in (
					select pu_project
					from project_user_xref
					where pu_user = 1
					and pu_permission_level = 0)) order by bg_id desc
2016-08-10 09:44:33 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 09:44:45 http://192.168.6.173/ajax.aspx?bugid=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 09:44:45 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 09:44:45 http://192.168.6.173/ajax.aspx?bugid=1 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 1
2016-08-10 09:44:45 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 09:44:45 http://192.168.6.173/ajax.aspx?bugid=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 09:44:45 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 09:44:45 http://192.168.6.173/ajax.aspx?bugid=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 09:44:45 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 09:44:45 http://192.168.6.173/ajax.aspx?bugid=1 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 1
2016-08-10 09:44:45 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 09:44:45 http://192.168.6.173/ajax.aspx?bugid=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 09:44:45 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 09:44:45 http://192.168.6.173/ajax.aspx?bugid=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 09:44:45 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 09:44:45 http://192.168.6.173/ajax.aspx?bugid=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 09:44:45 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 09:44:45 http://192.168.6.173/ajax.aspx?bugid=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 09:44:45 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 09:44:46 http://192.168.6.173/edit_bug.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 09:44:46 http://192.168.6.173/edit_bug.aspx elapsed milliseconds:0000
2016-08-10 09:44:46 http://192.168.6.173/edit_bug.aspx sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 09:44:46 http://192.168.6.173/edit_bug.aspx elapsed milliseconds:0000
2016-08-10 09:44:46 http://192.168.6.173/edit_bug.aspx sql=

select top 1 pj_id from projects where pj_default = 1 order by pj_name;
select top 1 ct_id from categories where ct_default = 1 order by ct_name;
select top 1 pr_id from priorities where pr_default = 1 order by pr_name;
select top 1 st_id from statuses where st_default = 1 order by st_name;
select top 1 udf_id from user_defined_attribute where udf_default = 1 order by udf_name;
2016-08-10 09:44:46 http://192.168.6.173/edit_bug.aspx elapsed milliseconds:0000
2016-08-10 09:44:46 http://192.168.6.173/edit_bug.aspx sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 09:44:46 http://192.168.6.173/edit_bug.aspx elapsed milliseconds:0000
2016-08-10 09:44:46 http://192.168.6.173/edit_bug.aspx sql=
select isnull(pj_default_user,0)
					from projects
					where pj_id = 3
2016-08-10 09:44:46 http://192.168.6.173/edit_bug.aspx sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 09:44:46 http://192.168.6.173/edit_bug.aspx elapsed milliseconds:0000
2016-08-10 09:57:40  threadproc_votes
2016-08-10 09:57:40  sql=

if exists (select * from dbo.sysobjects where id = object_id(N'[votes_view]'))
drop view [votes_view]
2016-08-10 09:57:40  sql=

create view votes_view as
select bu_bug as vote_bug, sum(bu_vote) as vote_total
from bug_user
group by bu_bug
having sum(bu_vote) > 0
2016-08-10 09:57:40  sql=

select bu_bug, count(1)
from bug_user 
where bu_vote = 1
group by bu_bug
2016-08-10 09:57:40  elapsed milliseconds:0000
2016-08-10 09:57:40  started creating Lucene index using folder C:\btnet364\www\App_Data\lucene_index
2016-08-10 09:57:40  sql=

/* get searchable cols */					
select sc.name
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
and st.[name] in ('nvarchar','varchar')
and sc.length > 30
2016-08-10 09:57:40  elapsed milliseconds:0000
2016-08-10 09:57:40  sql=

select bg_id, 	

isnull(bg_tags,'') bg_tags,
bg_short_desc
from bugs
2016-08-10 09:57:40  elapsed milliseconds:0000
2016-08-10 09:57:40  sql=

select bp_bug, bp_id, 
isnull(bp_comment_search,bp_comment) [text] 
from bug_posts 
where bp_type <> 'update'
and bp_hidden_from_external_users = 0
2016-08-10 09:57:40  elapsed milliseconds:0000
2016-08-10 09:57:40  done creating Lucene index
2016-08-10 09:57:44 http://192.168.6.173/bugs.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 09:57:44 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 09:57:44 http://192.168.6.173/bugs.aspx sql=

/* custom columns */ select sc.name, st.[name] [datatype], 
case when st.[name] = 'nvarchar' or st.[name] = 'nchar' then sc.length/2 else sc.length end as [length], 
sc.xprec, sc.xscale, sc.isnullable,
mm.text [default value], 
dflts.name [default name], 
isnull(ccm_dropdown_type,'') [dropdown type],
isnull(ccm_dropdown_vals,'') [vals],
isnull(ccm_sort_seq, sc.colorder) [column order],
sc.colorder
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
left outer join syscomments mm on sc.cdefault = mm.id
left outer join custom_col_metadata on ccm_colorder = sc.colorder
left outer join sysobjects dflts on dflts.id = mm.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
order by sc.id, isnull(ccm_sort_seq,sc.colorder)
2016-08-10 09:57:44 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 09:57:44 http://192.168.6.173/bugs.aspx sql=
/* query dropdown */
select qu_id, qu_desc
from queries
where (isnull(qu_user,0) = 0 and isnull(qu_org,0) = 0)
or isnull(qu_user,0) = 1
or isnull(qu_org,0) = 6
order by qu_desc
2016-08-10 09:57:44 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 09:57:44 http://192.168.6.173/bugs.aspx sql=
select qu_id, qu_sql from queries where qu_id in
			(select us_default_query from users where us_id = 1)
2016-08-10 09:57:44 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 09:57:44 http://192.168.6.173/bugs.aspx sql=
select isnull(pr_background_color,'#ffffff'), bg_id [id], isnull(bu_flag,0) [$FLAG], 
 bg_short_desc [desc], isnull(pj_name,'') [project], isnull(og_name,'') [organization], isnull(ct_name,'') [category], rpt.us_username [reported by],
 bg_reported_date [reported on], isnull(pr_name,'') [priority], isnull(asg.us_username,'') [assigned to],
 isnull(st_name,'') [status], isnull(lu.us_username,'') [last updated by], bg_last_updated_date [last updated on]
 from bugs 
 left outer join bug_user on bu_bug = bg_id and bu_user = 1 
 left outer join users rpt on rpt.us_id = bg_reported_user
 left outer join users asg on asg.us_id = bg_assigned_to_user
 left outer join users lu on lu.us_id = bg_last_updated_user
 left outer join projects on pj_id = bg_project
 left outer join orgs on og_id = bg_org
 left outer join categories on ct_id = bg_category
 left outer join priorities on pr_id = bg_priority
 left outer join statuses on st_id = bg_status
  /* altered - just order by  */ WHERE  (bugs.bg_project not in (
					select pu_project
					from project_user_xref
					where pu_user = 1
					and pu_permission_level = 0)) order by bg_id desc
2016-08-10 09:57:44 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 09:58:21 http://192.168.6.173/ajax.aspx?bugid=4 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 09:58:21 http://192.168.6.173/ajax.aspx?bugid=4 elapsed milliseconds:0000
2016-08-10 09:58:21 http://192.168.6.173/ajax.aspx?bugid=4 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 4
2016-08-10 09:58:21 http://192.168.6.173/ajax.aspx?bugid=4 elapsed milliseconds:0000
2016-08-10 09:58:21 http://192.168.6.173/ajax.aspx?bugid=4 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 4
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 09:58:21 http://192.168.6.173/ajax.aspx?bugid=4 elapsed milliseconds:0000
2016-08-10 09:58:22 http://192.168.6.173/ajax.aspx?bugid=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 09:58:22 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 09:58:22 http://192.168.6.173/ajax.aspx?bugid=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 09:58:22 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 09:58:22 http://192.168.6.173/ajax.aspx?bugid=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 09:58:22 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 09:58:23 http://192.168.6.173/edit_bug.aspx?id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 09:58:23 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 09:58:23 http://192.168.6.173/edit_bug.aspx?id=5 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 5
2016-08-10 09:58:23 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 09:58:23 http://192.168.6.173/edit_bug.aspx?id=5 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 09:58:23 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 09:58:23 http://192.168.6.173/edit_bug.aspx?id=5 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 09:58:23 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 09:58:23 http://192.168.6.173/edit_bug.aspx?id=5 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 09:58:23 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 09:58:23 http://192.168.6.173/edit_bug.aspx?id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 09:58:23 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 09:58:28 http://192.168.6.173/edit_bug.aspx?id=4 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 09:58:28 http://192.168.6.173/edit_bug.aspx?id=4 elapsed milliseconds:0000
2016-08-10 09:58:28 http://192.168.6.173/edit_bug.aspx?id=4 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 4
2016-08-10 09:58:28 http://192.168.6.173/edit_bug.aspx?id=4 elapsed milliseconds:0000
2016-08-10 09:58:28 http://192.168.6.173/edit_bug.aspx?id=4 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 09:58:28 http://192.168.6.173/edit_bug.aspx?id=4 elapsed milliseconds:0000
2016-08-10 09:58:28 http://192.168.6.173/edit_bug.aspx?id=4 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 09:58:28 http://192.168.6.173/edit_bug.aspx?id=4 elapsed milliseconds:0000
2016-08-10 09:58:28 http://192.168.6.173/edit_bug.aspx?id=4 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 09:58:28 http://192.168.6.173/edit_bug.aspx?id=4 elapsed milliseconds:0000
2016-08-10 09:58:28 http://192.168.6.173/edit_bug.aspx?id=4 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 4
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 09:58:28 http://192.168.6.173/edit_bug.aspx?id=4 elapsed milliseconds:0000
2016-08-10 09:58:29 http://192.168.6.173/edit_bug.aspx?id=3 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 09:58:29 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 09:58:29 http://192.168.6.173/edit_bug.aspx?id=3 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 3
2016-08-10 09:58:29 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0025
2016-08-10 09:58:29 http://192.168.6.173/edit_bug.aspx?id=3 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 09:58:29 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 09:58:29 http://192.168.6.173/edit_bug.aspx?id=3 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 4
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 09:58:29 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0007
2016-08-10 09:58:29 http://192.168.6.173/edit_bug.aspx?id=3 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 4
2016-08-10 09:58:29 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0001
2016-08-10 09:58:29 http://192.168.6.173/edit_bug.aspx?id=3 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 3
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 09:58:29 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0008
2016-08-10 09:58:30 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 09:58:30 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:58:30 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 09:58:30 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:58:30 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 09:58:30 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0001
2016-08-10 09:58:30 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 09:58:30 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:58:30 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 09:58:30 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 09:58:30 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 09:58:30 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:00:34 http://192.168.6.173/edit_bug.aspx?id=3 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:00:34 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:00:34 http://192.168.6.173/edit_bug.aspx?id=3 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 3
2016-08-10 10:00:34 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:00:34 http://192.168.6.173/edit_bug.aspx?id=3 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 10:00:34 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:00:34 http://192.168.6.173/edit_bug.aspx?id=3 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 4
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 10:00:34 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:00:34 http://192.168.6.173/edit_bug.aspx?id=3 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 4
2016-08-10 10:00:34 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:00:34 http://192.168.6.173/edit_bug.aspx?id=3 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 3
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:00:34 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:00:35 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:00:35 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:00:35 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 10:00:35 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:00:35 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 10:00:35 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:00:35 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 10:00:35 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:00:35 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 10:00:35 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:00:35 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:00:35 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 13:04:30 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 13:04:30 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 13:04:30 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 13:04:30 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 13:04:30 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* validate org versus assigned_to */
select case when og_other_orgs_permission_level <> 0
or 6 = og_id then 1
else 0 end as [answer]
from users
inner join orgs on us_org = og_id
where us_id = 10
2016-08-10 13:04:30 http://192.168.6.173/edit_bug.aspx?id=1 sql=
declare @permission_level int
		set @permission_level = -1
		select @permission_level = isnull(pu_permission_level,2)
		from project_user_xref
		where pu_project = 3
		and pu_user = 1
		if @permission_level = -1 set @permission_level = 2
		select @permission_level
2016-08-10 13:04:30 http://192.168.6.173/edit_bug.aspx?id=1 sql=
declare @now datetime
		declare @last_updated datetime
		select @last_updated = bg_last_updated_date from bugs where bg_id = 1
		if @last_updated > '20160810 10:00:35:653'
		begin
			-- signal that we did NOT do the update
			set @now = '20160810 10:00:35:653'
		end
		else
		begin
			-- signal that we DID do the update
			set @now = getdate()

			update bugs set
			bg_short_desc = N'Лишнее событие у изделия типа ''протяжка''',
			bg_tags = N'',
			bg_project = 3,
			bg_org = 6,
			bg_category = 1,
			bg_priority = 2,
			bg_assigned_to_user = 10,
			bg_status = 3,
			bg_last_updated_user = 1,
			bg_last_updated_date = @now,
			bg_user_defined_attribute = 0
            ,
bg_project_custom_dropdown_value1 = N'',
bg_project_custom_dropdown_value2 = N'',
bg_project_custom_dropdown_value3 = N''
	
			
			where bg_id = 1
		end
		select @now
2016-08-10 13:04:30 http://192.168.6.173/edit_bug.aspx?id=1 sql=

declare @pj int
select @pj = bg_project from bugs where bg_id = 1

delete from bug_subscriptions
where bs_bug = 1
and bs_user in
(select x.pu_user
from projects
left outer join project_user_xref x on pu_project = pj_id
where pu_project = @pj
and isnull(pu_permission_level,2) = 0)

delete from bug_subscriptions
where bs_bug = 1
and bs_user in
(select us_id from users
 inner join orgs on us_org = og_id
 inner join bugs on bg_id = 1
 where og_other_orgs_permission_level = 0
 and bg_org <> og_id)

insert into bug_subscriptions (bs_bug, bs_user)
select 1, us_id
from users
inner join orgs on us_org = og_id
inner join bugs on bg_id = 1
left outer join project_user_xref on pu_project = @pj and pu_user = us_id
where us_auto_subscribe = 1
and
case
	when
		us_org <> bg_org
		and og_other_orgs_permission_level < 2
		and og_other_orgs_permission_level < isnull(pu_permission_level,2)
			then og_other_orgs_permission_level
	else
		isnull(pu_permission_level,2)
end <> 0
and us_active = 1
and us_id not in
(select bs_user from bug_subscriptions
where bs_bug = 1)

insert into bug_subscriptions (bs_bug, bs_user)
select 1, pj_default_user
from projects
inner join users on pj_default_user = us_id
where pj_id = @pj
and pj_default_user <> 0
and pj_auto_subscribe_default_user = 1
and us_active = 1
and pj_default_user not in
(select bs_user from bug_subscriptions
where bs_bug = 1)

insert into bug_subscriptions (bs_bug, bs_user)
select 1, pu_user from project_user_xref
inner join users on pu_user = us_id
inner join orgs on us_org = og_id
inner join bugs on bg_id = 1
where pu_auto_subscribe = 1
and
case
	when
		us_org <> bg_org
		and og_other_orgs_permission_level < 2
		and og_other_orgs_permission_level < isnull(pu_permission_level,2)
			then og_other_orgs_permission_level
	else
		isnull(pu_permission_level,2)
end <> 0
and us_active = 1
and pu_project = @pj
and pu_user not in
(select bs_user from bug_subscriptions
where bs_bug = 1)

insert into bug_subscriptions (bs_bug, bs_user)
select 1, us_id
from users
inner join bugs on bg_id = 1
inner join orgs on us_org = og_id
left outer join project_user_xref on pu_project = @pj and pu_user = us_id
where ((us_auto_subscribe_own_bugs = 1 and bg_assigned_to_user = us_id)
or
(us_auto_subscribe_reported_bugs = 1 and bg_reported_user = us_id))
and
case
	when
		us_org <> bg_org
		and og_other_orgs_permission_level < 2
		and og_other_orgs_permission_level < isnull(pu_permission_level,2)
			then og_other_orgs_permission_level
	else
		isnull(pu_permission_level,2)
end <> 0
and us_active = 1
and us_id not in
(select bs_user from bug_subscriptions
where bs_bug = 1)
2016-08-10 13:04:30 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select count(1) from bug_subscriptions where bs_bug = 1 and bs_user = 1
2016-08-10 13:04:30 http://192.168.6.173/edit_bug.aspx?id=1 sql=

declare @now datetime
set @now = getdate()

insert into bug_posts
(bp_bug, bp_user, bp_date, bp_comment, bp_comment_search, bp_email_from, bp_email_cc, bp_type, bp_content_type,
bp_hidden_from_external_users)
values(
1,
1,
@now,
N'ghjdthrf',
N'ghjdthrf',
null,
N'',
N'comment',
N'text/plain',
0)
select scope_identity();
2016-08-10 13:04:30 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get notification emails for all subscribers */
select us_email, us_id, us_admin, og.*
from bug_subscriptions
inner join users on bs_user = us_id
inner join orgs og on us_org = og_id
inner join bugs on bg_id = bs_bug
left outer join project_user_xref on pu_user = us_id and pu_project = bg_project
where us_email is not null
and us_enable_notifications = 1
-- $status_change
and us_active = 1
and us_email <> ''
and (   (4 <= us_reported_notifications and bg_reported_user = bs_user)
or (4 <= us_assigned_notifications and bg_assigned_to_user = bs_user)
or (4 <= us_assigned_notifications and 10 = bs_user)
or (4 <= us_subscribed_notifications))
and
case
when
us_org <> bg_org
and og_other_orgs_permission_level < 2
and og_other_orgs_permission_level < isnull(pu_permission_level,2)
	then og_other_orgs_permission_level
else
isnull(pu_permission_level,2)
end <> 0
and bs_bug = 1
and (us_id <> 1 or isnull(us_send_notifications_to_self,0) = 1)
2016-08-10 13:04:30  started updating Lucene index using folder C:\btnet364\www\App_Data\lucene_index
2016-08-10 13:04:30 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0015
2016-08-10 13:04:30 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 13:04:30 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 13:04:30 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 13:04:30 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 13:04:30 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 13:04:30 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 13:04:30  sql=

/* get searchable cols */					
select sc.name
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
and st.[name] in ('nvarchar','varchar')
and sc.length > 30
2016-08-10 13:04:30  elapsed milliseconds:0000
2016-08-10 13:04:30  sql=

select bg_id, 

isnull(bg_tags,'') bg_tags,
bg_short_desc    
from bugs where bg_id = 1
2016-08-10 13:04:30  elapsed milliseconds:0001
2016-08-10 13:04:30  sql=

select bp_bug, bp_id, 
isnull(bp_comment_search,bp_comment) [text] 
from bug_posts 
where bp_type <> 'update'
and bp_hidden_from_external_users = 0
and bp_bug = 1
2016-08-10 13:04:30  elapsed milliseconds:0015
2016-08-10 13:04:31  done updating Lucene index
2016-08-10 10:10:37  threadproc_votes
2016-08-10 10:10:37  sql=

if exists (select * from dbo.sysobjects where id = object_id(N'[votes_view]'))
drop view [votes_view]
2016-08-10 10:10:37  sql=

create view votes_view as
select bu_bug as vote_bug, sum(bu_vote) as vote_total
from bug_user
group by bu_bug
having sum(bu_vote) > 0
2016-08-10 10:10:37  sql=

select bu_bug, count(1)
from bug_user 
where bu_vote = 1
group by bu_bug
2016-08-10 10:10:37  elapsed milliseconds:0003
2016-08-10 10:10:37  started creating Lucene index using folder C:\btnet364\www\App_Data\lucene_index
2016-08-10 10:10:38  sql=

/* get searchable cols */					
select sc.name
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
and st.[name] in ('nvarchar','varchar')
and sc.length > 30
2016-08-10 10:10:38  elapsed milliseconds:0000
2016-08-10 10:10:38  sql=

select bg_id, 	

isnull(bg_tags,'') bg_tags,
bg_short_desc
from bugs
2016-08-10 10:10:38  elapsed milliseconds:0000
2016-08-10 10:10:38  sql=

select bp_bug, bp_id, 
isnull(bp_comment_search,bp_comment) [text] 
from bug_posts 
where bp_type <> 'update'
and bp_hidden_from_external_users = 0
2016-08-10 10:10:38  elapsed milliseconds:0000
2016-08-10 10:10:38  done creating Lucene index
2016-08-10 10:10:42 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:10:42 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:10:42 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* custom columns */ select sc.name, st.[name] [datatype], 
case when st.[name] = 'nvarchar' or st.[name] = 'nchar' then sc.length/2 else sc.length end as [length], 
sc.xprec, sc.xscale, sc.isnullable,
mm.text [default value], 
dflts.name [default name], 
isnull(ccm_dropdown_type,'') [dropdown type],
isnull(ccm_dropdown_vals,'') [vals],
isnull(ccm_sort_seq, sc.colorder) [column order],
sc.colorder
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
left outer join syscomments mm on sc.cdefault = mm.id
left outer join custom_col_metadata on ccm_colorder = sc.colorder
left outer join sysobjects dflts on dflts.id = mm.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
order by sc.id, isnull(ccm_sort_seq,sc.colorder)
2016-08-10 10:10:42 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:10:42 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 10:10:42 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:10:42 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* validate org versus assigned_to */
select case when og_other_orgs_permission_level <> 0
or 6 = og_id then 1
else 0 end as [answer]
from users
inner join orgs on us_org = og_id
where us_id = 10
2016-08-10 10:10:42 http://192.168.6.173/edit_bug.aspx?id=1 sql=
declare @permission_level int
		set @permission_level = -1
		select @permission_level = isnull(pu_permission_level,2)
		from project_user_xref
		where pu_project = 3
		and pu_user = 1
		if @permission_level = -1 set @permission_level = 2
		select @permission_level
2016-08-10 10:10:42 http://192.168.6.173/edit_bug.aspx?id=1 sql=
declare @now datetime
		declare @last_updated datetime
		select @last_updated = bg_last_updated_date from bugs where bg_id = 1
		if @last_updated > '20160810 10:00:35:653'
		begin
			-- signal that we did NOT do the update
			set @now = '20160810 10:00:35:653'
		end
		else
		begin
			-- signal that we DID do the update
			set @now = getdate()

			update bugs set
			bg_short_desc = N'Лишнее событие у изделия типа ''протяжка''',
			bg_tags = N'',
			bg_project = 3,
			bg_org = 6,
			bg_category = 1,
			bg_priority = 2,
			bg_assigned_to_user = 10,
			bg_status = 3,
			bg_last_updated_user = 1,
			bg_last_updated_date = @now,
			bg_user_defined_attribute = 0
            ,
bg_project_custom_dropdown_value1 = N'',
bg_project_custom_dropdown_value2 = N'',
bg_project_custom_dropdown_value3 = N''
	
			
			where bg_id = 1
		end
		select @now
2016-08-10 10:10:42 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 10:10:42 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:10:42 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:10:42 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:14:12 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:14:12 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:14:12 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 10:14:12 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:14:12 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* validate org versus assigned_to */
select case when og_other_orgs_permission_level <> 0
or 6 = og_id then 1
else 0 end as [answer]
from users
inner join orgs on us_org = og_id
where us_id = 10
2016-08-10 10:14:12 http://192.168.6.173/edit_bug.aspx?id=1 sql=
declare @permission_level int
		set @permission_level = -1
		select @permission_level = isnull(pu_permission_level,2)
		from project_user_xref
		where pu_project = 3
		and pu_user = 1
		if @permission_level = -1 set @permission_level = 2
		select @permission_level
2016-08-10 10:14:12 http://192.168.6.173/edit_bug.aspx?id=1 sql=
declare @now datetime
		declare @last_updated datetime
		select @last_updated = bg_last_updated_date from bugs where bg_id = 1
		if @last_updated > '20160810 10:00:35:653'
		begin
			-- signal that we did NOT do the update
			set @now = '20160810 10:00:35:653'
		end
		else
		begin
			-- signal that we DID do the update
			set @now = getdate()

			update bugs set
			bg_short_desc = N'Лишнее событие у изделия типа ''протяжка''',
			bg_tags = N'',
			bg_project = 3,
			bg_org = 6,
			bg_category = 1,
			bg_priority = 2,
			bg_assigned_to_user = 10,
			bg_status = 3,
			bg_last_updated_user = 1,
			bg_last_updated_date = @now,
			bg_user_defined_attribute = 0
            ,
bg_project_custom_dropdown_value1 = N'',
bg_project_custom_dropdown_value2 = N'',
bg_project_custom_dropdown_value3 = N''
	
			
			where bg_id = 1
		end
		select @now
2016-08-10 10:14:12 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 10:14:12 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:14:12 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:14:12 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:14:28 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:14:28 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:14:28 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 10:14:28 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:14:28 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 10:14:28 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:14:28 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 10:14:28 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:14:28 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 10:14:28 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:14:28 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:14:28 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:18:52  threadproc_votes
2016-08-10 10:18:52  sql=

if exists (select * from dbo.sysobjects where id = object_id(N'[votes_view]'))
drop view [votes_view]
2016-08-10 10:18:52  sql=

create view votes_view as
select bu_bug as vote_bug, sum(bu_vote) as vote_total
from bug_user
group by bu_bug
having sum(bu_vote) > 0
2016-08-10 10:18:52  sql=

select bu_bug, count(1)
from bug_user 
where bu_vote = 1
group by bu_bug
2016-08-10 10:18:52  elapsed milliseconds:0000
2016-08-10 10:18:52  started creating Lucene index using folder C:\btnet364\www\App_Data\lucene_index
2016-08-10 10:18:52  sql=

/* get searchable cols */					
select sc.name
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
and st.[name] in ('nvarchar','varchar')
and sc.length > 30
2016-08-10 10:18:52  elapsed milliseconds:0000
2016-08-10 10:18:52  sql=

select bg_id, 	

isnull(bg_tags,'') bg_tags,
bg_short_desc
from bugs
2016-08-10 10:18:52  elapsed milliseconds:0000
2016-08-10 10:18:52  sql=

select bp_bug, bp_id, 
isnull(bp_comment_search,bp_comment) [text] 
from bug_posts 
where bp_type <> 'update'
and bp_hidden_from_external_users = 0
2016-08-10 10:18:52  elapsed milliseconds:0050
2016-08-10 10:18:52  done creating Lucene index
2016-08-10 10:18:56 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:18:56 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:18:56 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* custom columns */ select sc.name, st.[name] [datatype], 
case when st.[name] = 'nvarchar' or st.[name] = 'nchar' then sc.length/2 else sc.length end as [length], 
sc.xprec, sc.xscale, sc.isnullable,
mm.text [default value], 
dflts.name [default name], 
isnull(ccm_dropdown_type,'') [dropdown type],
isnull(ccm_dropdown_vals,'') [vals],
isnull(ccm_sort_seq, sc.colorder) [column order],
sc.colorder
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
left outer join syscomments mm on sc.cdefault = mm.id
left outer join custom_col_metadata on ccm_colorder = sc.colorder
left outer join sysobjects dflts on dflts.id = mm.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
order by sc.id, isnull(ccm_sort_seq,sc.colorder)
2016-08-10 10:18:56 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:18:56 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 10:18:56 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:18:56 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 10:18:56 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:18:56 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 10:18:56 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:18:57 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 10:18:57 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:18:57 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:18:57 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:19:20  threadproc_votes
2016-08-10 10:19:20  sql=

if exists (select * from dbo.sysobjects where id = object_id(N'[votes_view]'))
drop view [votes_view]
2016-08-10 10:19:20  started creating Lucene index using folder C:\btnet364\www\App_Data\lucene_index
2016-08-10 10:19:20  sql=

create view votes_view as
select bu_bug as vote_bug, sum(bu_vote) as vote_total
from bug_user
group by bu_bug
having sum(bu_vote) > 0
2016-08-10 10:19:20  sql=

select bu_bug, count(1)
from bug_user 
where bu_vote = 1
group by bu_bug
2016-08-10 10:19:20  elapsed milliseconds:0002
2016-08-10 10:19:20  sql=

/* get searchable cols */					
select sc.name
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
and st.[name] in ('nvarchar','varchar')
and sc.length > 30
2016-08-10 10:19:20  elapsed milliseconds:0000
2016-08-10 10:19:20  sql=

select bg_id, 	

isnull(bg_tags,'') bg_tags,
bg_short_desc
from bugs
2016-08-10 10:19:20  elapsed milliseconds:0000
2016-08-10 10:19:20 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:19:20 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:19:20 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* custom columns */ select sc.name, st.[name] [datatype], 
case when st.[name] = 'nvarchar' or st.[name] = 'nchar' then sc.length/2 else sc.length end as [length], 
sc.xprec, sc.xscale, sc.isnullable,
mm.text [default value], 
dflts.name [default name], 
isnull(ccm_dropdown_type,'') [dropdown type],
isnull(ccm_dropdown_vals,'') [vals],
isnull(ccm_sort_seq, sc.colorder) [column order],
sc.colorder
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
left outer join syscomments mm on sc.cdefault = mm.id
left outer join custom_col_metadata on ccm_colorder = sc.colorder
left outer join sysobjects dflts on dflts.id = mm.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
order by sc.id, isnull(ccm_sort_seq,sc.colorder)
2016-08-10 10:19:20 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:19:20 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 10:19:20 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:19:21 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 10:19:21 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:19:21 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 10:19:21 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:19:21  sql=

select bp_bug, bp_id, 
isnull(bp_comment_search,bp_comment) [text] 
from bug_posts 
where bp_type <> 'update'
and bp_hidden_from_external_users = 0
2016-08-10 10:19:21  elapsed milliseconds:0000
2016-08-10 10:19:21 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 10:19:21 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:19:21 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:19:21 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:19:21  done creating Lucene index
2016-08-10 10:19:28 http://192.168.6.173/delete_comment.aspx?id=9&bug_id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:19:28 http://192.168.6.173/delete_comment.aspx?id=9&bug_id=1 elapsed milliseconds:0000
2016-08-10 10:19:28 http://192.168.6.173/delete_comment.aspx?id=9&bug_id=1 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 1
2016-08-10 10:19:28 http://192.168.6.173/delete_comment.aspx?id=9&bug_id=1 elapsed milliseconds:0000
2016-08-10 10:19:28 http://192.168.6.173/delete_comment.aspx?id=9&bug_id=1 sql=
select bp_comment from bug_posts where bp_id = 9
2016-08-10 10:19:28 http://192.168.6.173/delete_comment.aspx?id=9&bug_id=1 elapsed milliseconds:0001
2016-08-10 10:19:30 http://192.168.6.173/delete_comment.aspx?id=9&bug_id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:19:30 http://192.168.6.173/delete_comment.aspx?id=9&bug_id=1 elapsed milliseconds:0000
2016-08-10 10:19:30 http://192.168.6.173/delete_comment.aspx?id=9&bug_id=1 sql=
delete bug_posts where bp_id = 9
2016-08-10 10:19:30 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:19:30 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:19:30 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 10:19:30 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:19:30 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 10:19:30 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:19:30 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 10:19:30 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:19:30 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 10:19:30 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:19:30 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:19:30 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:19:37 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:19:37 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:19:37 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 10:19:37 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0001
2016-08-10 10:19:37 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* validate org versus assigned_to */
select case when og_other_orgs_permission_level <> 0
or 6 = og_id then 1
else 0 end as [answer]
from users
inner join orgs on us_org = og_id
where us_id = 10
2016-08-10 10:19:37 http://192.168.6.173/edit_bug.aspx?id=1 sql=
declare @permission_level int
		set @permission_level = -1
		select @permission_level = isnull(pu_permission_level,2)
		from project_user_xref
		where pu_project = 3
		and pu_user = 1
		if @permission_level = -1 set @permission_level = 2
		select @permission_level
2016-08-10 10:19:37 http://192.168.6.173/edit_bug.aspx?id=1 sql=
declare @now datetime
		declare @last_updated datetime
		select @last_updated = bg_last_updated_date from bugs where bg_id = 1
		if @last_updated > '20160810 10:19:30:547'
		begin
			-- signal that we did NOT do the update
			set @now = '20160810 10:19:30:547'
		end
		else
		begin
			-- signal that we DID do the update
			set @now = getdate()

			update bugs set
			bg_short_desc = N'Лишнее событие у изделия типа ''протяжка''',
			bg_tags = N'',
			bg_project = 3,
			bg_org = 6,
			bg_category = 1,
			bg_priority = 2,
			bg_assigned_to_user = 10,
			bg_status = 3,
			bg_last_updated_user = 1,
			bg_last_updated_date = @now,
			bg_user_defined_attribute = 0
            ,
bg_project_custom_dropdown_value1 = N'',
bg_project_custom_dropdown_value2 = N'',
bg_project_custom_dropdown_value3 = N''
	
			
			where bg_id = 1
		end
		select @now
2016-08-10 10:19:37 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 10:19:37 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:19:37 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:19:37 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:19:41 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:19:41 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:19:41 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 10:19:41 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:19:41 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 10:19:41 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:19:41 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 10:19:41 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:19:41 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 10:19:41 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:19:41 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:19:41 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:19:44 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:19:44 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:19:44 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 10:19:44 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:19:44 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* validate org versus assigned_to */
select case when og_other_orgs_permission_level <> 0
or 6 = og_id then 1
else 0 end as [answer]
from users
inner join orgs on us_org = og_id
where us_id = 10
2016-08-10 10:19:44 http://192.168.6.173/edit_bug.aspx?id=1 sql=
declare @permission_level int
		set @permission_level = -1
		select @permission_level = isnull(pu_permission_level,2)
		from project_user_xref
		where pu_project = 3
		and pu_user = 1
		if @permission_level = -1 set @permission_level = 2
		select @permission_level
2016-08-10 10:19:44 http://192.168.6.173/edit_bug.aspx?id=1 sql=
declare @now datetime
		declare @last_updated datetime
		select @last_updated = bg_last_updated_date from bugs where bg_id = 1
		if @last_updated > '20160810 10:19:41:513'
		begin
			-- signal that we did NOT do the update
			set @now = '20160810 10:19:41:513'
		end
		else
		begin
			-- signal that we DID do the update
			set @now = getdate()

			update bugs set
			bg_short_desc = N'Лишнее событие у изделия типа ''протяжка''',
			bg_tags = N'',
			bg_project = 3,
			bg_org = 6,
			bg_category = 1,
			bg_priority = 2,
			bg_assigned_to_user = 10,
			bg_status = 3,
			bg_last_updated_user = 1,
			bg_last_updated_date = @now,
			bg_user_defined_attribute = 0
            ,
bg_project_custom_dropdown_value1 = N'',
bg_project_custom_dropdown_value2 = N'',
bg_project_custom_dropdown_value3 = N''
	
			
			where bg_id = 1
		end
		select @now
2016-08-10 10:19:44 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 10:19:44 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:19:44 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:19:44 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:04 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:20:04 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:04 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 10:20:04 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:04 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 10:20:04 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:04 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 10:20:04 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:04 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 10:20:04 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:04 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:20:04 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:06 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:20:06 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:06 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 10:20:06 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:06 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* validate org versus assigned_to */
select case when og_other_orgs_permission_level <> 0
or 6 = og_id then 1
else 0 end as [answer]
from users
inner join orgs on us_org = og_id
where us_id = 10
2016-08-10 10:20:06 http://192.168.6.173/edit_bug.aspx?id=1 sql=
declare @permission_level int
		set @permission_level = -1
		select @permission_level = isnull(pu_permission_level,2)
		from project_user_xref
		where pu_project = 3
		and pu_user = 1
		if @permission_level = -1 set @permission_level = 2
		select @permission_level
2016-08-10 10:20:06 http://192.168.6.173/edit_bug.aspx?id=1 sql=
declare @now datetime
		declare @last_updated datetime
		select @last_updated = bg_last_updated_date from bugs where bg_id = 1
		if @last_updated > '20160810 10:20:04:513'
		begin
			-- signal that we did NOT do the update
			set @now = '20160810 10:20:04:513'
		end
		else
		begin
			-- signal that we DID do the update
			set @now = getdate()

			update bugs set
			bg_short_desc = N'Лишнее событие у изделия типа ''протяжка''',
			bg_tags = N'',
			bg_project = 3,
			bg_org = 6,
			bg_category = 1,
			bg_priority = 2,
			bg_assigned_to_user = 10,
			bg_status = 3,
			bg_last_updated_user = 1,
			bg_last_updated_date = @now,
			bg_user_defined_attribute = 0
            ,
bg_project_custom_dropdown_value1 = N'',
bg_project_custom_dropdown_value2 = N'',
bg_project_custom_dropdown_value3 = N''
	
			
			where bg_id = 1
		end
		select @now
2016-08-10 10:20:06 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 10:20:06 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:06 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:20:06 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:20 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:20:20 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:20 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 10:20:20 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0001
2016-08-10 10:20:20 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 10:20:20 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:20 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 10:20:20 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:20 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 10:20:20 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:20 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:20:20 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:25 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:20:25 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:25 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 10:20:25 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:25 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 10:20:25 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:25 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:20:25 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:29 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:20:29 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:29 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 10:20:29 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:29 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* validate org versus assigned_to */
select case when og_other_orgs_permission_level <> 0
or 6 = og_id then 1
else 0 end as [answer]
from users
inner join orgs on us_org = og_id
where us_id = 10
2016-08-10 10:20:29 http://192.168.6.173/edit_bug.aspx?id=1 sql=
declare @permission_level int
		set @permission_level = -1
		select @permission_level = isnull(pu_permission_level,2)
		from project_user_xref
		where pu_project = 3
		and pu_user = 1
		if @permission_level = -1 set @permission_level = 2
		select @permission_level
2016-08-10 10:20:29 http://192.168.6.173/edit_bug.aspx?id=1 sql=
declare @now datetime
		declare @last_updated datetime
		select @last_updated = bg_last_updated_date from bugs where bg_id = 1
		if @last_updated > '20160810 10:20:20:217'
		begin
			-- signal that we did NOT do the update
			set @now = '20160810 10:20:20:217'
		end
		else
		begin
			-- signal that we DID do the update
			set @now = getdate()

			update bugs set
			bg_short_desc = N'Лишнее событие у изделия типа ''протяжка''',
			bg_tags = N'',
			bg_project = 3,
			bg_org = 6,
			bg_category = 1,
			bg_priority = 2,
			bg_assigned_to_user = 10,
			bg_status = 3,
			bg_last_updated_user = 1,
			bg_last_updated_date = @now,
			bg_user_defined_attribute = 0
            ,
bg_project_custom_dropdown_value1 = N'',
bg_project_custom_dropdown_value2 = N'',
bg_project_custom_dropdown_value3 = N''
	
			
			where bg_id = 1
		end
		select @now
2016-08-10 10:20:29 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 10:20:29 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:29 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:20:29 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:42 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:20:42 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:42 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 10:20:42 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:42 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* validate org versus assigned_to */
select case when og_other_orgs_permission_level <> 0
or 6 = og_id then 1
else 0 end as [answer]
from users
inner join orgs on us_org = og_id
where us_id = 13
2016-08-10 10:20:42 http://192.168.6.173/edit_bug.aspx?id=1 sql=
declare @permission_level int
		set @permission_level = -1
		select @permission_level = isnull(pu_permission_level,2)
		from project_user_xref
		where pu_project = 3
		and pu_user = 1
		if @permission_level = -1 set @permission_level = 2
		select @permission_level
2016-08-10 10:20:42 http://192.168.6.173/edit_bug.aspx?id=1 sql=
declare @now datetime
		declare @last_updated datetime
		select @last_updated = bg_last_updated_date from bugs where bg_id = 1
		if @last_updated > '20160810 10:20:20:217'
		begin
			-- signal that we did NOT do the update
			set @now = '20160810 10:20:20:217'
		end
		else
		begin
			-- signal that we DID do the update
			set @now = getdate()

			update bugs set
			bg_short_desc = N'Лишнее событие у изделия типа ''протяжка''',
			bg_tags = N'',
			bg_project = 3,
			bg_org = 6,
			bg_category = 5,
			bg_priority = 1,
			bg_assigned_to_user = 13,
			bg_status = 3,
			bg_last_updated_user = 1,
			bg_last_updated_date = @now,
			bg_user_defined_attribute = 0
            ,
bg_project_custom_dropdown_value1 = N'',
bg_project_custom_dropdown_value2 = N'',
bg_project_custom_dropdown_value3 = N''
	
			
			where bg_id = 1
		end
		select @now
2016-08-10 10:20:42 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 10:20:42 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:42 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:20:42 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:45 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:20:45 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0001
2016-08-10 10:20:45 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 10:20:45 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:45 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* validate org versus assigned_to */
select case when og_other_orgs_permission_level <> 0
or 6 = og_id then 1
else 0 end as [answer]
from users
inner join orgs on us_org = og_id
where us_id = 13
2016-08-10 10:20:45 http://192.168.6.173/edit_bug.aspx?id=1 sql=
declare @permission_level int
		set @permission_level = -1
		select @permission_level = isnull(pu_permission_level,2)
		from project_user_xref
		where pu_project = 3
		and pu_user = 1
		if @permission_level = -1 set @permission_level = 2
		select @permission_level
2016-08-10 10:20:45 http://192.168.6.173/edit_bug.aspx?id=1 sql=
declare @now datetime
		declare @last_updated datetime
		select @last_updated = bg_last_updated_date from bugs where bg_id = 1
		if @last_updated > '20160810 10:20:20:217'
		begin
			-- signal that we did NOT do the update
			set @now = '20160810 10:20:20:217'
		end
		else
		begin
			-- signal that we DID do the update
			set @now = getdate()

			update bugs set
			bg_short_desc = N'Лишнее событие у изделия типа ''протяжка''',
			bg_tags = N'',
			bg_project = 3,
			bg_org = 6,
			bg_category = 5,
			bg_priority = 1,
			bg_assigned_to_user = 13,
			bg_status = 3,
			bg_last_updated_user = 1,
			bg_last_updated_date = @now,
			bg_user_defined_attribute = 0
            ,
bg_project_custom_dropdown_value1 = N'',
bg_project_custom_dropdown_value2 = N'',
bg_project_custom_dropdown_value3 = N''
	
			
			where bg_id = 1
		end
		select @now
2016-08-10 10:20:45 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 10:20:45 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:45 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:20:45 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:48 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:20:48 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:48 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 10:20:48 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:48 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* validate org versus assigned_to */
select case when og_other_orgs_permission_level <> 0
or 6 = og_id then 1
else 0 end as [answer]
from users
inner join orgs on us_org = og_id
where us_id = 13
2016-08-10 10:20:48 http://192.168.6.173/edit_bug.aspx?id=1 sql=
declare @permission_level int
		set @permission_level = -1
		select @permission_level = isnull(pu_permission_level,2)
		from project_user_xref
		where pu_project = 3
		and pu_user = 1
		if @permission_level = -1 set @permission_level = 2
		select @permission_level
2016-08-10 10:20:48 http://192.168.6.173/edit_bug.aspx?id=1 sql=
declare @now datetime
		declare @last_updated datetime
		select @last_updated = bg_last_updated_date from bugs where bg_id = 1
		if @last_updated > '20160810 10:20:20:217'
		begin
			-- signal that we did NOT do the update
			set @now = '20160810 10:20:20:217'
		end
		else
		begin
			-- signal that we DID do the update
			set @now = getdate()

			update bugs set
			bg_short_desc = N'Лишнее событие у изделия типа ''протяжка''',
			bg_tags = N'',
			bg_project = 3,
			bg_org = 6,
			bg_category = 5,
			bg_priority = 1,
			bg_assigned_to_user = 13,
			bg_status = 3,
			bg_last_updated_user = 1,
			bg_last_updated_date = @now,
			bg_user_defined_attribute = 0
            ,
bg_project_custom_dropdown_value1 = N'',
bg_project_custom_dropdown_value2 = N'',
bg_project_custom_dropdown_value3 = N''
	
			
			where bg_id = 1
		end
		select @now
2016-08-10 10:20:48 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 10:20:48 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:20:48 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:20:48 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:21:14 http://192.168.6.173/search.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:21:14 http://192.168.6.173/search.aspx elapsed milliseconds:0000
2016-08-10 10:21:14 http://192.168.6.173/search.aspx sql=

/* get related users 2 */
select  pj_id, us_id,
case when 0 = 1 then
    case when len(isnull(us_firstname,'') + ' ' + isnull(us_lastname,'')) > 1
	then isnull(us_firstname,'') + ' ' + isnull(us_lastname,'')
    else us_username end
else us_username end us_username,
isnull(us_email,'') us_email
into #temp
from projects, users
where pj_id not in
(
	select pu_project from project_user_xref
	where pu_permission_level = 0 and pu_user = 1
)





if 0 = 1 -- external
and 2 = 0 -- other orgs
begin
	select distinct a.us_id, a.us_username, a.us_email
	from #temp a
	inner join users b on a.us_id = b.us_id
	inner join orgs on b.us_org = og_id
	where og_external_user = 0 or b.us_org = 6
	order by a.us_username
end
else
begin

	select distinct us_id, us_username, us_email
		from #temp
		left outer join project_user_xref on pj_id = pu_project
		and us_id = pu_user
		where isnull(pu_permission_level,2) <> 0
		order by us_username
end

drop table #temp
2016-08-10 10:21:14 http://192.168.6.173/search.aspx elapsed milliseconds:0017
2016-08-10 10:21:14 http://192.168.6.173/search.aspx sql=
/* drop downs */ select pj_id, pj_name from projects order by pj_name; select og_id, og_name from orgs order by og_name;
	select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
	select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
	select st_id, st_name from statuses order by st_sort_seq, st_name;
	select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name
2016-08-10 10:21:15 http://192.168.6.173/search.aspx elapsed milliseconds:0002
2016-08-10 10:21:15 http://192.168.6.173/search.aspx sql=

select count(1)
from projects
where isnull(pj_enable_custom_dropdown1,0) = 1
or isnull(pj_enable_custom_dropdown2,0) = 1
or isnull(pj_enable_custom_dropdown3,0) = 1
2016-08-10 10:21:16 http://192.168.6.173/bugs.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:21:16 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:21:16 http://192.168.6.173/bugs.aspx sql=
/* query dropdown */
select qu_id, qu_desc
from queries
where (isnull(qu_user,0) = 0 and isnull(qu_org,0) = 0)
or isnull(qu_user,0) = 1
or isnull(qu_org,0) = 6
order by qu_desc
2016-08-10 10:21:16 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:21:16 http://192.168.6.173/bugs.aspx sql=
select qu_id, qu_sql from queries where qu_id in
			(select us_default_query from users where us_id = 1)
2016-08-10 10:21:16 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:21:16 http://192.168.6.173/bugs.aspx sql=
select isnull(pr_background_color,'#ffffff'), bg_id [id], isnull(bu_flag,0) [$FLAG], 
 bg_short_desc [desc], isnull(pj_name,'') [project], isnull(og_name,'') [organization], isnull(ct_name,'') [category], rpt.us_username [reported by],
 bg_reported_date [reported on], isnull(pr_name,'') [priority], isnull(asg.us_username,'') [assigned to],
 isnull(st_name,'') [status], isnull(lu.us_username,'') [last updated by], bg_last_updated_date [last updated on]
 from bugs 
 left outer join bug_user on bu_bug = bg_id and bu_user = 1 
 left outer join users rpt on rpt.us_id = bg_reported_user
 left outer join users asg on asg.us_id = bg_assigned_to_user
 left outer join users lu on lu.us_id = bg_last_updated_user
 left outer join projects on pj_id = bg_project
 left outer join orgs on og_id = bg_org
 left outer join categories on ct_id = bg_category
 left outer join priorities on pr_id = bg_priority
 left outer join statuses on st_id = bg_status
  /* altered - just order by  */ WHERE  (bugs.bg_project not in (
					select pu_project
					from project_user_xref
					where pu_user = 1
					and pu_permission_level = 0)) order by bg_id desc
2016-08-10 10:21:16 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:21:17 http://192.168.6.173/ajax.aspx?bugid=3 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:21:17 http://192.168.6.173/ajax.aspx?bugid=3 elapsed milliseconds:0000
2016-08-10 10:21:17 http://192.168.6.173/ajax.aspx?bugid=3 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 3
2016-08-10 10:21:17 http://192.168.6.173/ajax.aspx?bugid=3 elapsed milliseconds:0002
2016-08-10 10:21:17 http://192.168.6.173/ajax.aspx?bugid=3 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 3
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:21:17 http://192.168.6.173/ajax.aspx?bugid=3 elapsed milliseconds:0000
2016-08-10 10:21:18 http://192.168.6.173/ajax.aspx?bugid=3 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:21:18 http://192.168.6.173/ajax.aspx?bugid=3 elapsed milliseconds:0008
2016-08-10 10:21:18 http://192.168.6.173/ajax.aspx?bugid=3 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 3
2016-08-10 10:21:18 http://192.168.6.173/ajax.aspx?bugid=3 elapsed milliseconds:0000
2016-08-10 10:21:18 http://192.168.6.173/ajax.aspx?bugid=3 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 3
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:21:18 http://192.168.6.173/ajax.aspx?bugid=3 elapsed milliseconds:0000
2016-08-10 10:21:18 http://192.168.6.173/edit_bug.aspx?id=3 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:21:18 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:21:18 http://192.168.6.173/edit_bug.aspx?id=3 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 3
2016-08-10 10:21:18 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:21:18 http://192.168.6.173/edit_bug.aspx?id=3 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 10:21:18 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:21:18 http://192.168.6.173/edit_bug.aspx?id=3 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 4
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 10:21:18 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:21:18 http://192.168.6.173/edit_bug.aspx?id=3 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 4
2016-08-10 10:21:18 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:21:18 http://192.168.6.173/edit_bug.aspx?id=3 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 3
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:21:18 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:21:22 http://192.168.6.173/edit_bug.aspx?id=3 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:21:22 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:21:22 http://192.168.6.173/edit_bug.aspx?id=3 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 3
2016-08-10 10:21:22 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:21:22 http://192.168.6.173/edit_bug.aspx?id=3 sql=

/* validate org versus assigned_to */
select case when og_other_orgs_permission_level <> 0
or 6 = og_id then 1
else 0 end as [answer]
from users
inner join orgs on us_org = og_id
where us_id = 13
2016-08-10 10:21:22 http://192.168.6.173/edit_bug.aspx?id=3 sql=
declare @permission_level int
		set @permission_level = -1
		select @permission_level = isnull(pu_permission_level,2)
		from project_user_xref
		where pu_project = 4
		and pu_user = 1
		if @permission_level = -1 set @permission_level = 2
		select @permission_level
2016-08-10 10:21:22 http://192.168.6.173/edit_bug.aspx?id=3 sql=
declare @now datetime
		declare @last_updated datetime
		select @last_updated = bg_last_updated_date from bugs where bg_id = 3
		if @last_updated > '20160810 10:21:18:717'
		begin
			-- signal that we did NOT do the update
			set @now = '20160810 10:21:18:717'
		end
		else
		begin
			-- signal that we DID do the update
			set @now = getdate()

			update bugs set
			bg_short_desc = N'Создания атомарных методов для мувера ТИТП',
			bg_tags = N'',
			bg_project = 4,
			bg_org = 6,
			bg_category = 5,
			bg_priority = 1,
			bg_assigned_to_user = 13,
			bg_status = 2,
			bg_last_updated_user = 1,
			bg_last_updated_date = @now,
			bg_user_defined_attribute = 0
            ,
bg_project_custom_dropdown_value1 = N'',
bg_project_custom_dropdown_value2 = N'',
bg_project_custom_dropdown_value3 = N''
	
			
			where bg_id = 3
		end
		select @now
2016-08-10 10:21:22 http://192.168.6.173/edit_bug.aspx?id=3 sql=

declare @pj int
select @pj = bg_project from bugs where bg_id = 3

delete from bug_subscriptions
where bs_bug = 3
and bs_user in
(select x.pu_user
from projects
left outer join project_user_xref x on pu_project = pj_id
where pu_project = @pj
and isnull(pu_permission_level,2) = 0)

delete from bug_subscriptions
where bs_bug = 3
and bs_user in
(select us_id from users
 inner join orgs on us_org = og_id
 inner join bugs on bg_id = 3
 where og_other_orgs_permission_level = 0
 and bg_org <> og_id)

insert into bug_subscriptions (bs_bug, bs_user)
select 3, us_id
from users
inner join orgs on us_org = og_id
inner join bugs on bg_id = 3
left outer join project_user_xref on pu_project = @pj and pu_user = us_id
where us_auto_subscribe = 1
and
case
	when
		us_org <> bg_org
		and og_other_orgs_permission_level < 2
		and og_other_orgs_permission_level < isnull(pu_permission_level,2)
			then og_other_orgs_permission_level
	else
		isnull(pu_permission_level,2)
end <> 0
and us_active = 1
and us_id not in
(select bs_user from bug_subscriptions
where bs_bug = 3)

insert into bug_subscriptions (bs_bug, bs_user)
select 3, pj_default_user
from projects
inner join users on pj_default_user = us_id
where pj_id = @pj
and pj_default_user <> 0
and pj_auto_subscribe_default_user = 1
and us_active = 1
and pj_default_user not in
(select bs_user from bug_subscriptions
where bs_bug = 3)

insert into bug_subscriptions (bs_bug, bs_user)
select 3, pu_user from project_user_xref
inner join users on pu_user = us_id
inner join orgs on us_org = og_id
inner join bugs on bg_id = 3
where pu_auto_subscribe = 1
and
case
	when
		us_org <> bg_org
		and og_other_orgs_permission_level < 2
		and og_other_orgs_permission_level < isnull(pu_permission_level,2)
			then og_other_orgs_permission_level
	else
		isnull(pu_permission_level,2)
end <> 0
and us_active = 1
and pu_project = @pj
and pu_user not in
(select bs_user from bug_subscriptions
where bs_bug = 3)

insert into bug_subscriptions (bs_bug, bs_user)
select 3, us_id
from users
inner join bugs on bg_id = 3
inner join orgs on us_org = og_id
left outer join project_user_xref on pu_project = @pj and pu_user = us_id
where ((us_auto_subscribe_own_bugs = 1 and bg_assigned_to_user = us_id)
or
(us_auto_subscribe_reported_bugs = 1 and bg_reported_user = us_id))
and
case
	when
		us_org <> bg_org
		and og_other_orgs_permission_level < 2
		and og_other_orgs_permission_level < isnull(pu_permission_level,2)
			then og_other_orgs_permission_level
	else
		isnull(pu_permission_level,2)
end <> 0
and us_active = 1
and us_id not in
(select bs_user from bug_subscriptions
where bs_bug = 3)
2016-08-10 10:21:22 http://192.168.6.173/edit_bug.aspx?id=3 sql=
select count(1) from bug_subscriptions where bs_bug = 3 and bs_user = 1
2016-08-10 10:21:22 http://192.168.6.173/edit_bug.aspx?id=3 sql=

declare @now datetime
set @now = getdate()

insert into bug_posts
(bp_bug, bp_user, bp_date, bp_comment, bp_comment_search, bp_email_from, bp_email_cc, bp_type, bp_content_type,
bp_hidden_from_external_users)
values(
3,
1,
@now,
N'tyujt',
N'tyujt',
null,
N'',
N'comment',
N'text/plain',
0)
select scope_identity();
2016-08-10 10:21:22 http://192.168.6.173/edit_bug.aspx?id=3 sql=

/* get notification emails for all subscribers */
select us_email, us_id, us_admin, og.*
from bug_subscriptions
inner join users on bs_user = us_id
inner join orgs og on us_org = og_id
inner join bugs on bg_id = bs_bug
left outer join project_user_xref on pu_user = us_id and pu_project = bg_project
where us_email is not null
and us_enable_notifications = 1
-- $status_change
and us_active = 1
and us_email <> ''
and (   (4 <= us_reported_notifications and bg_reported_user = bs_user)
or (4 <= us_assigned_notifications and bg_assigned_to_user = bs_user)
or (4 <= us_assigned_notifications and 13 = bs_user)
or (4 <= us_subscribed_notifications))
and
case
when
us_org <> bg_org
and og_other_orgs_permission_level < 2
and og_other_orgs_permission_level < isnull(pu_permission_level,2)
	then og_other_orgs_permission_level
else
isnull(pu_permission_level,2)
end <> 0
and bs_bug = 3
and (us_id <> 1 or isnull(us_send_notifications_to_self,0) = 1)
2016-08-10 10:21:22  started updating Lucene index using folder C:\btnet364\www\App_Data\lucene_index
2016-08-10 10:21:22 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0015
2016-08-10 10:21:22 http://192.168.6.173/edit_bug.aspx?id=3 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 4
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 10:21:22 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:21:22 http://192.168.6.173/edit_bug.aspx?id=3 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 4
2016-08-10 10:21:22 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:21:22 http://192.168.6.173/edit_bug.aspx?id=3 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 3
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:21:22 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:21:22  sql=

/* get searchable cols */					
select sc.name
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
and st.[name] in ('nvarchar','varchar')
and sc.length > 30
2016-08-10 10:21:22  elapsed milliseconds:0000
2016-08-10 10:21:22  sql=

select bg_id, 

isnull(bg_tags,'') bg_tags,
bg_short_desc    
from bugs where bg_id = 3
2016-08-10 10:21:22  elapsed milliseconds:0001
2016-08-10 10:21:22  sql=

select bp_bug, bp_id, 
isnull(bp_comment_search,bp_comment) [text] 
from bug_posts 
where bp_type <> 'update'
and bp_hidden_from_external_users = 0
and bp_bug = 3
2016-08-10 10:21:22  elapsed milliseconds:0002
2016-08-10 10:21:22  done updating Lucene index
2016-08-10 10:21:26 http://192.168.6.173/delete_comment.aspx?id=10&bug_id=3 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:21:26 http://192.168.6.173/delete_comment.aspx?id=10&bug_id=3 elapsed milliseconds:0000
2016-08-10 10:21:26 http://192.168.6.173/delete_comment.aspx?id=10&bug_id=3 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 3
2016-08-10 10:21:26 http://192.168.6.173/delete_comment.aspx?id=10&bug_id=3 elapsed milliseconds:0000
2016-08-10 10:21:26 http://192.168.6.173/delete_comment.aspx?id=10&bug_id=3 sql=
select bp_comment from bug_posts where bp_id = 10
2016-08-10 10:21:26 http://192.168.6.173/delete_comment.aspx?id=10&bug_id=3 elapsed milliseconds:0000
2016-08-10 10:21:28 http://192.168.6.173/delete_comment.aspx?id=10&bug_id=3 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:21:28 http://192.168.6.173/delete_comment.aspx?id=10&bug_id=3 elapsed milliseconds:0000
2016-08-10 10:21:28 http://192.168.6.173/delete_comment.aspx?id=10&bug_id=3 sql=
delete bug_posts where bp_id = 10
2016-08-10 10:21:28 http://192.168.6.173/edit_bug.aspx?id=3 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:21:28 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:21:28 http://192.168.6.173/edit_bug.aspx?id=3 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 3
2016-08-10 10:21:28 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:21:28 http://192.168.6.173/edit_bug.aspx?id=3 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 10:21:28 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:21:28 http://192.168.6.173/edit_bug.aspx?id=3 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 4
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 10:21:28 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:21:28 http://192.168.6.173/edit_bug.aspx?id=3 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 4
2016-08-10 10:21:28 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:21:28 http://192.168.6.173/edit_bug.aspx?id=3 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 3
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:21:28 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:21:30 http://192.168.6.173/edit_bug.aspx?id=3 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:21:30 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0002
2016-08-10 10:21:30 http://192.168.6.173/edit_bug.aspx?id=3 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 3
2016-08-10 10:21:30 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:21:30 http://192.168.6.173/edit_bug.aspx?id=3 sql=

/* validate org versus assigned_to */
select case when og_other_orgs_permission_level <> 0
or 6 = og_id then 1
else 0 end as [answer]
from users
inner join orgs on us_org = og_id
where us_id = 13
2016-08-10 10:21:30 http://192.168.6.173/edit_bug.aspx?id=3 sql=
declare @permission_level int
		set @permission_level = -1
		select @permission_level = isnull(pu_permission_level,2)
		from project_user_xref
		where pu_project = 4
		and pu_user = 1
		if @permission_level = -1 set @permission_level = 2
		select @permission_level
2016-08-10 10:21:30 http://192.168.6.173/edit_bug.aspx?id=3 sql=
declare @now datetime
		declare @last_updated datetime
		select @last_updated = bg_last_updated_date from bugs where bg_id = 3
		if @last_updated > '20160810 10:21:28:390'
		begin
			-- signal that we did NOT do the update
			set @now = '20160810 10:21:28:390'
		end
		else
		begin
			-- signal that we DID do the update
			set @now = getdate()

			update bugs set
			bg_short_desc = N'Создания атомарных методов для мувера ТИТП',
			bg_tags = N'',
			bg_project = 4,
			bg_org = 6,
			bg_category = 5,
			bg_priority = 1,
			bg_assigned_to_user = 13,
			bg_status = 2,
			bg_last_updated_user = 1,
			bg_last_updated_date = @now,
			bg_user_defined_attribute = 0
            ,
bg_project_custom_dropdown_value1 = N'',
bg_project_custom_dropdown_value2 = N'',
bg_project_custom_dropdown_value3 = N''
	
			
			where bg_id = 3
		end
		select @now
2016-08-10 10:21:30 http://192.168.6.173/edit_bug.aspx?id=3 sql=

declare @pj int
select @pj = bg_project from bugs where bg_id = 3

delete from bug_subscriptions
where bs_bug = 3
and bs_user in
(select x.pu_user
from projects
left outer join project_user_xref x on pu_project = pj_id
where pu_project = @pj
and isnull(pu_permission_level,2) = 0)

delete from bug_subscriptions
where bs_bug = 3
and bs_user in
(select us_id from users
 inner join orgs on us_org = og_id
 inner join bugs on bg_id = 3
 where og_other_orgs_permission_level = 0
 and bg_org <> og_id)

insert into bug_subscriptions (bs_bug, bs_user)
select 3, us_id
from users
inner join orgs on us_org = og_id
inner join bugs on bg_id = 3
left outer join project_user_xref on pu_project = @pj and pu_user = us_id
where us_auto_subscribe = 1
and
case
	when
		us_org <> bg_org
		and og_other_orgs_permission_level < 2
		and og_other_orgs_permission_level < isnull(pu_permission_level,2)
			then og_other_orgs_permission_level
	else
		isnull(pu_permission_level,2)
end <> 0
and us_active = 1
and us_id not in
(select bs_user from bug_subscriptions
where bs_bug = 3)

insert into bug_subscriptions (bs_bug, bs_user)
select 3, pj_default_user
from projects
inner join users on pj_default_user = us_id
where pj_id = @pj
and pj_default_user <> 0
and pj_auto_subscribe_default_user = 1
and us_active = 1
and pj_default_user not in
(select bs_user from bug_subscriptions
where bs_bug = 3)

insert into bug_subscriptions (bs_bug, bs_user)
select 3, pu_user from project_user_xref
inner join users on pu_user = us_id
inner join orgs on us_org = og_id
inner join bugs on bg_id = 3
where pu_auto_subscribe = 1
and
case
	when
		us_org <> bg_org
		and og_other_orgs_permission_level < 2
		and og_other_orgs_permission_level < isnull(pu_permission_level,2)
			then og_other_orgs_permission_level
	else
		isnull(pu_permission_level,2)
end <> 0
and us_active = 1
and pu_project = @pj
and pu_user not in
(select bs_user from bug_subscriptions
where bs_bug = 3)

insert into bug_subscriptions (bs_bug, bs_user)
select 3, us_id
from users
inner join bugs on bg_id = 3
inner join orgs on us_org = og_id
left outer join project_user_xref on pu_project = @pj and pu_user = us_id
where ((us_auto_subscribe_own_bugs = 1 and bg_assigned_to_user = us_id)
or
(us_auto_subscribe_reported_bugs = 1 and bg_reported_user = us_id))
and
case
	when
		us_org <> bg_org
		and og_other_orgs_permission_level < 2
		and og_other_orgs_permission_level < isnull(pu_permission_level,2)
			then og_other_orgs_permission_level
	else
		isnull(pu_permission_level,2)
end <> 0
and us_active = 1
and us_id not in
(select bs_user from bug_subscriptions
where bs_bug = 3)
2016-08-10 10:21:30 http://192.168.6.173/edit_bug.aspx?id=3 sql=
select count(1) from bug_subscriptions where bs_bug = 3 and bs_user = 1
2016-08-10 10:21:30 http://192.168.6.173/edit_bug.aspx?id=3 sql=

declare @now datetime
set @now = getdate()

insert into bug_posts
(bp_bug, bp_user, bp_date, bp_comment, bp_comment_search, bp_email_from, bp_email_cc, bp_type, bp_content_type,
bp_hidden_from_external_users)
values(
3,
1,
@now,
N'56',
N'56',
null,
N'',
N'comment',
N'text/plain',
0)
select scope_identity();
2016-08-10 10:21:30 http://192.168.6.173/edit_bug.aspx?id=3 sql=

/* get notification emails for all subscribers */
select us_email, us_id, us_admin, og.*
from bug_subscriptions
inner join users on bs_user = us_id
inner join orgs og on us_org = og_id
inner join bugs on bg_id = bs_bug
left outer join project_user_xref on pu_user = us_id and pu_project = bg_project
where us_email is not null
and us_enable_notifications = 1
-- $status_change
and us_active = 1
and us_email <> ''
and (   (4 <= us_reported_notifications and bg_reported_user = bs_user)
or (4 <= us_assigned_notifications and bg_assigned_to_user = bs_user)
or (4 <= us_assigned_notifications and 13 = bs_user)
or (4 <= us_subscribed_notifications))
and
case
when
us_org <> bg_org
and og_other_orgs_permission_level < 2
and og_other_orgs_permission_level < isnull(pu_permission_level,2)
	then og_other_orgs_permission_level
else
isnull(pu_permission_level,2)
end <> 0
and bs_bug = 3
and (us_id <> 1 or isnull(us_send_notifications_to_self,0) = 1)
2016-08-10 10:21:30 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:21:30  started updating Lucene index using folder C:\btnet364\www\App_Data\lucene_index
2016-08-10 10:21:30 http://192.168.6.173/edit_bug.aspx?id=3 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 4
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 10:21:30 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:21:30 http://192.168.6.173/edit_bug.aspx?id=3 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 4
2016-08-10 10:21:30 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:21:30 http://192.168.6.173/edit_bug.aspx?id=3 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 3
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:21:30 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:21:30  sql=

/* get searchable cols */					
select sc.name
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
and st.[name] in ('nvarchar','varchar')
and sc.length > 30
2016-08-10 10:21:30  elapsed milliseconds:0000
2016-08-10 10:21:30  sql=

select bg_id, 

isnull(bg_tags,'') bg_tags,
bg_short_desc    
from bugs where bg_id = 3
2016-08-10 10:21:30  elapsed milliseconds:0000
2016-08-10 10:21:30  sql=

select bp_bug, bp_id, 
isnull(bp_comment_search,bp_comment) [text] 
from bug_posts 
where bp_type <> 'update'
and bp_hidden_from_external_users = 0
and bp_bug = 3
2016-08-10 10:21:30  elapsed milliseconds:0000
2016-08-10 10:21:30  done updating Lucene index
2016-08-10 10:21:33 http://192.168.6.173/delete_comment.aspx?id=11&bug_id=3 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:21:33 http://192.168.6.173/delete_comment.aspx?id=11&bug_id=3 elapsed milliseconds:0000
2016-08-10 10:21:33 http://192.168.6.173/delete_comment.aspx?id=11&bug_id=3 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 3
2016-08-10 10:21:33 http://192.168.6.173/delete_comment.aspx?id=11&bug_id=3 elapsed milliseconds:0000
2016-08-10 10:21:33 http://192.168.6.173/delete_comment.aspx?id=11&bug_id=3 sql=
select bp_comment from bug_posts where bp_id = 11
2016-08-10 10:21:33 http://192.168.6.173/delete_comment.aspx?id=11&bug_id=3 elapsed milliseconds:0000
2016-08-10 10:21:35 http://192.168.6.173/delete_comment.aspx?id=11&bug_id=3 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:21:35 http://192.168.6.173/delete_comment.aspx?id=11&bug_id=3 elapsed milliseconds:0000
2016-08-10 10:21:35 http://192.168.6.173/delete_comment.aspx?id=11&bug_id=3 sql=
delete bug_posts where bp_id = 11
2016-08-10 10:21:35 http://192.168.6.173/edit_bug.aspx?id=3 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:21:35 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:21:35 http://192.168.6.173/edit_bug.aspx?id=3 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 3
2016-08-10 10:21:35 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:21:35 http://192.168.6.173/edit_bug.aspx?id=3 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 10:21:35 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:21:35 http://192.168.6.173/edit_bug.aspx?id=3 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 4
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 10:21:35 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:21:35 http://192.168.6.173/edit_bug.aspx?id=3 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 4
2016-08-10 10:21:35 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:21:35 http://192.168.6.173/edit_bug.aspx?id=3 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 3
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:21:35 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:21:38 http://192.168.6.173/bugs.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:21:38 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:21:38 http://192.168.6.173/bugs.aspx sql=
/* query dropdown */
select qu_id, qu_desc
from queries
where (isnull(qu_user,0) = 0 and isnull(qu_org,0) = 0)
or isnull(qu_user,0) = 1
or isnull(qu_org,0) = 6
order by qu_desc
2016-08-10 10:21:38 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:21:38 http://192.168.6.173/bugs.aspx sql=
select qu_sql from queries where qu_id = 1
2016-08-10 10:21:38 http://192.168.6.173/bugs.aspx sql=
select isnull(pr_background_color,'#ffffff'), bg_id [id], isnull(bu_flag,0) [$FLAG], 
 bg_short_desc [desc], isnull(pj_name,'') [project], isnull(og_name,'') [organization], isnull(ct_name,'') [category], rpt.us_username [reported by],
 bg_reported_date [reported on], isnull(pr_name,'') [priority], isnull(asg.us_username,'') [assigned to],
 isnull(st_name,'') [status], isnull(lu.us_username,'') [last updated by], bg_last_updated_date [last updated on]
 from bugs 
 left outer join bug_user on bu_bug = bg_id and bu_user = 1 
 left outer join users rpt on rpt.us_id = bg_reported_user
 left outer join users asg on asg.us_id = bg_assigned_to_user
 left outer join users lu on lu.us_id = bg_last_updated_user
 left outer join projects on pj_id = bg_project
 left outer join orgs on og_id = bg_org
 left outer join categories on ct_id = bg_category
 left outer join priorities on pr_id = bg_priority
 left outer join statuses on st_id = bg_status
  /* altered - just order by  */ WHERE  (bugs.bg_project not in (
					select pu_project
					from project_user_xref
					where pu_user = 1
					and pu_permission_level = 0)) order by bg_id desc
2016-08-10 10:21:38 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:21:38 http://192.168.6.173/ajax.aspx?bugid=4 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:21:38 http://192.168.6.173/ajax.aspx?bugid=4 elapsed milliseconds:0000
2016-08-10 10:21:38 http://192.168.6.173/ajax.aspx?bugid=4 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 4
2016-08-10 10:21:38 http://192.168.6.173/ajax.aspx?bugid=4 elapsed milliseconds:0000
2016-08-10 10:21:38 http://192.168.6.173/ajax.aspx?bugid=4 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 4
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:21:38 http://192.168.6.173/ajax.aspx?bugid=4 elapsed milliseconds:0000
2016-08-10 10:21:39 http://192.168.6.173/ajax.aspx?bugid=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:21:39 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 10:21:39 http://192.168.6.173/ajax.aspx?bugid=1 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 1
2016-08-10 10:21:39 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 10:21:39 http://192.168.6.173/ajax.aspx?bugid=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:21:39 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 10:21:39 http://192.168.6.173/ajax.aspx?bugid=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:21:39 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 10:21:39 http://192.168.6.173/ajax.aspx?bugid=1 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 1
2016-08-10 10:21:39 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 10:21:39 http://192.168.6.173/ajax.aspx?bugid=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:21:39 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 10:21:40 http://192.168.6.173/ajax.aspx?bugid=3 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:21:40 http://192.168.6.173/ajax.aspx?bugid=3 elapsed milliseconds:0000
2016-08-10 10:21:40 http://192.168.6.173/ajax.aspx?bugid=3 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 3
2016-08-10 10:21:40 http://192.168.6.173/ajax.aspx?bugid=3 elapsed milliseconds:0000
2016-08-10 10:21:40 http://192.168.6.173/ajax.aspx?bugid=3 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 3
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:21:40 http://192.168.6.173/ajax.aspx?bugid=3 elapsed milliseconds:0000
2016-08-10 10:21:40 http://192.168.6.173/ajax.aspx?bugid=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:21:40 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 10:21:40 http://192.168.6.173/ajax.aspx?bugid=1 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 1
2016-08-10 10:21:40 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 10:21:40 http://192.168.6.173/ajax.aspx?bugid=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:21:40 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 10:21:40 http://192.168.6.173/ajax.aspx?bugid=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:21:40 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 10:21:40 http://192.168.6.173/ajax.aspx?bugid=1 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 1
2016-08-10 10:21:40 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 10:21:40 http://192.168.6.173/ajax.aspx?bugid=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:21:40 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 10:21:41 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:21:41 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:21:41 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 10:21:41 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:21:41 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 10:21:41 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:21:41 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 10:21:41 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:21:41 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 10:21:41 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:21:41 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:21:41 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:21:44 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:21:44 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0001
2016-08-10 10:21:44 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 10:21:44 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:21:44 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* validate org versus assigned_to */
select case when og_other_orgs_permission_level <> 0
or 6 = og_id then 1
else 0 end as [answer]
from users
inner join orgs on us_org = og_id
where us_id = 10
2016-08-10 10:21:44 http://192.168.6.173/edit_bug.aspx?id=1 sql=
declare @permission_level int
		set @permission_level = -1
		select @permission_level = isnull(pu_permission_level,2)
		from project_user_xref
		where pu_project = 3
		and pu_user = 1
		if @permission_level = -1 set @permission_level = 2
		select @permission_level
2016-08-10 10:21:44 http://192.168.6.173/edit_bug.aspx?id=1 sql=
declare @now datetime
		declare @last_updated datetime
		select @last_updated = bg_last_updated_date from bugs where bg_id = 1
		if @last_updated > '20160810 10:21:41:187'
		begin
			-- signal that we did NOT do the update
			set @now = '20160810 10:21:41:187'
		end
		else
		begin
			-- signal that we DID do the update
			set @now = getdate()

			update bugs set
			bg_short_desc = N'Лишнее событие у изделия типа ''протяжка''',
			bg_tags = N'',
			bg_project = 3,
			bg_org = 6,
			bg_category = 1,
			bg_priority = 2,
			bg_assigned_to_user = 10,
			bg_status = 3,
			bg_last_updated_user = 1,
			bg_last_updated_date = @now,
			bg_user_defined_attribute = 0
            ,
bg_project_custom_dropdown_value1 = N'',
bg_project_custom_dropdown_value2 = N'',
bg_project_custom_dropdown_value3 = N''
	
			
			where bg_id = 1
		end
		select @now
2016-08-10 10:21:44 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 10:21:44 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:21:44 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:21:44 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:21:51 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:21:51 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=1 elapsed milliseconds:0000
2016-08-10 10:21:51 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=1 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 1
2016-08-10 10:21:51 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=1 elapsed milliseconds:0000
2016-08-10 10:21:51 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:21:51 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=1&id=1 elapsed milliseconds:0009
2016-08-10 10:21:51 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 10:21:54 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:21:54 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=1 elapsed milliseconds:0001
2016-08-10 10:21:54 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=1 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 1
2016-08-10 10:21:54 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=1 elapsed milliseconds:0000
2016-08-10 10:21:54 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:21:54 http://192.168.6.173/write_posts.aspx?images_inline=1&history_inline=0&id=1 elapsed milliseconds:0000
2016-08-10 10:21:54 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 10:23:20 http://192.168.6.173/edit_bug.aspx?id=0 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:23:20 http://192.168.6.173/edit_bug.aspx?id=0 elapsed milliseconds:0000
2016-08-10 10:23:20 http://192.168.6.173/edit_bug.aspx?id=0 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 10:23:20 http://192.168.6.173/edit_bug.aspx?id=0 elapsed milliseconds:0000
2016-08-10 10:23:20 http://192.168.6.173/edit_bug.aspx?id=0 sql=

select top 1 pj_id from projects where pj_default = 1 order by pj_name;
select top 1 ct_id from categories where ct_default = 1 order by ct_name;
select top 1 pr_id from priorities where pr_default = 1 order by pr_name;
select top 1 st_id from statuses where st_default = 1 order by st_name;
select top 1 udf_id from user_defined_attribute where udf_default = 1 order by udf_name;
2016-08-10 10:23:20 http://192.168.6.173/edit_bug.aspx?id=0 elapsed milliseconds:0000
2016-08-10 10:23:20 http://192.168.6.173/edit_bug.aspx?id=0 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 10:23:20 http://192.168.6.173/edit_bug.aspx?id=0 elapsed milliseconds:0000
2016-08-10 10:23:20 http://192.168.6.173/edit_bug.aspx?id=0 sql=
select isnull(pj_default_user,0)
					from projects
					where pj_id = 3
2016-08-10 10:23:20 http://192.168.6.173/edit_bug.aspx?id=0 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 10:23:20 http://192.168.6.173/edit_bug.aspx?id=0 elapsed milliseconds:0000
2016-08-10 10:23:26 http://192.168.6.173/bugs.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:23:26 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:23:26 http://192.168.6.173/bugs.aspx sql=
/* query dropdown */
select qu_id, qu_desc
from queries
where (isnull(qu_user,0) = 0 and isnull(qu_org,0) = 0)
or isnull(qu_user,0) = 1
or isnull(qu_org,0) = 6
order by qu_desc
2016-08-10 10:23:26 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:23:26 http://192.168.6.173/bugs.aspx sql=
select qu_sql from queries where qu_id = 1
2016-08-10 10:23:26 http://192.168.6.173/bugs.aspx sql=
select isnull(pr_background_color,'#ffffff'), bg_id [id], isnull(bu_flag,0) [$FLAG], 
 bg_short_desc [desc], isnull(pj_name,'') [project], isnull(og_name,'') [organization], isnull(ct_name,'') [category], rpt.us_username [reported by],
 bg_reported_date [reported on], isnull(pr_name,'') [priority], isnull(asg.us_username,'') [assigned to],
 isnull(st_name,'') [status], isnull(lu.us_username,'') [last updated by], bg_last_updated_date [last updated on]
 from bugs 
 left outer join bug_user on bu_bug = bg_id and bu_user = 1 
 left outer join users rpt on rpt.us_id = bg_reported_user
 left outer join users asg on asg.us_id = bg_assigned_to_user
 left outer join users lu on lu.us_id = bg_last_updated_user
 left outer join projects on pj_id = bg_project
 left outer join orgs on og_id = bg_org
 left outer join categories on ct_id = bg_category
 left outer join priorities on pr_id = bg_priority
 left outer join statuses on st_id = bg_status
  /* altered - just order by  */ WHERE  (bugs.bg_project not in (
					select pu_project
					from project_user_xref
					where pu_user = 1
					and pu_permission_level = 0)) order by bg_id desc
2016-08-10 10:23:26 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:23:28 http://192.168.6.173/edit_bug.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:23:28 http://192.168.6.173/edit_bug.aspx elapsed milliseconds:0000
2016-08-10 10:23:28 http://192.168.6.173/edit_bug.aspx sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 10:23:28 http://192.168.6.173/edit_bug.aspx elapsed milliseconds:0000
2016-08-10 10:23:28 http://192.168.6.173/edit_bug.aspx sql=

select top 1 pj_id from projects where pj_default = 1 order by pj_name;
select top 1 ct_id from categories where ct_default = 1 order by ct_name;
select top 1 pr_id from priorities where pr_default = 1 order by pr_name;
select top 1 st_id from statuses where st_default = 1 order by st_name;
select top 1 udf_id from user_defined_attribute where udf_default = 1 order by udf_name;
2016-08-10 10:23:28 http://192.168.6.173/edit_bug.aspx elapsed milliseconds:0000
2016-08-10 10:23:28 http://192.168.6.173/edit_bug.aspx sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 10:23:28 http://192.168.6.173/edit_bug.aspx elapsed milliseconds:0000
2016-08-10 10:23:28 http://192.168.6.173/edit_bug.aspx sql=
select isnull(pj_default_user,0)
					from projects
					where pj_id = 3
2016-08-10 10:23:28 http://192.168.6.173/edit_bug.aspx sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 10:23:28 http://192.168.6.173/edit_bug.aspx elapsed milliseconds:0000
2016-08-10 10:23:30 http://192.168.6.173/bugs.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:23:30 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:23:30 http://192.168.6.173/bugs.aspx sql=
/* query dropdown */
select qu_id, qu_desc
from queries
where (isnull(qu_user,0) = 0 and isnull(qu_org,0) = 0)
or isnull(qu_user,0) = 1
or isnull(qu_org,0) = 6
order by qu_desc
2016-08-10 10:23:30 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:23:30 http://192.168.6.173/bugs.aspx sql=
select qu_sql from queries where qu_id = 1
2016-08-10 10:23:30 http://192.168.6.173/bugs.aspx sql=
select isnull(pr_background_color,'#ffffff'), bg_id [id], isnull(bu_flag,0) [$FLAG], 
 bg_short_desc [desc], isnull(pj_name,'') [project], isnull(og_name,'') [organization], isnull(ct_name,'') [category], rpt.us_username [reported by],
 bg_reported_date [reported on], isnull(pr_name,'') [priority], isnull(asg.us_username,'') [assigned to],
 isnull(st_name,'') [status], isnull(lu.us_username,'') [last updated by], bg_last_updated_date [last updated on]
 from bugs 
 left outer join bug_user on bu_bug = bg_id and bu_user = 1 
 left outer join users rpt on rpt.us_id = bg_reported_user
 left outer join users asg on asg.us_id = bg_assigned_to_user
 left outer join users lu on lu.us_id = bg_last_updated_user
 left outer join projects on pj_id = bg_project
 left outer join orgs on og_id = bg_org
 left outer join categories on ct_id = bg_category
 left outer join priorities on pr_id = bg_priority
 left outer join statuses on st_id = bg_status
  /* altered - just order by  */ WHERE  (bugs.bg_project not in (
					select pu_project
					from project_user_xref
					where pu_user = 1
					and pu_permission_level = 0)) order by bg_id desc
2016-08-10 10:23:30 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:23:33 http://192.168.6.173/ajax.aspx?bugid=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:23:33 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 10:23:33 http://192.168.6.173/ajax.aspx?bugid=1 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 1
2016-08-10 10:23:33 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 10:23:33 http://192.168.6.173/ajax.aspx?bugid=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:23:33 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 10:23:33 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:23:33 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:23:33 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 10:23:33 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:23:33 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 10:23:33 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:23:33 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 10:23:33 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:23:33 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 10:23:33 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:23:33 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:23:33 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:23:44 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:23:44 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:23:44 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 10:23:44 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:23:44 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* validate org versus assigned_to */
select case when og_other_orgs_permission_level <> 0
or 6 = og_id then 1
else 0 end as [answer]
from users
inner join orgs on us_org = og_id
where us_id = 10
2016-08-10 10:23:44 http://192.168.6.173/edit_bug.aspx?id=1 sql=
declare @permission_level int
		set @permission_level = -1
		select @permission_level = isnull(pu_permission_level,2)
		from project_user_xref
		where pu_project = 3
		and pu_user = 1
		if @permission_level = -1 set @permission_level = 2
		select @permission_level
2016-08-10 10:23:44 http://192.168.6.173/edit_bug.aspx?id=1 sql=
declare @now datetime
		declare @last_updated datetime
		select @last_updated = bg_last_updated_date from bugs where bg_id = 1
		if @last_updated > '20160810 10:23:33:280'
		begin
			-- signal that we did NOT do the update
			set @now = '20160810 10:23:33:280'
		end
		else
		begin
			-- signal that we DID do the update
			set @now = getdate()

			update bugs set
			bg_short_desc = N'Лишнее событие у изделия типа ''протяжка''',
			bg_tags = N'',
			bg_project = 3,
			bg_org = 6,
			bg_category = 1,
			bg_priority = 2,
			bg_assigned_to_user = 10,
			bg_status = 3,
			bg_last_updated_user = 1,
			bg_last_updated_date = @now,
			bg_user_defined_attribute = 0
            ,
bg_project_custom_dropdown_value1 = N'',
bg_project_custom_dropdown_value2 = N'',
bg_project_custom_dropdown_value3 = N''
	
			
			where bg_id = 1
		end
		select @now
2016-08-10 10:23:44 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 10:23:44 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:23:44 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:23:44 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 10:24:41 http://192.168.6.173/bugs.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:24:41 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:24:41 http://192.168.6.173/bugs.aspx sql=
/* query dropdown */
select qu_id, qu_desc
from queries
where (isnull(qu_user,0) = 0 and isnull(qu_org,0) = 0)
or isnull(qu_user,0) = 1
or isnull(qu_org,0) = 6
order by qu_desc
2016-08-10 10:24:41 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:24:41 http://192.168.6.173/bugs.aspx sql=
select qu_sql from queries where qu_id = 1
2016-08-10 10:24:41 http://192.168.6.173/bugs.aspx sql=
select isnull(pr_background_color,'#ffffff'), bg_id [id], isnull(bu_flag,0) [$FLAG], 
 bg_short_desc [desc], isnull(pj_name,'') [project], isnull(og_name,'') [organization], isnull(ct_name,'') [category], rpt.us_username [reported by],
 bg_reported_date [reported on], isnull(pr_name,'') [priority], isnull(asg.us_username,'') [assigned to],
 isnull(st_name,'') [status], isnull(lu.us_username,'') [last updated by], bg_last_updated_date [last updated on]
 from bugs 
 left outer join bug_user on bu_bug = bg_id and bu_user = 1 
 left outer join users rpt on rpt.us_id = bg_reported_user
 left outer join users asg on asg.us_id = bg_assigned_to_user
 left outer join users lu on lu.us_id = bg_last_updated_user
 left outer join projects on pj_id = bg_project
 left outer join orgs on og_id = bg_org
 left outer join categories on ct_id = bg_category
 left outer join priorities on pr_id = bg_priority
 left outer join statuses on st_id = bg_status
  /* altered - just order by  */ WHERE  (bugs.bg_project not in (
					select pu_project
					from project_user_xref
					where pu_user = 1
					and pu_permission_level = 0)) order by bg_id desc
2016-08-10 10:24:41 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:24:46 http://192.168.6.173/print_bugs2.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:24:46 http://192.168.6.173/print_bugs2.aspx elapsed milliseconds:0000
2016-08-10 10:24:46 http://192.168.6.173/print_bugs2.aspx sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 5
2016-08-10 10:24:46 http://192.168.6.173/print_bugs2.aspx elapsed milliseconds:0000
2016-08-10 10:24:46 http://192.168.6.173/print_bugs2.aspx sql=
select
					isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
					isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
					isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
					isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
					isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
					isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3]
					from projects where pj_id = 3
2016-08-10 10:24:46 http://192.168.6.173/print_bugs2.aspx elapsed milliseconds:0001
2016-08-10 10:24:46 http://192.168.6.173/print_bugs2.aspx sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:24:46 http://192.168.6.173/print_bugs2.aspx elapsed milliseconds:0000
2016-08-10 10:24:46 http://192.168.6.173/print_bugs2.aspx sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 4
2016-08-10 10:24:46 http://192.168.6.173/print_bugs2.aspx elapsed milliseconds:0000
2016-08-10 10:24:46 http://192.168.6.173/print_bugs2.aspx sql=
select
					isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
					isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
					isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
					isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
					isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
					isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3]
					from projects where pj_id = 3
2016-08-10 10:24:46 http://192.168.6.173/print_bugs2.aspx elapsed milliseconds:0000
2016-08-10 10:24:46 http://192.168.6.173/print_bugs2.aspx sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 4
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:24:46 http://192.168.6.173/print_bugs2.aspx elapsed milliseconds:0000
2016-08-10 10:24:46 http://192.168.6.173/print_bugs2.aspx sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 3
2016-08-10 10:24:46 http://192.168.6.173/print_bugs2.aspx elapsed milliseconds:0000
2016-08-10 10:24:46 http://192.168.6.173/print_bugs2.aspx sql=
select
					isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
					isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
					isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
					isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
					isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
					isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3]
					from projects where pj_id = 4
2016-08-10 10:24:46 http://192.168.6.173/print_bugs2.aspx elapsed milliseconds:0001
2016-08-10 10:24:46 http://192.168.6.173/print_bugs2.aspx sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 3
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:24:46 http://192.168.6.173/print_bugs2.aspx elapsed milliseconds:0000
2016-08-10 10:24:46 http://192.168.6.173/print_bugs2.aspx sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 1
2016-08-10 10:24:46 http://192.168.6.173/print_bugs2.aspx elapsed milliseconds:0000
2016-08-10 10:24:46 http://192.168.6.173/print_bugs2.aspx sql=
select
					isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
					isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
					isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
					isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
					isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
					isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3]
					from projects where pj_id = 3
2016-08-10 10:24:46 http://192.168.6.173/print_bugs2.aspx elapsed milliseconds:0000
2016-08-10 10:24:46 http://192.168.6.173/print_bugs2.aspx sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:24:46 http://192.168.6.173/print_bugs2.aspx elapsed milliseconds:0000
2016-08-10 10:27:25  threadproc_votes
2016-08-10 10:27:25  sql=

if exists (select * from dbo.sysobjects where id = object_id(N'[votes_view]'))
drop view [votes_view]
2016-08-10 10:27:25  sql=

create view votes_view as
select bu_bug as vote_bug, sum(bu_vote) as vote_total
from bug_user
group by bu_bug
having sum(bu_vote) > 0
2016-08-10 10:27:25  sql=

select bu_bug, count(1)
from bug_user 
where bu_vote = 1
group by bu_bug
2016-08-10 10:27:25  elapsed milliseconds:0000
2016-08-10 10:27:25  started creating Lucene index using folder C:\btnet364\www\App_Data\lucene_index
2016-08-10 10:27:25  sql=

/* get searchable cols */					
select sc.name
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
and st.[name] in ('nvarchar','varchar')
and sc.length > 30
2016-08-10 10:27:25  elapsed milliseconds:0000
2016-08-10 10:27:25  sql=

select bg_id, 	

isnull(bg_tags,'') bg_tags,
bg_short_desc
from bugs
2016-08-10 10:27:25  elapsed milliseconds:0000
2016-08-10 10:27:25  sql=

select bp_bug, bp_id, 
isnull(bp_comment_search,bp_comment) [text] 
from bug_posts 
where bp_type <> 'update'
and bp_hidden_from_external_users = 0
2016-08-10 10:27:25  elapsed milliseconds:0000
2016-08-10 10:27:25  done creating Lucene index
2016-08-10 10:27:29 http://192.168.6.173/print_bugs2.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = 'b4aebceb-f8b5-4641-8d8e-c86947f042b8'
and us_active = 1
2016-08-10 10:27:29 http://192.168.6.173/print_bugs2.aspx elapsed milliseconds:0000
2016-08-10 10:27:29 http://192.168.6.173/print_bugs2.aspx sql=

/* custom columns */ select sc.name, st.[name] [datatype], 
case when st.[name] = 'nvarchar' or st.[name] = 'nchar' then sc.length/2 else sc.length end as [length], 
sc.xprec, sc.xscale, sc.isnullable,
mm.text [default value], 
dflts.name [default name], 
isnull(ccm_dropdown_type,'') [dropdown type],
isnull(ccm_dropdown_vals,'') [vals],
isnull(ccm_sort_seq, sc.colorder) [column order],
sc.colorder
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
left outer join syscomments mm on sc.cdefault = mm.id
left outer join custom_col_metadata on ccm_colorder = sc.colorder
left outer join sysobjects dflts on dflts.id = mm.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
order by sc.id, isnull(ccm_sort_seq,sc.colorder)
2016-08-10 10:27:29 http://192.168.6.173/print_bugs2.aspx elapsed milliseconds:0000
2016-08-10 10:28:18 http://192.168.6.173/Default.aspx sql=
select count(1) from users
2016-08-10 10:28:20 http://192.168.6.173/Default.aspx sql=
select count(1) from users
2016-08-10 10:28:20 http://192.168.6.173/Default.aspx sql=

select us_username, us_id, us_password, isnull(us_salt,0) us_salt, us_active
from users
where us_username = N'admin'
2016-08-10 10:28:20 http://192.168.6.173/Default.aspx elapsed milliseconds:0000
2016-08-10 10:28:20 http://192.168.6.173/Default.aspx sql=
update users set us_most_recent_login_datetime = getdate() where us_id = 1
2016-08-10 10:28:20 http://192.168.6.173/Default.aspx sql=
select us_id from users where us_username = N'admin'
2016-08-10 10:28:20 http://192.168.6.173/Default.aspx elapsed milliseconds:0000
2016-08-10 10:28:20 http://192.168.6.173/Default.aspx guid=443fdfb6-9fbb-407b-ac44-6c12363c52a4
2016-08-10 10:28:20 http://192.168.6.173/Default.aspx sql=
insert into sessions (se_id, se_user) values('443fdfb6-9fbb-407b-ac44-6c12363c52a4', 1)
2016-08-10 10:28:20 http://192.168.6.173/Default.aspx AppPath:
2016-08-10 10:28:20 http://192.168.6.173/bugs.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:28:20 http://192.168.6.173/bugs.aspx elapsed milliseconds:0009
2016-08-10 10:28:20 http://192.168.6.173/bugs.aspx sql=
/* query dropdown */
select qu_id, qu_desc
from queries
where (isnull(qu_user,0) = 0 and isnull(qu_org,0) = 0)
or isnull(qu_user,0) = 1
or isnull(qu_org,0) = 6
order by qu_desc
2016-08-10 10:28:20 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:28:20 http://192.168.6.173/bugs.aspx sql=
select qu_id, qu_sql from queries where qu_id in
			(select us_default_query from users where us_id = 1)
2016-08-10 10:28:20 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:28:20 http://192.168.6.173/bugs.aspx sql=
select isnull(pr_background_color,'#ffffff'), bg_id [id], isnull(bu_flag,0) [$FLAG], 
 bg_short_desc [desc], isnull(pj_name,'') [project], isnull(og_name,'') [organization], isnull(ct_name,'') [category], rpt.us_username [reported by],
 bg_reported_date [reported on], isnull(pr_name,'') [priority], isnull(asg.us_username,'') [assigned to],
 isnull(st_name,'') [status], isnull(lu.us_username,'') [last updated by], bg_last_updated_date [last updated on]
 from bugs 
 left outer join bug_user on bu_bug = bg_id and bu_user = 1 
 left outer join users rpt on rpt.us_id = bg_reported_user
 left outer join users asg on asg.us_id = bg_assigned_to_user
 left outer join users lu on lu.us_id = bg_last_updated_user
 left outer join projects on pj_id = bg_project
 left outer join orgs on og_id = bg_org
 left outer join categories on ct_id = bg_category
 left outer join priorities on pr_id = bg_priority
 left outer join statuses on st_id = bg_status
  /* altered - just order by  */ WHERE  (bugs.bg_project not in (
					select pu_project
					from project_user_xref
					where pu_user = 1
					and pu_permission_level = 0)) order by bg_id desc
2016-08-10 10:28:20 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:28:24 http://192.168.6.173/reports.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:28:24 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 10:28:24 http://192.168.6.173/reports.aspx sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>pie</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>line</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>bar</a>'
	else
		'&nbsp;' end [view<br>chart],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>data</a>' [view<br>data]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>edit</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>delete</a>' [delete] 
from reports order by rp_desc
2016-08-10 10:28:24 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 10:28:37 http://192.168.6.173/dashboard.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:28:37 http://192.168.6.173/dashboard.aspx elapsed milliseconds:0000
2016-08-10 10:28:37 http://192.168.6.173/dashboard.aspx sql=

select ds.*, rp_desc
from dashboard_items ds
inner join reports on rp_id = ds_report
where ds_user = 1
order by ds_col, ds_row
2016-08-10 10:28:37 http://192.168.6.173/dashboard.aspx elapsed milliseconds:0000
2016-08-10 10:28:39 http://192.168.6.173/reports.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:28:39 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 10:28:39 http://192.168.6.173/reports.aspx sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>pie</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>line</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>bar</a>'
	else
		'&nbsp;' end [view<br>chart],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>data</a>' [view<br>data]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>edit</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>delete</a>' [delete] 
from reports order by rp_desc
2016-08-10 10:28:39 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 10:28:41 http://192.168.6.173/edit_report.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:28:41 http://192.168.6.173/edit_report.aspx elapsed milliseconds:0000
2016-08-10 10:28:44 http://192.168.6.173/reports.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:28:44 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 10:28:44 http://192.168.6.173/reports.aspx sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>pie</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>line</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>bar</a>'
	else
		'&nbsp;' end [view<br>chart],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>data</a>' [view<br>data]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>edit</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>delete</a>' [delete] 
from reports order by rp_desc
2016-08-10 10:28:44 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 10:28:46 http://192.168.6.173/bugs.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:28:46 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:28:46 http://192.168.6.173/bugs.aspx sql=
/* query dropdown */
select qu_id, qu_desc
from queries
where (isnull(qu_user,0) = 0 and isnull(qu_org,0) = 0)
or isnull(qu_user,0) = 1
or isnull(qu_org,0) = 6
order by qu_desc
2016-08-10 10:28:46 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:28:46 http://192.168.6.173/bugs.aspx sql=
select qu_sql from queries where qu_id = 1
2016-08-10 10:28:46 http://192.168.6.173/bugs.aspx sql=
select isnull(pr_background_color,'#ffffff'), bg_id [id], isnull(bu_flag,0) [$FLAG], 
 bg_short_desc [desc], isnull(pj_name,'') [project], isnull(og_name,'') [organization], isnull(ct_name,'') [category], rpt.us_username [reported by],
 bg_reported_date [reported on], isnull(pr_name,'') [priority], isnull(asg.us_username,'') [assigned to],
 isnull(st_name,'') [status], isnull(lu.us_username,'') [last updated by], bg_last_updated_date [last updated on]
 from bugs 
 left outer join bug_user on bu_bug = bg_id and bu_user = 1 
 left outer join users rpt on rpt.us_id = bg_reported_user
 left outer join users asg on asg.us_id = bg_assigned_to_user
 left outer join users lu on lu.us_id = bg_last_updated_user
 left outer join projects on pj_id = bg_project
 left outer join orgs on og_id = bg_org
 left outer join categories on ct_id = bg_category
 left outer join priorities on pr_id = bg_priority
 left outer join statuses on st_id = bg_status
  /* altered - just order by  */ WHERE  (bugs.bg_project not in (
					select pu_project
					from project_user_xref
					where pu_user = 1
					and pu_permission_level = 0)) order by bg_id desc
2016-08-10 10:28:46 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:28:47 http://192.168.6.173/ajax.aspx?bugid=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:28:47 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 10:28:47 http://192.168.6.173/ajax.aspx?bugid=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 10:28:47 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 10:28:47 http://192.168.6.173/ajax.aspx?bugid=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:28:47 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 10:28:48 http://192.168.6.173/ajax.aspx?bugid=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:28:48 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 10:28:48 http://192.168.6.173/ajax.aspx?bugid=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 10:28:48 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 10:28:48 http://192.168.6.173/ajax.aspx?bugid=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:28:48 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 10:28:48 http://192.168.6.173/ajax.aspx?bugid=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:28:48 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 10:28:48 http://192.168.6.173/ajax.aspx?bugid=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 10:28:48 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 10:28:48 http://192.168.6.173/ajax.aspx?bugid=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:28:48 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 10:28:48 http://192.168.6.173/edit_bug.aspx?id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:28:48 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 10:28:48 http://192.168.6.173/edit_bug.aspx?id=5 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 5
2016-08-10 10:28:48 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 10:28:48 http://192.168.6.173/edit_bug.aspx?id=5 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 10:28:48 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 10:28:48 http://192.168.6.173/edit_bug.aspx?id=5 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 10:28:48 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 10:28:48 http://192.168.6.173/edit_bug.aspx?id=5 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 10:28:48 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 10:28:48 http://192.168.6.173/edit_bug.aspx?id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:28:48 http://192.168.6.173/edit_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 10:28:54 http://192.168.6.173/print_bug.aspx?id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:28:54 http://192.168.6.173/print_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 10:28:54 http://192.168.6.173/print_bug.aspx?id=5 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 1
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 1
left outer join project_user_xref on pj_id = pu_project
and pu_user = 1
where bg_id = 5
2016-08-10 10:28:54 http://192.168.6.173/print_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 10:28:54 http://192.168.6.173/print_bug.aspx?id=5 sql=
select
					isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
					isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
					isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
					isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
					isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
					isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3]
					from projects where pj_id = 3
2016-08-10 10:28:54 http://192.168.6.173/print_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 10:28:54 http://192.168.6.173/print_bug.aspx?id=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:28:54 http://192.168.6.173/print_bug.aspx?id=5 elapsed milliseconds:0000
2016-08-10 10:29:01 http://192.168.6.173/reports.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:29:01 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 10:29:01 http://192.168.6.173/reports.aspx sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>pie</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>line</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>bar</a>'
	else
		'&nbsp;' end [view<br>chart],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>data</a>' [view<br>data]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>edit</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>delete</a>' [delete] 
from reports order by rp_desc
2016-08-10 10:29:01 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 10:30:50 http://192.168.6.173/reports.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:30:50 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 10:30:50 http://192.168.6.173/reports.aspx sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>pie</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>line</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>bar</a>'
	else
		'&nbsp;' end [view<br>chart],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>data</a>' [view<br>data]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>edit</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>delete</a>' [delete] 
from reports order by rp_desc
2016-08-10 10:30:50 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 10:30:52 http://192.168.6.173/bugs.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:30:52 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:30:52 http://192.168.6.173/bugs.aspx sql=
/* query dropdown */
select qu_id, qu_desc
from queries
where (isnull(qu_user,0) = 0 and isnull(qu_org,0) = 0)
or isnull(qu_user,0) = 1
or isnull(qu_org,0) = 6
order by qu_desc
2016-08-10 10:30:52 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:30:52 http://192.168.6.173/bugs.aspx sql=
select qu_sql from queries where qu_id = 1
2016-08-10 10:30:52 http://192.168.6.173/bugs.aspx sql=
select isnull(pr_background_color,'#ffffff'), bg_id [id], isnull(bu_flag,0) [$FLAG], 
 bg_short_desc [desc], isnull(pj_name,'') [project], isnull(og_name,'') [organization], isnull(ct_name,'') [category], rpt.us_username [reported by],
 bg_reported_date [reported on], isnull(pr_name,'') [priority], isnull(asg.us_username,'') [assigned to],
 isnull(st_name,'') [status], isnull(lu.us_username,'') [last updated by], bg_last_updated_date [last updated on]
 from bugs 
 left outer join bug_user on bu_bug = bg_id and bu_user = 1 
 left outer join users rpt on rpt.us_id = bg_reported_user
 left outer join users asg on asg.us_id = bg_assigned_to_user
 left outer join users lu on lu.us_id = bg_last_updated_user
 left outer join projects on pj_id = bg_project
 left outer join orgs on og_id = bg_org
 left outer join categories on ct_id = bg_category
 left outer join priorities on pr_id = bg_priority
 left outer join statuses on st_id = bg_status
  /* altered - just order by  */ WHERE  (bugs.bg_project not in (
					select pu_project
					from project_user_xref
					where pu_user = 1
					and pu_permission_level = 0)) order by bg_id desc
2016-08-10 10:30:52 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:30:52 http://192.168.6.173/bugs.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:30:52 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:30:52 http://192.168.6.173/bugs.aspx sql=
/* query dropdown */
select qu_id, qu_desc
from queries
where (isnull(qu_user,0) = 0 and isnull(qu_org,0) = 0)
or isnull(qu_user,0) = 1
or isnull(qu_org,0) = 6
order by qu_desc
2016-08-10 10:30:52 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:30:52 http://192.168.6.173/bugs.aspx sql=
select qu_sql from queries where qu_id = 1
2016-08-10 10:30:52 http://192.168.6.173/bugs.aspx sql=
select isnull(pr_background_color,'#ffffff'), bg_id [id], isnull(bu_flag,0) [$FLAG], 
 bg_short_desc [desc], isnull(pj_name,'') [project], isnull(og_name,'') [organization], isnull(ct_name,'') [category], rpt.us_username [reported by],
 bg_reported_date [reported on], isnull(pr_name,'') [priority], isnull(asg.us_username,'') [assigned to],
 isnull(st_name,'') [status], isnull(lu.us_username,'') [last updated by], bg_last_updated_date [last updated on]
 from bugs 
 left outer join bug_user on bu_bug = bg_id and bu_user = 1 
 left outer join users rpt on rpt.us_id = bg_reported_user
 left outer join users asg on asg.us_id = bg_assigned_to_user
 left outer join users lu on lu.us_id = bg_last_updated_user
 left outer join projects on pj_id = bg_project
 left outer join orgs on og_id = bg_org
 left outer join categories on ct_id = bg_category
 left outer join priorities on pr_id = bg_priority
 left outer join statuses on st_id = bg_status
  /* altered - just order by  */ WHERE  (bugs.bg_project not in (
					select pu_project
					from project_user_xref
					where pu_user = 1
					and pu_permission_level = 0)) order by bg_id desc
2016-08-10 10:30:52 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:30:54 http://192.168.6.173/reports.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:30:54 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 10:30:54 http://192.168.6.173/reports.aspx sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>pie</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>line</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>bar</a>'
	else
		'&nbsp;' end [view<br>chart],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>data</a>' [view<br>data]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>edit</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>delete</a>' [delete] 
from reports order by rp_desc
2016-08-10 10:30:54 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 10:31:17 http://192.168.6.173/reports.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:31:17 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 10:31:17 http://192.168.6.173/reports.aspx sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>pie</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>line</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>bar</a>'
	else
		'&nbsp;' end [view<br>chart],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>data</a>' [view<br>data]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>edit</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>delete</a>' [delete] 
from reports order by rp_desc
2016-08-10 10:31:17 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 10:31:20 http://192.168.6.173/bugs.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:31:20 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:31:20 http://192.168.6.173/bugs.aspx sql=
/* query dropdown */
select qu_id, qu_desc
from queries
where (isnull(qu_user,0) = 0 and isnull(qu_org,0) = 0)
or isnull(qu_user,0) = 1
or isnull(qu_org,0) = 6
order by qu_desc
2016-08-10 10:31:20 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:31:20 http://192.168.6.173/bugs.aspx sql=
select qu_sql from queries where qu_id = 1
2016-08-10 10:31:20 http://192.168.6.173/bugs.aspx sql=
select isnull(pr_background_color,'#ffffff'), bg_id [id], isnull(bu_flag,0) [$FLAG], 
 bg_short_desc [desc], isnull(pj_name,'') [project], isnull(og_name,'') [organization], isnull(ct_name,'') [category], rpt.us_username [reported by],
 bg_reported_date [reported on], isnull(pr_name,'') [priority], isnull(asg.us_username,'') [assigned to],
 isnull(st_name,'') [status], isnull(lu.us_username,'') [last updated by], bg_last_updated_date [last updated on]
 from bugs 
 left outer join bug_user on bu_bug = bg_id and bu_user = 1 
 left outer join users rpt on rpt.us_id = bg_reported_user
 left outer join users asg on asg.us_id = bg_assigned_to_user
 left outer join users lu on lu.us_id = bg_last_updated_user
 left outer join projects on pj_id = bg_project
 left outer join orgs on og_id = bg_org
 left outer join categories on ct_id = bg_category
 left outer join priorities on pr_id = bg_priority
 left outer join statuses on st_id = bg_status
  /* altered - just order by  */ WHERE  (bugs.bg_project not in (
					select pu_project
					from project_user_xref
					where pu_user = 1
					and pu_permission_level = 0)) order by bg_id desc
2016-08-10 10:31:20 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:31:22 http://192.168.6.173/reports.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:31:22 http://192.168.6.173/reports.aspx elapsed milliseconds:0001
2016-08-10 10:31:22 http://192.168.6.173/reports.aspx sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>pie</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>line</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>bar</a>'
	else
		'&nbsp;' end [view<br>chart],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>data</a>' [view<br>data]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>edit</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>delete</a>' [delete] 
from reports order by rp_desc
2016-08-10 10:31:22 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 10:31:22 http://192.168.6.173/reports.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:31:22 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 10:31:22 http://192.168.6.173/reports.aspx sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>pie</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>line</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>bar</a>'
	else
		'&nbsp;' end [view<br>chart],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>data</a>' [view<br>data]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>edit</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>delete</a>' [delete] 
from reports order by rp_desc
2016-08-10 10:31:22 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 10:31:27 http://192.168.6.173/search.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:31:27 http://192.168.6.173/search.aspx elapsed milliseconds:0000
2016-08-10 10:31:27 http://192.168.6.173/search.aspx sql=

/* get related users 2 */
select  pj_id, us_id,
case when 0 = 1 then
    case when len(isnull(us_firstname,'') + ' ' + isnull(us_lastname,'')) > 1
	then isnull(us_firstname,'') + ' ' + isnull(us_lastname,'')
    else us_username end
else us_username end us_username,
isnull(us_email,'') us_email
into #temp
from projects, users
where pj_id not in
(
	select pu_project from project_user_xref
	where pu_permission_level = 0 and pu_user = 1
)





if 0 = 1 -- external
and 2 = 0 -- other orgs
begin
	select distinct a.us_id, a.us_username, a.us_email
	from #temp a
	inner join users b on a.us_id = b.us_id
	inner join orgs on b.us_org = og_id
	where og_external_user = 0 or b.us_org = 6
	order by a.us_username
end
else
begin

	select distinct us_id, us_username, us_email
		from #temp
		left outer join project_user_xref on pj_id = pu_project
		and us_id = pu_user
		where isnull(pu_permission_level,2) <> 0
		order by us_username
end

drop table #temp
2016-08-10 10:31:27 http://192.168.6.173/search.aspx elapsed milliseconds:0012
2016-08-10 10:31:27 http://192.168.6.173/search.aspx sql=
/* drop downs */ select pj_id, pj_name from projects order by pj_name; select og_id, og_name from orgs order by og_name;
	select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
	select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
	select st_id, st_name from statuses order by st_sort_seq, st_name;
	select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name
2016-08-10 10:31:27 http://192.168.6.173/search.aspx elapsed milliseconds:0000
2016-08-10 10:31:27 http://192.168.6.173/search.aspx sql=

select count(1)
from projects
where isnull(pj_enable_custom_dropdown1,0) = 1
or isnull(pj_enable_custom_dropdown2,0) = 1
or isnull(pj_enable_custom_dropdown3,0) = 1
2016-08-10 10:31:31 http://192.168.6.173/bugs.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:31:31 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:31:31 http://192.168.6.173/bugs.aspx sql=
/* query dropdown */
select qu_id, qu_desc
from queries
where (isnull(qu_user,0) = 0 and isnull(qu_org,0) = 0)
or isnull(qu_user,0) = 1
or isnull(qu_org,0) = 6
order by qu_desc
2016-08-10 10:31:31 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:31:31 http://192.168.6.173/bugs.aspx sql=
select qu_sql from queries where qu_id = 1
2016-08-10 10:31:31 http://192.168.6.173/bugs.aspx sql=
select isnull(pr_background_color,'#ffffff'), bg_id [id], isnull(bu_flag,0) [$FLAG], 
 bg_short_desc [desc], isnull(pj_name,'') [project], isnull(og_name,'') [organization], isnull(ct_name,'') [category], rpt.us_username [reported by],
 bg_reported_date [reported on], isnull(pr_name,'') [priority], isnull(asg.us_username,'') [assigned to],
 isnull(st_name,'') [status], isnull(lu.us_username,'') [last updated by], bg_last_updated_date [last updated on]
 from bugs 
 left outer join bug_user on bu_bug = bg_id and bu_user = 1 
 left outer join users rpt on rpt.us_id = bg_reported_user
 left outer join users asg on asg.us_id = bg_assigned_to_user
 left outer join users lu on lu.us_id = bg_last_updated_user
 left outer join projects on pj_id = bg_project
 left outer join orgs on og_id = bg_org
 left outer join categories on ct_id = bg_category
 left outer join priorities on pr_id = bg_priority
 left outer join statuses on st_id = bg_status
  /* altered - just order by  */ WHERE  (bugs.bg_project not in (
					select pu_project
					from project_user_xref
					where pu_user = 1
					and pu_permission_level = 0)) order by bg_id desc
2016-08-10 10:31:31 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:31:33 http://192.168.6.173/queries.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:31:33 http://192.168.6.173/queries.aspx elapsed milliseconds:0000
2016-08-10 10:31:33 http://192.168.6.173/queries.aspx sql=
select
			qu_desc [query],
			case
				when isnull(qu_user,0) = 0 and isnull(qu_org,0) is null then 'everybody'
				when isnull(qu_user,0) <> 0 then 'user:' + us_username
				when isnull(qu_org,0) <> 0 then 'org:' + og_name
				else ' '
				end [visibility],
			'<a href=bugs.aspx?qu_id=' + convert(varchar,qu_id) + '>view list</a>' [view list],
			'<a target=_blank href=print_bugs.aspx?qu_id=' + convert(varchar,qu_id) + '>print list</a>' [print list],
			'<a target=_blank href=print_bugs.aspx?format=excel&qu_id=' + convert(varchar,qu_id) + '>export as excel</a>' [export as excel],
			'<a target=_blank href=print_bugs2.aspx?qu_id=' + convert(varchar,qu_id) + '>print detail</a>' [print list<br>with detail],
			'<a href=edit_query.aspx?id=' + convert(varchar,qu_id) + '>edit</a>' [edit],
			'<a href=delete_query.aspx?id=' + convert(varchar,qu_id) + '>delete</a>' [delete],
			replace(convert(nvarchar(4000),qu_sql), char(10),'<br>') [sql]
			from queries
			left outer join users on qu_user = us_id
			left outer join orgs on qu_org = og_id
			where 1 = 0 /* all */
			or isnull(qu_user,0) = 1
			or isnull(qu_user,0) = 0
			order by qu_desc
2016-08-10 10:31:33 http://192.168.6.173/queries.aspx elapsed milliseconds:0001
2016-08-10 10:31:37 http://192.168.6.173/reports.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:31:37 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 10:31:37 http://192.168.6.173/reports.aspx sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>pie</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>line</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>bar</a>'
	else
		'&nbsp;' end [view<br>chart],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>data</a>' [view<br>data]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>edit</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>delete</a>' [delete] 
from reports order by rp_desc
2016-08-10 10:31:37 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 10:31:51 http://192.168.6.173/view_report.aspx?view=chart&id=3 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:31:51 http://192.168.6.173/view_report.aspx?view=chart&id=3 elapsed milliseconds:0001
2016-08-10 10:31:51 http://192.168.6.173/view_report.aspx?view=chart&id=3 sql=
select rp_desc, rp_sql, rp_chart_type
		from reports
		where rp_id = 3
2016-08-10 10:31:51 http://192.168.6.173/view_report.aspx?view=chart&id=3 elapsed milliseconds:0001
2016-08-10 10:31:51 http://192.168.6.173/view_report.aspx?view=chart&id=3 sql=
select ct_name [category], count(1) [count] 
 from bugs 
 inner join categories on bg_category = ct_id 
 group by ct_name 
 order by ct_name
2016-08-10 10:31:51 http://192.168.6.173/view_report.aspx?view=chart&id=3 elapsed milliseconds:0005
2016-08-10 10:37:41 http://192.168.6.173/bugs.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:37:41 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:37:41 http://192.168.6.173/bugs.aspx sql=
/* query dropdown */
select qu_id, qu_desc
from queries
where (isnull(qu_user,0) = 0 and isnull(qu_org,0) = 0)
or isnull(qu_user,0) = 1
or isnull(qu_org,0) = 6
order by qu_desc
2016-08-10 10:37:41 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:37:41 http://192.168.6.173/bugs.aspx sql=
select qu_sql from queries where qu_id = 1
2016-08-10 10:37:41 http://192.168.6.173/bugs.aspx sql=
select isnull(pr_background_color,'#ffffff'), bg_id [id], isnull(bu_flag,0) [$FLAG], 
 bg_short_desc [desc], isnull(pj_name,'') [project], isnull(og_name,'') [organization], isnull(ct_name,'') [category], rpt.us_username [reported by],
 bg_reported_date [reported on], isnull(pr_name,'') [priority], isnull(asg.us_username,'') [assigned to],
 isnull(st_name,'') [status], isnull(lu.us_username,'') [last updated by], bg_last_updated_date [last updated on]
 from bugs 
 left outer join bug_user on bu_bug = bg_id and bu_user = 1 
 left outer join users rpt on rpt.us_id = bg_reported_user
 left outer join users asg on asg.us_id = bg_assigned_to_user
 left outer join users lu on lu.us_id = bg_last_updated_user
 left outer join projects on pj_id = bg_project
 left outer join orgs on og_id = bg_org
 left outer join categories on ct_id = bg_category
 left outer join priorities on pr_id = bg_priority
 left outer join statuses on st_id = bg_status
  /* altered - just order by  */ WHERE  (bugs.bg_project not in (
					select pu_project
					from project_user_xref
					where pu_user = 1
					and pu_permission_level = 0)) order by bg_id desc
2016-08-10 10:37:41 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:37:42 http://192.168.6.173/ajax.aspx?bugid=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:37:42 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 10:37:42 http://192.168.6.173/ajax.aspx?bugid=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 10:37:42 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 10:37:42 http://192.168.6.173/ajax.aspx?bugid=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:37:42 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 10:37:44 http://192.168.6.173/ajax.aspx?bugid=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:37:44 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 10:37:44 http://192.168.6.173/ajax.aspx?bugid=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 1
where bg_id = 5
2016-08-10 10:37:44 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 10:37:44 http://192.168.6.173/ajax.aspx?bugid=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 10:37:44 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 10:37:45 http://192.168.6.173/bugs.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:37:45 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:37:45 http://192.168.6.173/bugs.aspx sql=
/* query dropdown */
select qu_id, qu_desc
from queries
where (isnull(qu_user,0) = 0 and isnull(qu_org,0) = 0)
or isnull(qu_user,0) = 1
or isnull(qu_org,0) = 6
order by qu_desc
2016-08-10 10:37:45 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:37:45 http://192.168.6.173/bugs.aspx sql=
select qu_sql from queries where qu_id = 1
2016-08-10 10:37:45 http://192.168.6.173/bugs.aspx sql=
select isnull(pr_background_color,'#ffffff'), bg_id [id], isnull(bu_flag,0) [$FLAG], 
 bg_short_desc [desc], isnull(pj_name,'') [project], isnull(og_name,'') [organization], isnull(ct_name,'') [category], rpt.us_username [reported by],
 bg_reported_date [reported on], isnull(pr_name,'') [priority], isnull(asg.us_username,'') [assigned to],
 isnull(st_name,'') [status], isnull(lu.us_username,'') [last updated by], bg_last_updated_date [last updated on]
 from bugs 
 left outer join bug_user on bu_bug = bg_id and bu_user = 1 
 left outer join users rpt on rpt.us_id = bg_reported_user
 left outer join users asg on asg.us_id = bg_assigned_to_user
 left outer join users lu on lu.us_id = bg_last_updated_user
 left outer join projects on pj_id = bg_project
 left outer join orgs on og_id = bg_org
 left outer join categories on ct_id = bg_category
 left outer join priorities on pr_id = bg_priority
 left outer join statuses on st_id = bg_status
  /* altered - just order by  */ WHERE  (bugs.bg_project not in (
					select pu_project
					from project_user_xref
					where pu_user = 1
					and pu_permission_level = 0)) order by bg_id desc
2016-08-10 10:37:45 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 10:37:48 http://192.168.6.173/reports.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:37:48 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 10:37:48 http://192.168.6.173/reports.aspx sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>pie</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>line</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>bar</a>'
	else
		'&nbsp;' end [view<br>chart],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>data</a>' [view<br>data]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>edit</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>delete</a>' [delete] 
from reports order by rp_desc
2016-08-10 10:37:48 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 10:41:36 http://192.168.6.173/reports.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:41:36 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 10:41:36 http://192.168.6.173/reports.aspx sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>pie</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>line</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>bar</a>'
	else
		'&nbsp;' end [view<br>chart],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>data</a>' [view<br>data]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>edit</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>delete</a>' [delete] 
from reports order by rp_desc
2016-08-10 10:41:36 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 10:41:40 http://192.168.6.173/edit_report.aspx?id=3 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:41:40 http://192.168.6.173/edit_report.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:41:40 http://192.168.6.173/edit_report.aspx?id=3 sql=
select
				rp_desc, rp_sql, rp_chart_type
				from reports where rp_id = 3
2016-08-10 10:41:40 http://192.168.6.173/edit_report.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:42:15 http://192.168.6.173/reports.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:42:15 http://192.168.6.173/reports.aspx elapsed milliseconds:0001
2016-08-10 10:42:15 http://192.168.6.173/reports.aspx sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>pie</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>line</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>bar</a>'
	else
		'&nbsp;' end [view<br>chart],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>data</a>' [view<br>data]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>edit</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>delete</a>' [delete] 
from reports order by rp_desc
2016-08-10 10:42:15 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 10:44:14 http://192.168.6.173/reports.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:44:14 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 10:44:14 http://192.168.6.173/reports.aspx sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>круговая</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>график</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>столбцы</a>'
	else
		'&nbsp;' end [view<br>chart],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>данные</a>' [view<br>data]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>редактировать</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>удалить</a>' [delete] 
from reports order by rp_desc
2016-08-10 10:44:14 http://192.168.6.173/reports.aspx elapsed milliseconds:0002
2016-08-10 10:44:19 http://192.168.6.173/view_report.aspx?view=chart&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:44:19 http://192.168.6.173/view_report.aspx?view=chart&id=5 elapsed milliseconds:0000
2016-08-10 10:44:19 http://192.168.6.173/view_report.aspx?view=chart&id=5 sql=
select rp_desc, rp_sql, rp_chart_type
		from reports
		where rp_id = 5
2016-08-10 10:44:19 http://192.168.6.173/view_report.aspx?view=chart&id=5 elapsed milliseconds:0000
2016-08-10 10:44:19 http://192.168.6.173/view_report.aspx?view=chart&id=5 sql=
select datepart(dy, bg_reported_date) [day of year], count(1) [count] 
 from bugs 
 group by datepart(dy, bg_reported_date), 
 datepart(dy,bg_reported_date) order by 1
2016-08-10 10:44:19 http://192.168.6.173/view_report.aspx?view=chart&id=5 elapsed milliseconds:0003
2016-08-10 10:50:31 http://192.168.6.173/reports.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:50:31 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 10:50:31 http://192.168.6.173/reports.aspx sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>круговая</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>график</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>столбцы</a>'
	else
		'&nbsp;' end [view<br>chart],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>данные</a>' [view<br>data]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>редактировать</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>удалить</a>' [delete] 
from reports order by rp_desc
2016-08-10 10:50:31 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 10:51:21 http://192.168.6.173/edit_report.aspx?id=3 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:51:21 http://192.168.6.173/edit_report.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:51:21 http://192.168.6.173/edit_report.aspx?id=3 sql=
select
				rp_desc, rp_sql, rp_chart_type
				from reports where rp_id = 3
2016-08-10 10:51:21 http://192.168.6.173/edit_report.aspx?id=3 elapsed milliseconds:0000
2016-08-10 10:51:30 http://192.168.6.173/reports.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:51:30 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 10:51:30 http://192.168.6.173/reports.aspx sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>круговая</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>график</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>столбцы</a>'
	else
		'&nbsp;' end [view<br>chart],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>данные</a>' [view<br>data]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>редактировать</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>удалить</a>' [delete] 
from reports order by rp_desc
2016-08-10 10:51:30 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 10:53:51 http://192.168.6.173/reports.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:53:51 http://192.168.6.173/reports.aspx elapsed milliseconds:0006
2016-08-10 10:53:51 http://192.168.6.173/reports.aspx sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>круговая</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>график</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>столбцы</a>'
	else
		'&nbsp;' end [view<br>chart],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>данные</a>' [view<br>data]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>редактировать</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>удалить</a>' [delete] 
from reports order by rp_desc
2016-08-10 10:53:51 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 10:59:41 http://192.168.6.173/dashboard.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:59:41 http://192.168.6.173/dashboard.aspx elapsed milliseconds:0000
2016-08-10 10:59:41 http://192.168.6.173/dashboard.aspx sql=

select ds.*, rp_desc
from dashboard_items ds
inner join reports on rp_id = ds_report
where ds_user = 1
order by ds_col, ds_row
2016-08-10 10:59:41 http://192.168.6.173/dashboard.aspx elapsed milliseconds:0000
2016-08-10 10:59:43 http://192.168.6.173/edit_dashboard.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:59:43 http://192.168.6.173/edit_dashboard.aspx elapsed milliseconds:0000
2016-08-10 10:59:43 http://192.168.6.173/edit_dashboard.aspx sql=

select ds_id, ds_col, ds_row, ds_chart_type, rp_desc
from dashboard_items ds
inner join reports on rp_id = ds_report
where ds_user = 1
order by ds_col, ds_row
2016-08-10 10:59:43 http://192.168.6.173/edit_dashboard.aspx elapsed milliseconds:0000
2016-08-10 10:59:49 http://192.168.6.173/select_report.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:59:49 http://192.168.6.173/select_report.aspx elapsed milliseconds:0000
2016-08-10 10:59:49 http://192.168.6.173/select_report.aspx sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a href=''javascript:select_report("pie",' + convert(varchar, rp_id) + ')''>select pie</a>'
	when rp_chart_type = 'line' then
		'<a href=''javascript:select_report("line",' + convert(varchar, rp_id) + ')''>select line</a>'
	when rp_chart_type = 'bar' then
		'<a href=''javascript:select_report("bar",' + convert(varchar, rp_id) + ')''>select bar</a>'
	else
		'&nbsp;' end [chart],
'<a href=''javascript:select_report("data",' + convert(varchar, rp_id) + ')''>select data</a>' [data]
from reports order by rp_desc
2016-08-10 10:59:49 http://192.168.6.173/select_report.aspx elapsed milliseconds:0002
2016-08-10 10:59:58 http://192.168.6.173/dashboard.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 10:59:58 http://192.168.6.173/dashboard.aspx elapsed milliseconds:0000
2016-08-10 10:59:58 http://192.168.6.173/dashboard.aspx sql=

select ds.*, rp_desc
from dashboard_items ds
inner join reports on rp_id = ds_report
where ds_user = 1
order by ds_col, ds_row
2016-08-10 10:59:58 http://192.168.6.173/dashboard.aspx elapsed milliseconds:0000
2016-08-10 11:00:01 http://192.168.6.173/reports.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:00:01 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 11:00:01 http://192.168.6.173/reports.aspx sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>круговая</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>график</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>столбцы</a>'
	else
		'&nbsp;' end [view<br>chart],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>данные</a>' [view<br>data]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>редактировать</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>удалить</a>' [delete] 
from reports order by rp_desc
2016-08-10 11:00:01 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 11:00:04 http://192.168.6.173/edit_report.aspx?id=3 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:00:04 http://192.168.6.173/edit_report.aspx?id=3 elapsed milliseconds:0000
2016-08-10 11:00:04 http://192.168.6.173/edit_report.aspx?id=3 sql=
select
				rp_desc, rp_sql, rp_chart_type
				from reports where rp_id = 3
2016-08-10 11:00:04 http://192.168.6.173/edit_report.aspx?id=3 elapsed milliseconds:0000
2016-08-10 11:00:18 http://192.168.6.173/edit_report.aspx?id=3 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:00:18 http://192.168.6.173/edit_report.aspx?id=3 elapsed milliseconds:0000
2016-08-10 11:00:18 http://192.168.6.173/edit_report.aspx?id=3 sql=
update reports set
				rp_desc = N'По категориям',
				rp_sql = N'select ct_name [category], count(1) [count] 
 from bugs 
 inner join categories on bg_category = ct_id 
 group by ct_name 
 order by ct_name',
				rp_chart_type = N'pie'
				where rp_id = 3
2016-08-10 11:00:18 http://192.168.6.173/edit_report.aspx?id=3 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:00:18 http://192.168.6.173/edit_report.aspx?id=3 elapsed milliseconds:0001
2016-08-10 11:00:18 http://192.168.6.173/edit_report.aspx?id=3 sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>круговая</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>график</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>столбцы</a>'
	else
		'&nbsp;' end [view<br>chart],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>данные</a>' [view<br>data]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>редактировать</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>удалить</a>' [delete] 
from reports order by rp_desc
2016-08-10 11:00:18 http://192.168.6.173/edit_report.aspx?id=3 elapsed milliseconds:0000
2016-08-10 11:00:23 http://192.168.6.173/edit_report.aspx?id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:00:23 http://192.168.6.173/edit_report.aspx?id=5 elapsed milliseconds:0000
2016-08-10 11:00:23 http://192.168.6.173/edit_report.aspx?id=5 sql=
select
				rp_desc, rp_sql, rp_chart_type
				from reports where rp_id = 5
2016-08-10 11:00:23 http://192.168.6.173/edit_report.aspx?id=5 elapsed milliseconds:0000
2016-08-10 11:00:35 http://192.168.6.173/edit_report.aspx?id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:00:35 http://192.168.6.173/edit_report.aspx?id=5 elapsed milliseconds:0000
2016-08-10 11:00:35 http://192.168.6.173/edit_report.aspx?id=5 sql=
update reports set
				rp_desc = N'По дням в году',
				rp_sql = N'select datepart(dy, bg_reported_date) [day of year], count(1) [count] 
 from bugs 
 group by datepart(dy, bg_reported_date), 
 datepart(dy,bg_reported_date) order by 1',
				rp_chart_type = N'line'
				where rp_id = 5
2016-08-10 11:00:35 http://192.168.6.173/edit_report.aspx?id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:00:35 http://192.168.6.173/edit_report.aspx?id=5 elapsed milliseconds:0000
2016-08-10 11:00:35 http://192.168.6.173/edit_report.aspx?id=5 sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>круговая</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>график</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>столбцы</a>'
	else
		'&nbsp;' end [view<br>chart],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>данные</a>' [view<br>data]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>редактировать</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>удалить</a>' [delete] 
from reports order by rp_desc
2016-08-10 11:00:35 http://192.168.6.173/edit_report.aspx?id=5 elapsed milliseconds:0000
2016-08-10 11:00:37 http://192.168.6.173/edit_report.aspx?id=4 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:00:37 http://192.168.6.173/edit_report.aspx?id=4 elapsed milliseconds:0000
2016-08-10 11:00:37 http://192.168.6.173/edit_report.aspx?id=4 sql=
select
				rp_desc, rp_sql, rp_chart_type
				from reports where rp_id = 4
2016-08-10 11:00:37 http://192.168.6.173/edit_report.aspx?id=4 elapsed milliseconds:0000
2016-08-10 11:00:43 http://192.168.6.173/edit_report.aspx?id=4 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:00:43 http://192.168.6.173/edit_report.aspx?id=4 elapsed milliseconds:0000
2016-08-10 11:00:43 http://192.168.6.173/edit_report.aspx?id=4 sql=
update reports set
				rp_desc = N'По месяцам',
				rp_sql = N'select month(bg_reported_date) [month], count(1) [count] 
 from bugs 
 group by year(bg_reported_date), month(bg_reported_date) 
 order by year(bg_reported_date), month(bg_reported_date)',
				rp_chart_type = N'bar'
				where rp_id = 4
2016-08-10 11:00:43 http://192.168.6.173/edit_report.aspx?id=4 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:00:43 http://192.168.6.173/edit_report.aspx?id=4 elapsed milliseconds:0000
2016-08-10 11:00:43 http://192.168.6.173/edit_report.aspx?id=4 sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>круговая</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>график</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>столбцы</a>'
	else
		'&nbsp;' end [view<br>chart],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>данные</a>' [view<br>data]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>редактировать</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>удалить</a>' [delete] 
from reports order by rp_desc
2016-08-10 11:00:43 http://192.168.6.173/edit_report.aspx?id=4 elapsed milliseconds:0000
2016-08-10 11:00:45 http://192.168.6.173/edit_report.aspx?id=2 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:00:45 http://192.168.6.173/edit_report.aspx?id=2 elapsed milliseconds:0000
2016-08-10 11:00:45 http://192.168.6.173/edit_report.aspx?id=2 sql=
select
				rp_desc, rp_sql, rp_chart_type
				from reports where rp_id = 2
2016-08-10 11:00:45 http://192.168.6.173/edit_report.aspx?id=2 elapsed milliseconds:0000
2016-08-10 11:00:53 http://192.168.6.173/edit_report.aspx?id=2 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:00:53 http://192.168.6.173/edit_report.aspx?id=2 elapsed milliseconds:0000
2016-08-10 11:00:53 http://192.168.6.173/edit_report.aspx?id=2 sql=
update reports set
				rp_desc = N'По приоритету',
				rp_sql = N'select pr_name [priority], count(1) [count] 
 from bugs 
 inner join priorities on bg_priority = pr_id 
 group by pr_name 
 order by pr_name',
				rp_chart_type = N'pie'
				where rp_id = 2
2016-08-10 11:00:53 http://192.168.6.173/edit_report.aspx?id=2 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:00:53 http://192.168.6.173/edit_report.aspx?id=2 elapsed milliseconds:0000
2016-08-10 11:00:53 http://192.168.6.173/edit_report.aspx?id=2 sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>круговая</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>график</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>столбцы</a>'
	else
		'&nbsp;' end [view<br>chart],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>данные</a>' [view<br>data]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>редактировать</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>удалить</a>' [delete] 
from reports order by rp_desc
2016-08-10 11:00:53 http://192.168.6.173/edit_report.aspx?id=2 elapsed milliseconds:0000
2016-08-10 11:00:55 http://192.168.6.173/edit_report.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:00:55 http://192.168.6.173/edit_report.aspx?id=1 elapsed milliseconds:0000
2016-08-10 11:00:55 http://192.168.6.173/edit_report.aspx?id=1 sql=
select
				rp_desc, rp_sql, rp_chart_type
				from reports where rp_id = 1
2016-08-10 11:00:55 http://192.168.6.173/edit_report.aspx?id=1 elapsed milliseconds:0000
2016-08-10 11:01:01 http://192.168.6.173/edit_report.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:01:01 http://192.168.6.173/edit_report.aspx?id=1 elapsed milliseconds:0000
2016-08-10 11:01:01 http://192.168.6.173/edit_report.aspx?id=1 sql=
update reports set
				rp_desc = N'По статусу',
				rp_sql = N'select st_name [status], count(1) [count] 
 from bugs 
 inner join statuses on bg_status = st_id 
 group by st_name 
 order by st_name',
				rp_chart_type = N'pie'
				where rp_id = 1
2016-08-10 11:01:01 http://192.168.6.173/edit_report.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:01:01 http://192.168.6.173/edit_report.aspx?id=1 elapsed milliseconds:0001
2016-08-10 11:01:01 http://192.168.6.173/edit_report.aspx?id=1 sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>круговая</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>график</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>столбцы</a>'
	else
		'&nbsp;' end [view<br>chart],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>данные</a>' [view<br>data]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>редактировать</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>удалить</a>' [delete] 
from reports order by rp_desc
2016-08-10 11:01:01 http://192.168.6.173/edit_report.aspx?id=1 elapsed milliseconds:0000
2016-08-10 11:01:03 http://192.168.6.173/edit_report.aspx?id=6 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:01:03 http://192.168.6.173/edit_report.aspx?id=6 elapsed milliseconds:0000
2016-08-10 11:01:03 http://192.168.6.173/edit_report.aspx?id=6 sql=
select
				rp_desc, rp_sql, rp_chart_type
				from reports where rp_id = 6
2016-08-10 11:01:03 http://192.168.6.173/edit_report.aspx?id=6 elapsed milliseconds:0000
2016-08-10 11:01:10 http://192.168.6.173/edit_report.aspx?id=6 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:01:10 http://192.168.6.173/edit_report.aspx?id=6 elapsed milliseconds:0000
2016-08-10 11:01:10 http://192.168.6.173/edit_report.aspx?id=6 sql=
update reports set
				rp_desc = N'По пользователям',
				rp_sql = N'select bg_reported_user, count(1) [r] 
 into #t 
 from bugs 
 group by bg_reported_user; 
 select bg_assigned_to_user, count(1) [a] 
 into #t2 
 from bugs 
 group by bg_assigned_to_user; 
 select us_username, r [reported], a [assigned] 
 from users 
 left outer join #t on bg_reported_user = us_id 
 left outer join #t2 on bg_assigned_to_user = us_id 
 order by 1',
				rp_chart_type = N'table'
				where rp_id = 6
2016-08-10 11:01:10 http://192.168.6.173/edit_report.aspx?id=6 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:01:10 http://192.168.6.173/edit_report.aspx?id=6 elapsed milliseconds:0000
2016-08-10 11:01:10 http://192.168.6.173/edit_report.aspx?id=6 sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>круговая</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>график</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>столбцы</a>'
	else
		'&nbsp;' end [view<br>chart],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>данные</a>' [view<br>data]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>редактировать</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>удалить</a>' [delete] 
from reports order by rp_desc
2016-08-10 11:01:10 http://192.168.6.173/edit_report.aspx?id=6 elapsed milliseconds:0000
2016-08-10 11:01:13 http://192.168.6.173/edit_report.aspx?id=7 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:01:13 http://192.168.6.173/edit_report.aspx?id=7 elapsed milliseconds:0000
2016-08-10 11:01:13 http://192.168.6.173/edit_report.aspx?id=7 sql=
select
				rp_desc, rp_sql, rp_chart_type
				from reports where rp_id = 7
2016-08-10 11:01:13 http://192.168.6.173/edit_report.aspx?id=7 elapsed milliseconds:0000
2016-08-10 11:01:41 http://192.168.6.173/edit_report.aspx?id=7 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:01:41 http://192.168.6.173/edit_report.aspx?id=7 elapsed milliseconds:0000
2016-08-10 11:01:41 http://192.168.6.173/edit_report.aspx?id=7 sql=
update reports set
				rp_desc = N'Время по организации',
				rp_sql = N'select og_name [organization], 
 datepart(year,tsk_created_date) [year],  
 datepart(month,tsk_created_date) [month], 
 convert(decimal(8,1),sum( 
 case when tsk_duration_units = ''minutes'' then tsk_actual_duration / 60.0 
 when tsk_duration_units = ''days'' then tsk_actual_duration * 8.0  
 else tsk_actual_duration * 1.0 end)) [total hours] 
 from bug_tasks 
 inner join bugs on tsk_bug = bg_id 
 inner join orgs on bg_org = og_id 
 where isnull(tsk_actual_duration,0) <> 0 
 group by og_name,datepart(year,tsk_created_date), datepart(month,tsk_created_date) ',
				rp_chart_type = N'table'
				where rp_id = 7
2016-08-10 11:01:41 http://192.168.6.173/edit_report.aspx?id=7 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:01:41 http://192.168.6.173/edit_report.aspx?id=7 elapsed milliseconds:0000
2016-08-10 11:01:41 http://192.168.6.173/edit_report.aspx?id=7 sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>круговая</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>график</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>столбцы</a>'
	else
		'&nbsp;' end [view<br>chart],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>данные</a>' [view<br>data]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>редактировать</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>удалить</a>' [delete] 
from reports order by rp_desc
2016-08-10 11:01:41 http://192.168.6.173/edit_report.aspx?id=7 elapsed milliseconds:0000
2016-08-10 11:01:50 http://192.168.6.173/edit_report.aspx?id=8 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:01:50 http://192.168.6.173/edit_report.aspx?id=8 elapsed milliseconds:0000
2016-08-10 11:01:50 http://192.168.6.173/edit_report.aspx?id=8 sql=
select
				rp_desc, rp_sql, rp_chart_type
				from reports where rp_id = 8
2016-08-10 11:01:50 http://192.168.6.173/edit_report.aspx?id=8 elapsed milliseconds:0000
2016-08-10 11:02:01 http://192.168.6.173/edit_report.aspx?id=8 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:02:01 http://192.168.6.173/edit_report.aspx?id=8 elapsed milliseconds:0000
2016-08-10 11:02:01 http://192.168.6.173/edit_report.aspx?id=8 sql=
update reports set
				rp_desc = N'Часы по проекту',
				rp_sql = N'select pj_name [project], 
 convert(decimal(8,1),sum( 
 case  
 when tsk_duration_units = ''minutes'' then  
 tsk_planned_duration / 60.0 * .01 * (100 - isnull(tsk_percent_complete,0)) 
 when tsk_duration_units = ''days'' then 
 tsk_planned_duration * 8.0  * .01 * (100 - isnull(tsk_percent_complete,0)) 
 else tsk_planned_duration * .01 * (100 - isnull(tsk_percent_complete,0)) 
 end)) [total hours] 
 from bug_tasks 
 inner join bugs on tsk_bug = bg_id 
 inner join projects on bg_project = pj_id 
 where isnull(tsk_planned_duration,0) <> 0 
 group by pj_name ',
				rp_chart_type = N'table'
				where rp_id = 8
2016-08-10 11:02:01 http://192.168.6.173/edit_report.aspx?id=8 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:02:01 http://192.168.6.173/edit_report.aspx?id=8 elapsed milliseconds:0000
2016-08-10 11:02:01 http://192.168.6.173/edit_report.aspx?id=8 sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>круговая</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>график</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>столбцы</a>'
	else
		'&nbsp;' end [view<br>chart],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>данные</a>' [view<br>data]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>редактировать</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>удалить</a>' [delete] 
from reports order by rp_desc
2016-08-10 11:02:01 http://192.168.6.173/edit_report.aspx?id=8 elapsed milliseconds:0000
2016-08-10 11:31:02 http://192.168.6.173/Default.aspx sql=
select count(1) from users
2016-08-10 11:31:23 http://192.168.6.173/Default.aspx sql=
select count(1) from users
2016-08-10 11:31:23 http://192.168.6.173/Default.aspx sql=

select us_username, us_id, us_password, isnull(us_salt,0) us_salt, us_active
from users
where us_username = N'ivan'
2016-08-10 11:31:23 http://192.168.6.173/Default.aspx elapsed milliseconds:0001
2016-08-10 11:31:23 http://192.168.6.173/Default.aspx sql=
update users set us_most_recent_login_datetime = getdate() where us_id = 14
2016-08-10 11:31:23 http://192.168.6.173/Default.aspx sql=
select us_id from users where us_username = N'ivan'
2016-08-10 11:31:23 http://192.168.6.173/Default.aspx elapsed milliseconds:0000
2016-08-10 11:31:23 http://192.168.6.173/Default.aspx guid=164c59d7-f69f-4e7a-813e-436057e23f3b
2016-08-10 11:31:23 http://192.168.6.173/Default.aspx sql=
insert into sessions (se_id, se_user) values('164c59d7-f69f-4e7a-813e-436057e23f3b', 14)
2016-08-10 11:31:23 http://192.168.6.173/Default.aspx AppPath:
2016-08-10 11:31:25 http://192.168.6.173/bugs.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:31:25 http://192.168.6.173/bugs.aspx elapsed milliseconds:0009
2016-08-10 11:31:25 http://192.168.6.173/bugs.aspx sql=
/* query dropdown */
select qu_id, qu_desc
from queries
where (isnull(qu_user,0) = 0 and isnull(qu_org,0) = 0)
or isnull(qu_user,0) = 14
or isnull(qu_org,0) = 6
order by qu_desc
2016-08-10 11:31:25 http://192.168.6.173/bugs.aspx elapsed milliseconds:0002
2016-08-10 11:31:25 http://192.168.6.173/bugs.aspx sql=
select qu_id, qu_sql from queries where qu_id in
			(select us_default_query from users where us_id = 14)
2016-08-10 11:31:25 http://192.168.6.173/bugs.aspx elapsed milliseconds:0002
2016-08-10 11:31:25 http://192.168.6.173/bugs.aspx sql=
select isnull(pr_background_color,'#ffffff'), bg_id [id], isnull(bu_flag,0) [$FLAG], 
 bg_short_desc [desc], isnull(pj_name,'') [project], isnull(og_name,'') [organization], isnull(ct_name,'') [category], rpt.us_username [reported by],
 bg_reported_date [reported on], isnull(pr_name,'') [priority], isnull(asg.us_username,'') [assigned to],
 isnull(st_name,'') [status], isnull(lu.us_username,'') [last updated by], bg_last_updated_date [last updated on]
 from bugs 
 left outer join bug_user on bu_bug = bg_id and bu_user = 14 
 left outer join users rpt on rpt.us_id = bg_reported_user
 left outer join users asg on asg.us_id = bg_assigned_to_user
 left outer join users lu on lu.us_id = bg_last_updated_user
 left outer join projects on pj_id = bg_project
 left outer join orgs on og_id = bg_org
 left outer join categories on ct_id = bg_category
 left outer join priorities on pr_id = bg_priority
 left outer join statuses on st_id = bg_status
 where /* altered - both  */ (  bg_status <> 5 and bg_assigned_to_user = 14  ) AND (  (bugs.bg_project not in (
					select pu_project
					from project_user_xref
					where pu_user = 14
					and pu_permission_level = 0))  ) order by bg_id desc
2016-08-10 11:31:25 http://192.168.6.173/bugs.aspx elapsed milliseconds:0016
2016-08-10 11:31:39 http://192.168.6.173/bugs.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:31:39 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 11:31:39 http://192.168.6.173/bugs.aspx sql=
select qu_sql from queries where qu_id = 1
2016-08-10 11:31:39 http://192.168.6.173/bugs.aspx sql=
select isnull(pr_background_color,'#ffffff'), bg_id [id], isnull(bu_flag,0) [$FLAG], 
 bg_short_desc [desc], isnull(pj_name,'') [project], isnull(og_name,'') [organization], isnull(ct_name,'') [category], rpt.us_username [reported by],
 bg_reported_date [reported on], isnull(pr_name,'') [priority], isnull(asg.us_username,'') [assigned to],
 isnull(st_name,'') [status], isnull(lu.us_username,'') [last updated by], bg_last_updated_date [last updated on]
 from bugs 
 left outer join bug_user on bu_bug = bg_id and bu_user = 14 
 left outer join users rpt on rpt.us_id = bg_reported_user
 left outer join users asg on asg.us_id = bg_assigned_to_user
 left outer join users lu on lu.us_id = bg_last_updated_user
 left outer join projects on pj_id = bg_project
 left outer join orgs on og_id = bg_org
 left outer join categories on ct_id = bg_category
 left outer join priorities on pr_id = bg_priority
 left outer join statuses on st_id = bg_status
  /* altered - just order by  */ WHERE  (bugs.bg_project not in (
					select pu_project
					from project_user_xref
					where pu_user = 14
					and pu_permission_level = 0)) order by bg_id desc
2016-08-10 11:31:39 http://192.168.6.173/bugs.aspx elapsed milliseconds:0017
2016-08-10 11:31:40 http://192.168.6.173/ajax.aspx?bugid=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:31:40 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 11:31:40 http://192.168.6.173/ajax.aspx?bugid=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 14
where bg_id = 5
2016-08-10 11:31:40 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0002
2016-08-10 11:31:40 http://192.168.6.173/ajax.aspx?bugid=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 11:31:40 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 11:31:40 http://192.168.6.173/ajax.aspx?bugid=4 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:31:40 http://192.168.6.173/ajax.aspx?bugid=4 elapsed milliseconds:0000
2016-08-10 11:31:40 http://192.168.6.173/ajax.aspx?bugid=4 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 14
where bg_id = 4
2016-08-10 11:31:40 http://192.168.6.173/ajax.aspx?bugid=4 elapsed milliseconds:0003
2016-08-10 11:31:40 http://192.168.6.173/ajax.aspx?bugid=4 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 4
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 11:31:40 http://192.168.6.173/ajax.aspx?bugid=4 elapsed milliseconds:0000
2016-08-10 11:31:40 http://192.168.6.173/ajax.aspx?bugid=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:31:40 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 11:31:40 http://192.168.6.173/ajax.aspx?bugid=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 14
where bg_id = 5
2016-08-10 11:31:40 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 11:31:40 http://192.168.6.173/ajax.aspx?bugid=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 11:31:40 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 11:31:41 http://192.168.6.173/ajax.aspx?bugid=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:31:41 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 11:31:41 http://192.168.6.173/ajax.aspx?bugid=1 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 14
where bg_id = 1
2016-08-10 11:31:41 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0002
2016-08-10 11:31:41 http://192.168.6.173/ajax.aspx?bugid=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 11:31:41 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 11:31:41 http://192.168.6.173/ajax.aspx?bugid=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:31:41 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 11:31:41 http://192.168.6.173/ajax.aspx?bugid=1 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 14
where bg_id = 1
2016-08-10 11:31:41 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 11:31:41 http://192.168.6.173/ajax.aspx?bugid=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 11:31:41 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 11:31:42 http://192.168.6.173/ajax.aspx?bugid=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:31:42 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 11:31:42 http://192.168.6.173/ajax.aspx?bugid=1 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 14
where bg_id = 1
2016-08-10 11:31:42 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 11:31:42 http://192.168.6.173/ajax.aspx?bugid=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 11:31:42 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 11:31:42 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:31:42 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 11:31:42 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 14
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 14
left outer join project_user_xref on pj_id = pu_project
and pu_user = 14
where bg_id = 1
2016-08-10 11:31:42 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0025
2016-08-10 11:31:42 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 14
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 11:31:42 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0007
2016-08-10 11:31:42 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 11:31:42 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 11:31:42 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 11:31:42 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 11:31:42 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 11:31:42 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 11:31:48 http://192.168.6.173/bugs.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:31:48 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 11:31:48 http://192.168.6.173/bugs.aspx sql=
/* query dropdown */
select qu_id, qu_desc
from queries
where (isnull(qu_user,0) = 0 and isnull(qu_org,0) = 0)
or isnull(qu_user,0) = 14
or isnull(qu_org,0) = 6
order by qu_desc
2016-08-10 11:31:48 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 11:31:48 http://192.168.6.173/bugs.aspx sql=
select qu_sql from queries where qu_id = 1
2016-08-10 11:31:48 http://192.168.6.173/bugs.aspx sql=
select isnull(pr_background_color,'#ffffff'), bg_id [id], isnull(bu_flag,0) [$FLAG], 
 bg_short_desc [desc], isnull(pj_name,'') [project], isnull(og_name,'') [organization], isnull(ct_name,'') [category], rpt.us_username [reported by],
 bg_reported_date [reported on], isnull(pr_name,'') [priority], isnull(asg.us_username,'') [assigned to],
 isnull(st_name,'') [status], isnull(lu.us_username,'') [last updated by], bg_last_updated_date [last updated on]
 from bugs 
 left outer join bug_user on bu_bug = bg_id and bu_user = 14 
 left outer join users rpt on rpt.us_id = bg_reported_user
 left outer join users asg on asg.us_id = bg_assigned_to_user
 left outer join users lu on lu.us_id = bg_last_updated_user
 left outer join projects on pj_id = bg_project
 left outer join orgs on og_id = bg_org
 left outer join categories on ct_id = bg_category
 left outer join priorities on pr_id = bg_priority
 left outer join statuses on st_id = bg_status
  /* altered - just order by  */ WHERE  (bugs.bg_project not in (
					select pu_project
					from project_user_xref
					where pu_user = 14
					and pu_permission_level = 0)) order by bg_id desc
2016-08-10 11:31:48 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 11:31:49 http://192.168.6.173/ajax.aspx?bugid=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:31:49 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 11:31:49 http://192.168.6.173/ajax.aspx?bugid=1 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 14
where bg_id = 1
2016-08-10 11:31:49 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 11:31:49 http://192.168.6.173/ajax.aspx?bugid=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 11:31:49 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 11:31:51 http://192.168.6.173/ajax.aspx?bugid=3 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:31:51 http://192.168.6.173/ajax.aspx?bugid=3 elapsed milliseconds:0000
2016-08-10 11:31:51 http://192.168.6.173/ajax.aspx?bugid=3 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 14
where bg_id = 3
2016-08-10 11:31:51 http://192.168.6.173/ajax.aspx?bugid=3 elapsed milliseconds:0002
2016-08-10 11:31:51 http://192.168.6.173/ajax.aspx?bugid=3 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 3
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 11:31:51 http://192.168.6.173/ajax.aspx?bugid=3 elapsed milliseconds:0000
2016-08-10 11:31:52 http://192.168.6.173/ajax.aspx?bugid=4 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:31:52 http://192.168.6.173/ajax.aspx?bugid=4 elapsed milliseconds:0000
2016-08-10 11:31:52 http://192.168.6.173/ajax.aspx?bugid=4 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 14
where bg_id = 4
2016-08-10 11:31:52 http://192.168.6.173/ajax.aspx?bugid=4 elapsed milliseconds:0000
2016-08-10 11:31:52 http://192.168.6.173/ajax.aspx?bugid=4 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 4
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 11:31:52 http://192.168.6.173/ajax.aspx?bugid=4 elapsed milliseconds:0000
2016-08-10 11:31:52 http://192.168.6.173/ajax.aspx?bugid=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:31:52 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 11:31:52 http://192.168.6.173/ajax.aspx?bugid=5 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 14
where bg_id = 5
2016-08-10 11:31:52 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 11:31:52 http://192.168.6.173/ajax.aspx?bugid=5 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 5
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 11:31:52 http://192.168.6.173/ajax.aspx?bugid=5 elapsed milliseconds:0000
2016-08-10 11:31:52 http://192.168.6.173/ajax.aspx?bugid=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:31:52 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 11:31:52 http://192.168.6.173/ajax.aspx?bugid=1 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 14
where bg_id = 1
2016-08-10 11:31:52 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 11:31:52 http://192.168.6.173/ajax.aspx?bugid=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 11:31:52 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 11:31:56 http://192.168.6.173/ajax.aspx?bugid=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:31:56 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 11:31:56 http://192.168.6.173/ajax.aspx?bugid=1 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 14
where bg_id = 1
2016-08-10 11:31:56 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 11:31:56 http://192.168.6.173/ajax.aspx?bugid=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 11:31:56 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 11:31:57 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:31:57 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 11:31:57 http://192.168.6.173/edit_bug.aspx?id=1 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 14
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 14
left outer join project_user_xref on pj_id = pu_project
and pu_user = 14
where bg_id = 1
2016-08-10 11:31:57 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 11:31:57 http://192.168.6.173/edit_bug.aspx?id=1 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 14
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 11:31:57 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 11:31:57 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 11:31:57 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 11:31:57 http://192.168.6.173/edit_bug.aspx?id=1 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 11:31:57 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 11:31:57 http://192.168.6.173/edit_bug.aspx?id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 11:31:57 http://192.168.6.173/edit_bug.aspx?id=1 elapsed milliseconds:0000
2016-08-10 11:32:04 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=1&id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:32:04 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=1&id=1 elapsed milliseconds:0000
2016-08-10 11:32:04 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=1&id=1 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 14
where bg_id = 1
2016-08-10 11:32:04 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=1&id=1 elapsed milliseconds:0000
2016-08-10 11:32:04 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=1&id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 11:32:04 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=1&id=1 elapsed milliseconds:0000
2016-08-10 11:32:04 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 11:32:07 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=0&id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:32:07 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=0&id=1 elapsed milliseconds:0000
2016-08-10 11:32:07 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=0&id=1 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 14
where bg_id = 1
2016-08-10 11:32:07 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=0&id=1 elapsed milliseconds:0000
2016-08-10 11:32:07 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=0&id=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 11:32:07 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=0&id=1 elapsed milliseconds:0000
2016-08-10 11:32:07 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 11:32:10 http://192.168.6.173/bugs.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:32:10 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 11:32:10 http://192.168.6.173/bugs.aspx sql=
/* query dropdown */
select qu_id, qu_desc
from queries
where (isnull(qu_user,0) = 0 and isnull(qu_org,0) = 0)
or isnull(qu_user,0) = 14
or isnull(qu_org,0) = 6
order by qu_desc
2016-08-10 11:32:10 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 11:32:10 http://192.168.6.173/bugs.aspx sql=
select qu_sql from queries where qu_id = 1
2016-08-10 11:32:10 http://192.168.6.173/bugs.aspx sql=
select isnull(pr_background_color,'#ffffff'), bg_id [id], isnull(bu_flag,0) [$FLAG], 
 bg_short_desc [desc], isnull(pj_name,'') [project], isnull(og_name,'') [organization], isnull(ct_name,'') [category], rpt.us_username [reported by],
 bg_reported_date [reported on], isnull(pr_name,'') [priority], isnull(asg.us_username,'') [assigned to],
 isnull(st_name,'') [status], isnull(lu.us_username,'') [last updated by], bg_last_updated_date [last updated on]
 from bugs 
 left outer join bug_user on bu_bug = bg_id and bu_user = 14 
 left outer join users rpt on rpt.us_id = bg_reported_user
 left outer join users asg on asg.us_id = bg_assigned_to_user
 left outer join users lu on lu.us_id = bg_last_updated_user
 left outer join projects on pj_id = bg_project
 left outer join orgs on og_id = bg_org
 left outer join categories on ct_id = bg_category
 left outer join priorities on pr_id = bg_priority
 left outer join statuses on st_id = bg_status
  /* altered - just order by  */ WHERE  (bugs.bg_project not in (
					select pu_project
					from project_user_xref
					where pu_user = 14
					and pu_permission_level = 0)) order by bg_id desc
2016-08-10 11:32:10 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 11:32:11 http://192.168.6.173/ajax.aspx?bugid=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:32:11 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 11:32:11 http://192.168.6.173/ajax.aspx?bugid=1 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 14
where bg_id = 1
2016-08-10 11:32:11 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 11:32:11 http://192.168.6.173/ajax.aspx?bugid=1 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 1
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 11:32:11 http://192.168.6.173/ajax.aspx?bugid=1 elapsed milliseconds:0000
2016-08-10 11:32:11 http://192.168.6.173/ajax.aspx?bugid=3 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:32:11 http://192.168.6.173/ajax.aspx?bugid=3 elapsed milliseconds:0000
2016-08-10 11:32:11 http://192.168.6.173/ajax.aspx?bugid=3 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 14
where bg_id = 3
2016-08-10 11:32:11 http://192.168.6.173/ajax.aspx?bugid=3 elapsed milliseconds:0000
2016-08-10 11:32:11 http://192.168.6.173/ajax.aspx?bugid=3 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 3
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 11:32:11 http://192.168.6.173/ajax.aspx?bugid=3 elapsed milliseconds:0000
2016-08-10 11:32:12 http://192.168.6.173/ajax.aspx?bugid=4 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:32:12 http://192.168.6.173/ajax.aspx?bugid=4 elapsed milliseconds:0000
2016-08-10 11:32:12 http://192.168.6.173/ajax.aspx?bugid=4 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 14
where bg_id = 4
2016-08-10 11:32:12 http://192.168.6.173/ajax.aspx?bugid=4 elapsed milliseconds:0000
2016-08-10 11:32:12 http://192.168.6.173/ajax.aspx?bugid=4 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 4
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 11:32:12 http://192.168.6.173/ajax.aspx?bugid=4 elapsed milliseconds:0000
2016-08-10 11:32:12 http://192.168.6.173/ajax.aspx?bugid=3 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:32:12 http://192.168.6.173/ajax.aspx?bugid=3 elapsed milliseconds:0000
2016-08-10 11:32:12 http://192.168.6.173/ajax.aspx?bugid=3 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 14
where bg_id = 3
2016-08-10 11:32:12 http://192.168.6.173/ajax.aspx?bugid=3 elapsed milliseconds:0000
2016-08-10 11:32:12 http://192.168.6.173/ajax.aspx?bugid=3 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 3
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 11:32:12 http://192.168.6.173/ajax.aspx?bugid=3 elapsed milliseconds:0000
2016-08-10 11:32:12 http://192.168.6.173/edit_bug.aspx?id=3 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:32:12 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 11:32:12 http://192.168.6.173/edit_bug.aspx?id=3 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 14
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 14
left outer join project_user_xref on pj_id = pu_project
and pu_user = 14
where bg_id = 3
2016-08-10 11:32:12 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0026
2016-08-10 11:32:12 http://192.168.6.173/edit_bug.aspx?id=3 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 14
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 11:32:12 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 11:32:12 http://192.168.6.173/edit_bug.aspx?id=3 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 4
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 11:32:12 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0001
2016-08-10 11:32:12 http://192.168.6.173/edit_bug.aspx?id=3 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 4
2016-08-10 11:32:12 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 11:32:12 http://192.168.6.173/edit_bug.aspx?id=3 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 3
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 11:32:12 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 11:32:14 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=1&id=3 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:32:14 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=1&id=3 elapsed milliseconds:0000
2016-08-10 11:32:14 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=1&id=3 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 14
where bg_id = 3
2016-08-10 11:32:14 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=1&id=3 elapsed milliseconds:0000
2016-08-10 11:32:14 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=1&id=3 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 3
and a.bp_parent is null
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 11:32:14 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=1&id=3 elapsed milliseconds:0009
2016-08-10 11:32:14 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 11:32:16 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=0&id=3 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:32:16 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=0&id=3 elapsed milliseconds:0000
2016-08-10 11:32:16 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=0&id=3 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 14
where bg_id = 3
2016-08-10 11:32:16 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=0&id=3 elapsed milliseconds:0000
2016-08-10 11:32:16 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=0&id=3 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 3
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 11:32:16 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=0&id=3 elapsed milliseconds:0000
2016-08-10 11:32:16 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 11:32:17 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=1&id=3 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:32:17 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=1&id=3 elapsed milliseconds:0000
2016-08-10 11:32:17 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=1&id=3 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 14
where bg_id = 3
2016-08-10 11:32:17 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=1&id=3 elapsed milliseconds:0000
2016-08-10 11:32:17 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=1&id=3 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 3
and a.bp_parent is null
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 11:32:17 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=1&id=3 elapsed milliseconds:0000
2016-08-10 11:32:17 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 11:32:17 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=0&id=3 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:32:17 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=0&id=3 elapsed milliseconds:0000
2016-08-10 11:32:17 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=0&id=3 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 14
where bg_id = 3
2016-08-10 11:32:17 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=0&id=3 elapsed milliseconds:0000
2016-08-10 11:32:17 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=0&id=3 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 3
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 11:32:17 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=0&id=3 elapsed milliseconds:0000
2016-08-10 11:32:17 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 11:32:18 http://192.168.6.173/bugs.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:32:18 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 11:32:18 http://192.168.6.173/bugs.aspx sql=
/* query dropdown */
select qu_id, qu_desc
from queries
where (isnull(qu_user,0) = 0 and isnull(qu_org,0) = 0)
or isnull(qu_user,0) = 14
or isnull(qu_org,0) = 6
order by qu_desc
2016-08-10 11:32:18 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 11:32:18 http://192.168.6.173/bugs.aspx sql=
select qu_sql from queries where qu_id = 1
2016-08-10 11:32:18 http://192.168.6.173/bugs.aspx sql=
select isnull(pr_background_color,'#ffffff'), bg_id [id], isnull(bu_flag,0) [$FLAG], 
 bg_short_desc [desc], isnull(pj_name,'') [project], isnull(og_name,'') [organization], isnull(ct_name,'') [category], rpt.us_username [reported by],
 bg_reported_date [reported on], isnull(pr_name,'') [priority], isnull(asg.us_username,'') [assigned to],
 isnull(st_name,'') [status], isnull(lu.us_username,'') [last updated by], bg_last_updated_date [last updated on]
 from bugs 
 left outer join bug_user on bu_bug = bg_id and bu_user = 14 
 left outer join users rpt on rpt.us_id = bg_reported_user
 left outer join users asg on asg.us_id = bg_assigned_to_user
 left outer join users lu on lu.us_id = bg_last_updated_user
 left outer join projects on pj_id = bg_project
 left outer join orgs on og_id = bg_org
 left outer join categories on ct_id = bg_category
 left outer join priorities on pr_id = bg_priority
 left outer join statuses on st_id = bg_status
  /* altered - just order by  */ WHERE  (bugs.bg_project not in (
					select pu_project
					from project_user_xref
					where pu_user = 14
					and pu_permission_level = 0)) order by bg_id desc
2016-08-10 11:32:18 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 11:32:19 http://192.168.6.173/ajax.aspx?bugid=3 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:32:19 http://192.168.6.173/ajax.aspx?bugid=3 elapsed milliseconds:0000
2016-08-10 11:32:19 http://192.168.6.173/ajax.aspx?bugid=3 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 14
where bg_id = 3
2016-08-10 11:32:19 http://192.168.6.173/ajax.aspx?bugid=3 elapsed milliseconds:0000
2016-08-10 11:32:19 http://192.168.6.173/ajax.aspx?bugid=3 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 3
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 11:32:19 http://192.168.6.173/ajax.aspx?bugid=3 elapsed milliseconds:0000
2016-08-10 11:32:19 http://192.168.6.173/edit_bug.aspx?id=3 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:32:19 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 11:32:19 http://192.168.6.173/edit_bug.aspx?id=3 sql=
 /* get_bug_datarow */
declare @svn_revisions int
declare @git_commits int
declare @hg_revisions int
declare @tasks int
declare @related int;
set @svn_revisions = 0
set @git_commits = 0
set @hg_revisions = 0
set @tasks = 0
set @related = 0

select bg_id [id],
bg_short_desc [short_desc],
isnull(bg_tags,'') [bg_tags],
isnull(ru.us_username,'[deleted user]') [reporter],
isnull(ru.us_email,'') [reporter_email],
case rtrim(ru.us_firstname)
	when null then isnull(ru.us_lastname, '')
	when '' then isnull(ru.us_lastname, '')
	else isnull(ru.us_lastname + ', ' + ru.us_firstname,'')
	end [reporter_fullname],
bg_reported_date [reported_date],
datediff(s,bg_reported_date,getdate()) [seconds_ago],
isnull(lu.us_username,'') [last_updated_user],
case rtrim(lu.us_firstname)
	when null then isnull(lu.us_lastname, '')
	when '' then isnull(lu.us_lastname, '')
	else isnull(lu.us_lastname + ', ' + lu.us_firstname,'')
	end [last_updated_fullname],


bg_last_updated_date [last_updated_date],
isnull(bg_project,0) [project],
isnull(pj_name,'[no project]') [current_project],

isnull(bg_org,0) [organization],
isnull(bugorg.og_name,'') [og_name],

isnull(bg_category,0) [category],
isnull(ct_name,'') [category_name],

isnull(bg_priority,0) [priority],
isnull(pr_name,'') [priority_name],

isnull(bg_status,0) [status],
isnull(st_name,'') [status_name],

isnull(bg_user_defined_attribute,0) [udf],
isnull(udf_name,'') [udf_name],

isnull(bg_assigned_to_user,0) [assigned_to_user],
isnull(asg.us_username,'[not assigned]') [assigned_to_username],
case rtrim(asg.us_firstname)
when null then isnull(asg.us_lastname, '[not assigned]')
when '' then isnull(asg.us_lastname, '[not assigned]')
else isnull(asg.us_lastname + ', ' + asg.us_firstname,'[not assigned]')
end [assigned_to_fullname],

isnull(bs_user,0) [subscribed],

case
when
	6 <> bg_org
	and userorg.og_other_orgs_permission_level < 2
	and userorg.og_other_orgs_permission_level < isnull(pu_permission_level,2)
		then userorg.og_other_orgs_permission_level
else
	isnull(pu_permission_level,2)
end [pu_permission_level],

isnull(bg_project_custom_dropdown_value1,'') [bg_project_custom_dropdown_value1],
isnull(bg_project_custom_dropdown_value2,'') [bg_project_custom_dropdown_value2],
isnull(bg_project_custom_dropdown_value3,'') [bg_project_custom_dropdown_value3],
@related [relationship_cnt],
@svn_revisions [svn_revision_cnt],
@git_commits [git_commit_cnt],
@hg_revisions [hg_commit_cnt],
@tasks [task_cnt],
getdate() [snapshot_timestamp]

from bugs
inner join users this_user on us_id = 14
inner join orgs userorg on this_user.us_org = userorg.og_id
left outer join user_defined_attribute on bg_user_defined_attribute = udf_id
left outer join projects on bg_project = pj_id
left outer join orgs bugorg on bg_org = bugorg.og_id
left outer join categories on bg_category = ct_id
left outer join priorities on bg_priority = pr_id
left outer join statuses on bg_status = st_id
left outer join users asg on bg_assigned_to_user = asg.us_id
left outer join users ru on bg_reported_user = ru.us_id
left outer join users lu on bg_last_updated_user = lu.us_id
left outer join bug_subscriptions on bs_bug = bg_id and bs_user = 14
left outer join project_user_xref on pj_id = pu_project
and pu_user = 14
where bg_id = 3
2016-08-10 11:32:19 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 11:32:19 http://192.168.6.173/edit_bug.aspx?id=3 sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 14
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 11:32:19 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 11:32:19 http://192.168.6.173/edit_bug.aspx?id=3 sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 4
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 11:32:19 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 11:32:19 http://192.168.6.173/edit_bug.aspx?id=3 sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 4
2016-08-10 11:32:19 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 11:32:19 http://192.168.6.173/edit_bug.aspx?id=3 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 3
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 11:32:19 http://192.168.6.173/edit_bug.aspx?id=3 elapsed milliseconds:0000
2016-08-10 11:32:20 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=1&id=3 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:32:20 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=1&id=3 elapsed milliseconds:0000
2016-08-10 11:32:20 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=1&id=3 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 14
where bg_id = 3
2016-08-10 11:32:20 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=1&id=3 elapsed milliseconds:0000
2016-08-10 11:32:20 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=1&id=3 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 3
and a.bp_parent is null
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 11:32:20 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=1&id=3 elapsed milliseconds:0000
2016-08-10 11:32:20 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 11:32:21 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=0&id=3 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:32:21 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=0&id=3 elapsed milliseconds:0000
2016-08-10 11:32:21 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=0&id=3 sql=

declare @bg_org int

select isnull(pu_permission_level,2),
bg_org
from bugs
left outer join project_user_xref
on pu_project = bg_project
and pu_user = 14
where bg_id = 3
2016-08-10 11:32:21 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=0&id=3 elapsed milliseconds:0000
2016-08-10 11:32:21 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=0&id=3 sql=

/* get_bug_posts */
select
a.bp_bug,
a.bp_comment,
isnull(us_username,'') [us_username],
case rtrim(us_firstname)
	when null then isnull(us_lastname, '')
	when '' then isnull(us_lastname, '')
	else isnull(us_lastname + ', ' + us_firstname,'')
	end [us_fullname],
isnull(us_email,'') [us_email],
a.bp_date,
datediff(s,a.bp_date,getdate()) [seconds_ago],
a.bp_id,
a.bp_type,
isnull(a.bp_email_from,'') bp_email_from,
isnull(a.bp_email_to,'') bp_email_to,
isnull(a.bp_email_cc,'') bp_email_cc,
isnull(a.bp_file,'') bp_file,
isnull(a.bp_size,0) bp_size,
isnull(a.bp_content_type,'') bp_content_type,
a.bp_hidden_from_external_users,
isnull(ba.bp_file,'') ba_file,  -- intentionally ba
isnull(ba.bp_id,'') ba_id, -- intentionally ba
isnull(ba.bp_size,'') ba_size,  -- intentionally ba
isnull(ba.bp_content_type,'') ba_content_type -- intentionally ba
from bug_posts a
left outer join users on us_id = a.bp_user
left outer join bug_posts ba on ba.bp_parent = a.bp_id and ba.bp_bug = a.bp_bug
where a.bp_bug = 3
and a.bp_parent is null
 and a.bp_type <> 'update'
 order by a.bp_id desc, ba.bp_parent, ba.bp_id
2016-08-10 11:32:21 http://192.168.6.173/write_posts.aspx?images_inline=null&history_inline=0&id=3 elapsed milliseconds:0000
2016-08-10 11:32:21 http://192.168.6.173/get_db_datetime.aspx sql=
select getdate()
2016-08-10 11:32:22 http://192.168.6.173/bugs.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '164c59d7-f69f-4e7a-813e-436057e23f3b'
and us_active = 1
2016-08-10 11:32:22 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 11:32:22 http://192.168.6.173/bugs.aspx sql=
/* query dropdown */
select qu_id, qu_desc
from queries
where (isnull(qu_user,0) = 0 and isnull(qu_org,0) = 0)
or isnull(qu_user,0) = 14
or isnull(qu_org,0) = 6
order by qu_desc
2016-08-10 11:32:22 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 11:32:22 http://192.168.6.173/bugs.aspx sql=
select qu_sql from queries where qu_id = 1
2016-08-10 11:32:22 http://192.168.6.173/bugs.aspx sql=
select isnull(pr_background_color,'#ffffff'), bg_id [id], isnull(bu_flag,0) [$FLAG], 
 bg_short_desc [desc], isnull(pj_name,'') [project], isnull(og_name,'') [organization], isnull(ct_name,'') [category], rpt.us_username [reported by],
 bg_reported_date [reported on], isnull(pr_name,'') [priority], isnull(asg.us_username,'') [assigned to],
 isnull(st_name,'') [status], isnull(lu.us_username,'') [last updated by], bg_last_updated_date [last updated on]
 from bugs 
 left outer join bug_user on bu_bug = bg_id and bu_user = 14 
 left outer join users rpt on rpt.us_id = bg_reported_user
 left outer join users asg on asg.us_id = bg_assigned_to_user
 left outer join users lu on lu.us_id = bg_last_updated_user
 left outer join projects on pj_id = bg_project
 left outer join orgs on og_id = bg_org
 left outer join categories on ct_id = bg_category
 left outer join priorities on pr_id = bg_priority
 left outer join statuses on st_id = bg_status
  /* altered - just order by  */ WHERE  (bugs.bg_project not in (
					select pu_project
					from project_user_xref
					where pu_user = 14
					and pu_permission_level = 0)) order by bg_id desc
2016-08-10 11:32:22 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 11:32:25 http://192.168.6.173/logoff.aspx sql=
delete from sessions
			where se_id = N'164c59d7-f69f-4e7a-813e-436057e23f3b'
			or datediff(d, se_date, getdate()) > 2
2016-08-10 11:32:25 http://192.168.6.173/default.aspx?msg=logged+off sql=
select count(1) from users
2016-08-10 11:32:27 http://192.168.6.173/default.aspx?msg=logged+off sql=
select count(1) from users
2016-08-10 11:32:31 http://192.168.6.173/Default.aspx sql=
select count(1) from users
2016-08-10 11:32:33 http://192.168.6.173/Default.aspx sql=
select count(1) from users
2016-08-10 11:32:34 http://192.168.6.173/Default.aspx sql=
select count(1) from users
2016-08-10 11:32:35 http://192.168.6.173/Default.aspx sql=
select count(1) from users
2016-08-10 11:32:35 http://192.168.6.173/Default.aspx sql=

select us_username, us_id, us_password, isnull(us_salt,0) us_salt, us_active
from users
where us_username = N'ivan'
2016-08-10 11:32:35 http://192.168.6.173/Default.aspx elapsed milliseconds:0000
2016-08-10 11:32:35 http://192.168.6.173/Default.aspx User ivan entered an incorrect password.
2016-08-10 11:32:36 http://192.168.6.173/Default.aspx sql=
select count(1) from users
2016-08-10 11:32:36 http://192.168.6.173/Default.aspx sql=

select us_username, us_id, us_password, isnull(us_salt,0) us_salt, us_active
from users
where us_username = N'ivan'
2016-08-10 11:32:36 http://192.168.6.173/Default.aspx elapsed milliseconds:0000
2016-08-10 11:32:36 http://192.168.6.173/Default.aspx failed attempt count for ivan:1
2016-08-10 11:32:36 http://192.168.6.173/Default.aspx User ivan entered an incorrect password.
2016-08-10 11:32:41 http://192.168.6.173/Default.aspx sql=
select count(1) from users
2016-08-10 11:33:12 http://192.168.6.173/Default.aspx sql=
select count(1) from users
2016-08-10 11:34:53 http://192.168.6.173/reports.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:34:53 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 11:34:53 http://192.168.6.173/reports.aspx sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>круговая</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>график</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>столбцы</a>'
	else
		'&nbsp;' end [view<br>chart],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>данные</a>' [view<br>data]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>редактировать</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>удалить</a>' [delete] 
from reports order by rp_desc
2016-08-10 11:34:53 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 11:34:53 http://192.168.6.173/reports.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:34:53 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 11:34:53 http://192.168.6.173/reports.aspx sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>круговая</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>график</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>столбцы</a>'
	else
		'&nbsp;' end [view<br>chart],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>данные</a>' [view<br>data]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>редактировать</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>удалить</a>' [delete] 
from reports order by rp_desc
2016-08-10 11:34:53 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 11:34:55 http://192.168.6.173/queries.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:34:55 http://192.168.6.173/queries.aspx elapsed milliseconds:0000
2016-08-10 11:34:55 http://192.168.6.173/queries.aspx sql=
select
			qu_desc [query],
			case
				when isnull(qu_user,0) = 0 and isnull(qu_org,0) is null then 'everybody'
				when isnull(qu_user,0) <> 0 then 'user:' + us_username
				when isnull(qu_org,0) <> 0 then 'org:' + og_name
				else ' '
				end [visibility],
			'<a href=bugs.aspx?qu_id=' + convert(varchar,qu_id) + '>view list</a>' [view list],
			'<a target=_blank href=print_bugs.aspx?qu_id=' + convert(varchar,qu_id) + '>print list</a>' [print list],
			'<a target=_blank href=print_bugs.aspx?format=excel&qu_id=' + convert(varchar,qu_id) + '>export as excel</a>' [export as excel],
			'<a target=_blank href=print_bugs2.aspx?qu_id=' + convert(varchar,qu_id) + '>print detail</a>' [print list<br>with detail],
			'<a href=edit_query.aspx?id=' + convert(varchar,qu_id) + '>edit</a>' [edit],
			'<a href=delete_query.aspx?id=' + convert(varchar,qu_id) + '>delete</a>' [delete],
			replace(convert(nvarchar(4000),qu_sql), char(10),'<br>') [sql]
			from queries
			left outer join users on qu_user = us_id
			left outer join orgs on qu_org = og_id
			where 1 = 0 /* all */
			or isnull(qu_user,0) = 1
			or isnull(qu_user,0) = 0
			order by qu_desc
2016-08-10 11:34:55 http://192.168.6.173/queries.aspx elapsed milliseconds:0001
2016-08-10 11:34:55 http://192.168.6.173/queries.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:34:55 http://192.168.6.173/queries.aspx elapsed milliseconds:0000
2016-08-10 11:34:55 http://192.168.6.173/queries.aspx sql=
select
			qu_desc [query],
			case
				when isnull(qu_user,0) = 0 and isnull(qu_org,0) is null then 'everybody'
				when isnull(qu_user,0) <> 0 then 'user:' + us_username
				when isnull(qu_org,0) <> 0 then 'org:' + og_name
				else ' '
				end [visibility],
			'<a href=bugs.aspx?qu_id=' + convert(varchar,qu_id) + '>view list</a>' [view list],
			'<a target=_blank href=print_bugs.aspx?qu_id=' + convert(varchar,qu_id) + '>print list</a>' [print list],
			'<a target=_blank href=print_bugs.aspx?format=excel&qu_id=' + convert(varchar,qu_id) + '>export as excel</a>' [export as excel],
			'<a target=_blank href=print_bugs2.aspx?qu_id=' + convert(varchar,qu_id) + '>print detail</a>' [print list<br>with detail],
			'<a href=edit_query.aspx?id=' + convert(varchar,qu_id) + '>edit</a>' [edit],
			'<a href=delete_query.aspx?id=' + convert(varchar,qu_id) + '>delete</a>' [delete],
			replace(convert(nvarchar(4000),qu_sql), char(10),'<br>') [sql]
			from queries
			left outer join users on qu_user = us_id
			left outer join orgs on qu_org = og_id
			where 1 = 0 /* all */
			or isnull(qu_user,0) = 1
			or isnull(qu_user,0) = 0
			order by qu_desc
2016-08-10 11:34:55 http://192.168.6.173/queries.aspx elapsed milliseconds:0001
2016-08-10 11:37:05 http://192.168.6.173/bugs.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:37:05 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 11:37:05 http://192.168.6.173/bugs.aspx sql=
/* query dropdown */
select qu_id, qu_desc
from queries
where (isnull(qu_user,0) = 0 and isnull(qu_org,0) = 0)
or isnull(qu_user,0) = 1
or isnull(qu_org,0) = 6
order by qu_desc
2016-08-10 11:37:05 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 11:37:05 http://192.168.6.173/bugs.aspx sql=
select qu_sql from queries where qu_id = 1
2016-08-10 11:37:05 http://192.168.6.173/bugs.aspx sql=
select isnull(pr_background_color,'#ffffff'), bg_id [id], isnull(bu_flag,0) [$FLAG], 
 bg_short_desc [desc], isnull(pj_name,'') [project], isnull(og_name,'') [organization], isnull(ct_name,'') [category], rpt.us_username [reported by],
 bg_reported_date [reported on], isnull(pr_name,'') [priority], isnull(asg.us_username,'') [assigned to],
 isnull(st_name,'') [status], isnull(lu.us_username,'') [last updated by], bg_last_updated_date [last updated on]
 from bugs 
 left outer join bug_user on bu_bug = bg_id and bu_user = 1 
 left outer join users rpt on rpt.us_id = bg_reported_user
 left outer join users asg on asg.us_id = bg_assigned_to_user
 left outer join users lu on lu.us_id = bg_last_updated_user
 left outer join projects on pj_id = bg_project
 left outer join orgs on og_id = bg_org
 left outer join categories on ct_id = bg_category
 left outer join priorities on pr_id = bg_priority
 left outer join statuses on st_id = bg_status
  /* altered - just order by  */ WHERE  (bugs.bg_project not in (
					select pu_project
					from project_user_xref
					where pu_user = 1
					and pu_permission_level = 0)) order by bg_id desc
2016-08-10 11:37:05 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 11:37:06 http://192.168.6.173/bugs.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:37:06 http://192.168.6.173/bugs.aspx elapsed milliseconds:0002
2016-08-10 11:37:06 http://192.168.6.173/bugs.aspx sql=
/* query dropdown */
select qu_id, qu_desc
from queries
where (isnull(qu_user,0) = 0 and isnull(qu_org,0) = 0)
or isnull(qu_user,0) = 1
or isnull(qu_org,0) = 6
order by qu_desc
2016-08-10 11:37:06 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 11:37:06 http://192.168.6.173/bugs.aspx sql=
select qu_sql from queries where qu_id = 1
2016-08-10 11:37:06 http://192.168.6.173/bugs.aspx sql=
select isnull(pr_background_color,'#ffffff'), bg_id [id], isnull(bu_flag,0) [$FLAG], 
 bg_short_desc [desc], isnull(pj_name,'') [project], isnull(og_name,'') [organization], isnull(ct_name,'') [category], rpt.us_username [reported by],
 bg_reported_date [reported on], isnull(pr_name,'') [priority], isnull(asg.us_username,'') [assigned to],
 isnull(st_name,'') [status], isnull(lu.us_username,'') [last updated by], bg_last_updated_date [last updated on]
 from bugs 
 left outer join bug_user on bu_bug = bg_id and bu_user = 1 
 left outer join users rpt on rpt.us_id = bg_reported_user
 left outer join users asg on asg.us_id = bg_assigned_to_user
 left outer join users lu on lu.us_id = bg_last_updated_user
 left outer join projects on pj_id = bg_project
 left outer join orgs on og_id = bg_org
 left outer join categories on ct_id = bg_category
 left outer join priorities on pr_id = bg_priority
 left outer join statuses on st_id = bg_status
  /* altered - just order by  */ WHERE  (bugs.bg_project not in (
					select pu_project
					from project_user_xref
					where pu_user = 1
					and pu_permission_level = 0)) order by bg_id desc
2016-08-10 11:37:06 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 11:37:12 http://192.168.6.173/edit_bug.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:37:12 http://192.168.6.173/edit_bug.aspx elapsed milliseconds:0000
2016-08-10 11:37:12 http://192.168.6.173/edit_bug.aspx sql=
/* drop downs */ select pj_id, pj_name
		from projects
		left outer join project_user_xref on pj_id = pu_project
		and pu_user = 1
		where pj_active = 1
		and isnull(pu_permission_level,2) not in (0, 1)
		order by pj_name;
select og_id, og_name from orgs where og_active = 1 order by og_name;
select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
select st_id, st_name from statuses order by st_sort_seq, st_name;
select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name;
2016-08-10 11:37:12 http://192.168.6.173/edit_bug.aspx elapsed milliseconds:0000
2016-08-10 11:37:12 http://192.168.6.173/edit_bug.aspx sql=

select top 1 pj_id from projects where pj_default = 1 order by pj_name;
select top 1 ct_id from categories where ct_default = 1 order by ct_name;
select top 1 pr_id from priorities where pr_default = 1 order by pr_name;
select top 1 st_id from statuses where st_default = 1 order by st_name;
select top 1 udf_id from user_defined_attribute where udf_default = 1 order by udf_name;
2016-08-10 11:37:12 http://192.168.6.173/edit_bug.aspx elapsed milliseconds:0000
2016-08-10 11:37:12 http://192.168.6.173/edit_bug.aspx sql=

/* users this project */ select us_id, case when 0 = 1 then us_lastname + ', ' + us_firstname else us_username end us_username
from users
inner join orgs on us_org = og_id
where us_active = 1
and og_can_be_assigned_to = 1
and (2 <> 0 or 6 = og_id or (og_external_user = 0 and 0 = 1))
and us_id not in
	(select pu_user from project_user_xref
		where pu_project = 3
		and pu_permission_level = 0)
order by us_username; 
2016-08-10 11:37:12 http://192.168.6.173/edit_bug.aspx elapsed milliseconds:0000
2016-08-10 11:37:12 http://192.168.6.173/edit_bug.aspx sql=
select isnull(pj_default_user,0)
					from projects
					where pj_id = 3
2016-08-10 11:37:12 http://192.168.6.173/edit_bug.aspx sql=
select
			isnull(pj_enable_custom_dropdown1,0) [pj_enable_custom_dropdown1],
			isnull(pj_enable_custom_dropdown2,0) [pj_enable_custom_dropdown2],
			isnull(pj_enable_custom_dropdown3,0) [pj_enable_custom_dropdown3],
			isnull(pj_custom_dropdown_label1,'') [pj_custom_dropdown_label1],
			isnull(pj_custom_dropdown_label2,'') [pj_custom_dropdown_label2],
			isnull(pj_custom_dropdown_label3,'') [pj_custom_dropdown_label3],
			isnull(pj_custom_dropdown_values1,'') [pj_custom_dropdown_values1],
			isnull(pj_custom_dropdown_values2,'') [pj_custom_dropdown_values2],
			isnull(pj_custom_dropdown_values3,'') [pj_custom_dropdown_values3]
			from projects where pj_id = 3
2016-08-10 11:37:12 http://192.168.6.173/edit_bug.aspx elapsed milliseconds:0000
2016-08-10 11:37:26 http://192.168.6.173/admin.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:37:26 http://192.168.6.173/admin.aspx elapsed milliseconds:0000
2016-08-10 11:37:26 http://192.168.6.173/admin.aspx sql=
select count(1) from bugs
2016-08-10 11:37:28 http://192.168.6.173/categories.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 11:37:28 http://192.168.6.173/categories.aspx elapsed milliseconds:0000
2016-08-10 11:37:28 http://192.168.6.173/categories.aspx sql=
select
		ct_id [id],
		ct_name [category],
		ct_sort_seq [sort seq],
		case when ct_default = 1 then 'Y' else 'N' end [default],
		ct_id [hidden]
		from categories order by ct_name
2016-08-10 11:37:28 http://192.168.6.173/categories.aspx elapsed milliseconds:0001
2016-08-10 12:18:39 http://192.168.6.173/reports.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:18:39 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 12:18:39 http://192.168.6.173/reports.aspx sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>круговая</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>график</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>столбцы</a>'
	else
		'&nbsp;' end [view<br>chart],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>данные</a>' [view<br>data]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>редактировать</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>удалить</a>' [delete] 
from reports order by rp_desc
2016-08-10 12:18:39 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 12:18:50 http://192.168.6.173/queries.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:18:50 http://192.168.6.173/queries.aspx elapsed milliseconds:0000
2016-08-10 12:18:50 http://192.168.6.173/queries.aspx sql=
select
			qu_desc [query],
			case
				when isnull(qu_user,0) = 0 and isnull(qu_org,0) is null then 'everybody'
				when isnull(qu_user,0) <> 0 then 'user:' + us_username
				when isnull(qu_org,0) <> 0 then 'org:' + og_name
				else ' '
				end [visibility],
			'<a href=bugs.aspx?qu_id=' + convert(varchar,qu_id) + '>view list</a>' [view list],
			'<a target=_blank href=print_bugs.aspx?qu_id=' + convert(varchar,qu_id) + '>print list</a>' [print list],
			'<a target=_blank href=print_bugs.aspx?format=excel&qu_id=' + convert(varchar,qu_id) + '>export as excel</a>' [export as excel],
			'<a target=_blank href=print_bugs2.aspx?qu_id=' + convert(varchar,qu_id) + '>print detail</a>' [print list<br>with detail],
			'<a href=edit_query.aspx?id=' + convert(varchar,qu_id) + '>edit</a>' [edit],
			'<a href=delete_query.aspx?id=' + convert(varchar,qu_id) + '>delete</a>' [delete],
			replace(convert(nvarchar(4000),qu_sql), char(10),'<br>') [sql]
			from queries
			left outer join users on qu_user = us_id
			left outer join orgs on qu_org = og_id
			where 1 = 0 /* all */
			or isnull(qu_user,0) = 1
			or isnull(qu_user,0) = 0
			order by qu_desc
2016-08-10 12:18:50 http://192.168.6.173/queries.aspx elapsed milliseconds:0001
2016-08-10 12:18:54 http://192.168.6.173/search.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:18:54 http://192.168.6.173/search.aspx elapsed milliseconds:0000
2016-08-10 12:18:54 http://192.168.6.173/search.aspx sql=

/* get related users 2 */
select  pj_id, us_id,
case when 0 = 1 then
    case when len(isnull(us_firstname,'') + ' ' + isnull(us_lastname,'')) > 1
	then isnull(us_firstname,'') + ' ' + isnull(us_lastname,'')
    else us_username end
else us_username end us_username,
isnull(us_email,'') us_email
into #temp
from projects, users
where pj_id not in
(
	select pu_project from project_user_xref
	where pu_permission_level = 0 and pu_user = 1
)





if 0 = 1 -- external
and 2 = 0 -- other orgs
begin
	select distinct a.us_id, a.us_username, a.us_email
	from #temp a
	inner join users b on a.us_id = b.us_id
	inner join orgs on b.us_org = og_id
	where og_external_user = 0 or b.us_org = 6
	order by a.us_username
end
else
begin

	select distinct us_id, us_username, us_email
		from #temp
		left outer join project_user_xref on pj_id = pu_project
		and us_id = pu_user
		where isnull(pu_permission_level,2) <> 0
		order by us_username
end

drop table #temp
2016-08-10 12:18:54 http://192.168.6.173/search.aspx elapsed milliseconds:0011
2016-08-10 12:18:54 http://192.168.6.173/search.aspx sql=
/* drop downs */ select pj_id, pj_name from projects order by pj_name; select og_id, og_name from orgs order by og_name;
	select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
	select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
	select st_id, st_name from statuses order by st_sort_seq, st_name;
	select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name
2016-08-10 12:18:54 http://192.168.6.173/search.aspx elapsed milliseconds:0000
2016-08-10 12:18:54 http://192.168.6.173/search.aspx sql=

select count(1)
from projects
where isnull(pj_enable_custom_dropdown1,0) = 1
or isnull(pj_enable_custom_dropdown2,0) = 1
or isnull(pj_enable_custom_dropdown3,0) = 1
2016-08-10 12:18:55 http://192.168.6.173/queries.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:18:55 http://192.168.6.173/queries.aspx elapsed milliseconds:0000
2016-08-10 12:18:55 http://192.168.6.173/queries.aspx sql=
select
			qu_desc [query],
			case
				when isnull(qu_user,0) = 0 and isnull(qu_org,0) is null then 'everybody'
				when isnull(qu_user,0) <> 0 then 'user:' + us_username
				when isnull(qu_org,0) <> 0 then 'org:' + og_name
				else ' '
				end [visibility],
			'<a href=bugs.aspx?qu_id=' + convert(varchar,qu_id) + '>view list</a>' [view list],
			'<a target=_blank href=print_bugs.aspx?qu_id=' + convert(varchar,qu_id) + '>print list</a>' [print list],
			'<a target=_blank href=print_bugs.aspx?format=excel&qu_id=' + convert(varchar,qu_id) + '>export as excel</a>' [export as excel],
			'<a target=_blank href=print_bugs2.aspx?qu_id=' + convert(varchar,qu_id) + '>print detail</a>' [print list<br>with detail],
			'<a href=edit_query.aspx?id=' + convert(varchar,qu_id) + '>edit</a>' [edit],
			'<a href=delete_query.aspx?id=' + convert(varchar,qu_id) + '>delete</a>' [delete],
			replace(convert(nvarchar(4000),qu_sql), char(10),'<br>') [sql]
			from queries
			left outer join users on qu_user = us_id
			left outer join orgs on qu_org = og_id
			where 1 = 0 /* all */
			or isnull(qu_user,0) = 1
			or isnull(qu_user,0) = 0
			order by qu_desc
2016-08-10 12:18:55 http://192.168.6.173/queries.aspx elapsed milliseconds:0001
2016-08-10 12:18:56 http://192.168.6.173/search.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:18:56 http://192.168.6.173/search.aspx elapsed milliseconds:0000
2016-08-10 12:18:56 http://192.168.6.173/search.aspx sql=

/* get related users 2 */
select  pj_id, us_id,
case when 0 = 1 then
    case when len(isnull(us_firstname,'') + ' ' + isnull(us_lastname,'')) > 1
	then isnull(us_firstname,'') + ' ' + isnull(us_lastname,'')
    else us_username end
else us_username end us_username,
isnull(us_email,'') us_email
into #temp
from projects, users
where pj_id not in
(
	select pu_project from project_user_xref
	where pu_permission_level = 0 and pu_user = 1
)





if 0 = 1 -- external
and 2 = 0 -- other orgs
begin
	select distinct a.us_id, a.us_username, a.us_email
	from #temp a
	inner join users b on a.us_id = b.us_id
	inner join orgs on b.us_org = og_id
	where og_external_user = 0 or b.us_org = 6
	order by a.us_username
end
else
begin

	select distinct us_id, us_username, us_email
		from #temp
		left outer join project_user_xref on pj_id = pu_project
		and us_id = pu_user
		where isnull(pu_permission_level,2) <> 0
		order by us_username
end

drop table #temp
2016-08-10 12:18:56 http://192.168.6.173/search.aspx elapsed milliseconds:0013
2016-08-10 12:18:56 http://192.168.6.173/search.aspx sql=
/* drop downs */ select pj_id, pj_name from projects order by pj_name; select og_id, og_name from orgs order by og_name;
	select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
	select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
	select st_id, st_name from statuses order by st_sort_seq, st_name;
	select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name
2016-08-10 12:18:56 http://192.168.6.173/search.aspx elapsed milliseconds:0000
2016-08-10 12:18:56 http://192.168.6.173/search.aspx sql=

select count(1)
from projects
where isnull(pj_enable_custom_dropdown1,0) = 1
or isnull(pj_enable_custom_dropdown2,0) = 1
or isnull(pj_enable_custom_dropdown3,0) = 1
2016-08-10 12:19:04 http://192.168.6.173/reports.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:19:04 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 12:19:04 http://192.168.6.173/reports.aspx sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>круговая</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>график</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>столбцы</a>'
	else
		'&nbsp;' end [view<br>chart],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>данные</a>' [view<br>data]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>редактировать</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>удалить</a>' [delete] 
from reports order by rp_desc
2016-08-10 12:19:04 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 12:24:46 http://192.168.6.173/queries.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:24:46 http://192.168.6.173/queries.aspx elapsed milliseconds:0000
2016-08-10 12:24:46 http://192.168.6.173/queries.aspx sql=
select
			qu_desc [query],
			case
				when isnull(qu_user,0) = 0 and isnull(qu_org,0) is null then 'everybody'
				when isnull(qu_user,0) <> 0 then 'user:' + us_username
				when isnull(qu_org,0) <> 0 then 'org:' + og_name
				else ' '
				end [visibility],
			'<a href=bugs.aspx?qu_id=' + convert(varchar,qu_id) + '>view list</a>' [view list],
			'<a target=_blank href=print_bugs.aspx?qu_id=' + convert(varchar,qu_id) + '>print list</a>' [print list],
			'<a target=_blank href=print_bugs.aspx?format=excel&qu_id=' + convert(varchar,qu_id) + '>export as excel</a>' [export as excel],
			'<a target=_blank href=print_bugs2.aspx?qu_id=' + convert(varchar,qu_id) + '>print detail</a>' [print list<br>with detail],
			'<a href=edit_query.aspx?id=' + convert(varchar,qu_id) + '>edit</a>' [edit],
			'<a href=delete_query.aspx?id=' + convert(varchar,qu_id) + '>delete</a>' [delete],
			replace(convert(nvarchar(4000),qu_sql), char(10),'<br>') [sql]
			from queries
			left outer join users on qu_user = us_id
			left outer join orgs on qu_org = og_id
			where 1 = 0 /* all */
			or isnull(qu_user,0) = 1
			or isnull(qu_user,0) = 0
			order by qu_desc
2016-08-10 12:24:46 http://192.168.6.173/queries.aspx elapsed milliseconds:0001
2016-08-10 12:24:47 http://192.168.6.173/queries.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:24:47 http://192.168.6.173/queries.aspx elapsed milliseconds:0000
2016-08-10 12:24:47 http://192.168.6.173/queries.aspx sql=
select
			qu_desc [query],
			case
				when isnull(qu_user,0) = 0 and isnull(qu_org,0) is null then 'everybody'
				when isnull(qu_user,0) <> 0 then 'user:' + us_username
				when isnull(qu_org,0) <> 0 then 'org:' + og_name
				else ' '
				end [visibility],
			'<a href=bugs.aspx?qu_id=' + convert(varchar,qu_id) + '>view list</a>' [view list],
			'<a target=_blank href=print_bugs.aspx?qu_id=' + convert(varchar,qu_id) + '>print list</a>' [print list],
			'<a target=_blank href=print_bugs.aspx?format=excel&qu_id=' + convert(varchar,qu_id) + '>export as excel</a>' [export as excel],
			'<a target=_blank href=print_bugs2.aspx?qu_id=' + convert(varchar,qu_id) + '>print detail</a>' [print list<br>with detail],
			'<a href=edit_query.aspx?id=' + convert(varchar,qu_id) + '>edit</a>' [edit],
			'<a href=delete_query.aspx?id=' + convert(varchar,qu_id) + '>delete</a>' [delete],
			replace(convert(nvarchar(4000),qu_sql), char(10),'<br>') [sql]
			from queries
			left outer join users on qu_user = us_id
			left outer join orgs on qu_org = og_id
			where 1 = 0 /* all */
			or isnull(qu_user,0) = 1
			or isnull(qu_user,0) = 0
			order by qu_desc
2016-08-10 12:24:47 http://192.168.6.173/queries.aspx elapsed milliseconds:0001
2016-08-10 12:24:47 http://192.168.6.173/queries.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:24:47 http://192.168.6.173/queries.aspx elapsed milliseconds:0000
2016-08-10 12:24:47 http://192.168.6.173/queries.aspx sql=
select
			qu_desc [query],
			case
				when isnull(qu_user,0) = 0 and isnull(qu_org,0) is null then 'everybody'
				when isnull(qu_user,0) <> 0 then 'user:' + us_username
				when isnull(qu_org,0) <> 0 then 'org:' + og_name
				else ' '
				end [visibility],
			'<a href=bugs.aspx?qu_id=' + convert(varchar,qu_id) + '>view list</a>' [view list],
			'<a target=_blank href=print_bugs.aspx?qu_id=' + convert(varchar,qu_id) + '>print list</a>' [print list],
			'<a target=_blank href=print_bugs.aspx?format=excel&qu_id=' + convert(varchar,qu_id) + '>export as excel</a>' [export as excel],
			'<a target=_blank href=print_bugs2.aspx?qu_id=' + convert(varchar,qu_id) + '>print detail</a>' [print list<br>with detail],
			'<a href=edit_query.aspx?id=' + convert(varchar,qu_id) + '>edit</a>' [edit],
			'<a href=delete_query.aspx?id=' + convert(varchar,qu_id) + '>delete</a>' [delete],
			replace(convert(nvarchar(4000),qu_sql), char(10),'<br>') [sql]
			from queries
			left outer join users on qu_user = us_id
			left outer join orgs on qu_org = og_id
			where 1 = 0 /* all */
			or isnull(qu_user,0) = 1
			or isnull(qu_user,0) = 0
			order by qu_desc
2016-08-10 12:24:47 http://192.168.6.173/queries.aspx elapsed milliseconds:0001
2016-08-10 12:26:45 http://192.168.6.173/queries.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:26:45 http://192.168.6.173/queries.aspx elapsed milliseconds:0000
2016-08-10 12:26:45 http://192.168.6.173/queries.aspx sql=
select
			qu_desc [запрос],
			case
				when isnull(qu_user,0) = 0 and isnull(qu_org,0) is null then 'everybody'
				when isnull(qu_user,0) <> 0 then 'user:' + us_username
				when isnull(qu_org,0) <> 0 then 'org:' + og_name
				else ' '
				end [видимость],
			'<a href=bugs.aspx?qu_id=' + convert(varchar,qu_id) + '>view list</a>' [посмотреть список],
			'<a target=_blank href=print_bugs.aspx?qu_id=' + convert(varchar,qu_id) + '>print list</a>' [печать списка],
			'<a target=_blank href=print_bugs.aspx?format=excel&qu_id=' + convert(varchar,qu_id) + '>export as excel</a>' [экспорт в excel],
			'<a target=_blank href=print_bugs2.aspx?qu_id=' + convert(varchar,qu_id) + '>print detail</a>' [печать списка<br> с детализацией],
			'<a href=edit_query.aspx?id=' + convert(varchar,qu_id) + '>edit</a>' [редактировать],
			'<a href=delete_query.aspx?id=' + convert(varchar,qu_id) + '>delete</a>' [удалить],
			replace(convert(nvarchar(4000),qu_sql), char(10),'<br>') [sql]
			from queries
			left outer join users on qu_user = us_id
			left outer join orgs on qu_org = og_id
			where 1 = 0 /* all */
			or isnull(qu_user,0) = 1
			or isnull(qu_user,0) = 0
			order by qu_desc
2016-08-10 12:26:45 http://192.168.6.173/queries.aspx elapsed milliseconds:0007
2016-08-10 12:27:03 http://192.168.6.173/reports.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:27:03 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 12:27:03 http://192.168.6.173/reports.aspx sql=

select
rp_desc [отчет],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>круговая</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>график</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>столбцы</a>'
	else
		'&nbsp;' end [вид<br>диаграммы],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>данные</a>' [просмотр<br>данных]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>редактировать</a>' [edit], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>удалить</a>' [delete] 
from reports order by rp_desc
2016-08-10 12:27:03 http://192.168.6.173/reports.aspx elapsed milliseconds:0002
2016-08-10 12:28:53 http://192.168.6.173/queries.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:28:53 http://192.168.6.173/queries.aspx elapsed milliseconds:0000
2016-08-10 12:28:53 http://192.168.6.173/queries.aspx sql=
select
			qu_desc [запрос],
			case
				when isnull(qu_user,0) = 0 and isnull(qu_org,0) is null then 'everybody'
				when isnull(qu_user,0) <> 0 then 'user:' + us_username
				when isnull(qu_org,0) <> 0 then 'org:' + og_name
				else ' '
				end [видимость],
			'<a href=bugs.aspx?qu_id=' + convert(varchar,qu_id) + '>view list</a>' [посмотреть список],
			'<a target=_blank href=print_bugs.aspx?qu_id=' + convert(varchar,qu_id) + '>print list</a>' [печать списка],
			'<a target=_blank href=print_bugs.aspx?format=excel&qu_id=' + convert(varchar,qu_id) + '>export as excel</a>' [экспорт в excel],
			'<a target=_blank href=print_bugs2.aspx?qu_id=' + convert(varchar,qu_id) + '>print detail</a>' [печать списка<br> с детализацией],
			'<a href=edit_query.aspx?id=' + convert(varchar,qu_id) + '>edit</a>' [редактировать],
			'<a href=delete_query.aspx?id=' + convert(varchar,qu_id) + '>delete</a>' [удалить],
			replace(convert(nvarchar(4000),qu_sql), char(10),'<br>') [sql]
			from queries
			left outer join users on qu_user = us_id
			left outer join orgs on qu_org = og_id
			where 1 = 0 /* all */
			or isnull(qu_user,0) = 1
			or isnull(qu_user,0) = 0
			order by qu_desc
2016-08-10 12:28:53 http://192.168.6.173/queries.aspx elapsed milliseconds:0001
2016-08-10 12:28:54 http://192.168.6.173/search.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:28:54 http://192.168.6.173/search.aspx elapsed milliseconds:0000
2016-08-10 12:28:54 http://192.168.6.173/search.aspx sql=

/* get related users 2 */
select  pj_id, us_id,
case when 0 = 1 then
    case when len(isnull(us_firstname,'') + ' ' + isnull(us_lastname,'')) > 1
	then isnull(us_firstname,'') + ' ' + isnull(us_lastname,'')
    else us_username end
else us_username end us_username,
isnull(us_email,'') us_email
into #temp
from projects, users
where pj_id not in
(
	select pu_project from project_user_xref
	where pu_permission_level = 0 and pu_user = 1
)





if 0 = 1 -- external
and 2 = 0 -- other orgs
begin
	select distinct a.us_id, a.us_username, a.us_email
	from #temp a
	inner join users b on a.us_id = b.us_id
	inner join orgs on b.us_org = og_id
	where og_external_user = 0 or b.us_org = 6
	order by a.us_username
end
else
begin

	select distinct us_id, us_username, us_email
		from #temp
		left outer join project_user_xref on pj_id = pu_project
		and us_id = pu_user
		where isnull(pu_permission_level,2) <> 0
		order by us_username
end

drop table #temp
2016-08-10 12:28:54 http://192.168.6.173/search.aspx elapsed milliseconds:0012
2016-08-10 12:28:54 http://192.168.6.173/search.aspx sql=
/* drop downs */ select pj_id, pj_name from projects order by pj_name; select og_id, og_name from orgs order by og_name;
	select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
	select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
	select st_id, st_name from statuses order by st_sort_seq, st_name;
	select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name
2016-08-10 12:28:54 http://192.168.6.173/search.aspx elapsed milliseconds:0000
2016-08-10 12:28:54 http://192.168.6.173/search.aspx sql=

select count(1)
from projects
where isnull(pj_enable_custom_dropdown1,0) = 1
or isnull(pj_enable_custom_dropdown2,0) = 1
or isnull(pj_enable_custom_dropdown3,0) = 1
2016-08-10 12:28:57 http://192.168.6.173/reports.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:28:57 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 12:28:57 http://192.168.6.173/reports.aspx sql=

select
rp_desc [отчет],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>круговая</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>график</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>столбцы</a>'
	else
		'&nbsp;' end [вид<br>диаграммы],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>данные</a>' [просмотр<br>данных]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>edit</a>' [редактировать], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>delete</a>' [удалить] 
from reports order by rp_desc
2016-08-10 12:28:57 http://192.168.6.173/reports.aspx elapsed milliseconds:0002
2016-08-10 12:28:57 http://192.168.6.173/reports.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:28:57 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 12:28:57 http://192.168.6.173/reports.aspx sql=

select
rp_desc [отчет],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>круговая</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>график</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>столбцы</a>'
	else
		'&nbsp;' end [вид<br>диаграммы],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>данные</a>' [просмотр<br>данных]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>edit</a>' [редактировать], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>delete</a>' [удалить] 
from reports order by rp_desc
2016-08-10 12:28:57 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 12:28:58 http://192.168.6.173/dashboard.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:28:58 http://192.168.6.173/dashboard.aspx elapsed milliseconds:0001
2016-08-10 12:28:58 http://192.168.6.173/dashboard.aspx sql=

select ds.*, rp_desc
from dashboard_items ds
inner join reports on rp_id = ds_report
where ds_user = 1
order by ds_col, ds_row
2016-08-10 12:28:58 http://192.168.6.173/dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:28:59 http://192.168.6.173/edit_dashboard.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:28:59 http://192.168.6.173/edit_dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:28:59 http://192.168.6.173/edit_dashboard.aspx sql=

select ds_id, ds_col, ds_row, ds_chart_type, rp_desc
from dashboard_items ds
inner join reports on rp_id = ds_report
where ds_user = 1
order by ds_col, ds_row
2016-08-10 12:28:59 http://192.168.6.173/edit_dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:29:02 http://192.168.6.173/select_report.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:29:02 http://192.168.6.173/select_report.aspx elapsed milliseconds:0000
2016-08-10 12:29:02 http://192.168.6.173/select_report.aspx sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a href=''javascript:select_report("pie",' + convert(varchar, rp_id) + ')''>select pie</a>'
	when rp_chart_type = 'line' then
		'<a href=''javascript:select_report("line",' + convert(varchar, rp_id) + ')''>select line</a>'
	when rp_chart_type = 'bar' then
		'<a href=''javascript:select_report("bar",' + convert(varchar, rp_id) + ')''>select bar</a>'
	else
		'&nbsp;' end [chart],
'<a href=''javascript:select_report("data",' + convert(varchar, rp_id) + ')''>select data</a>' [data]
from reports order by rp_desc
2016-08-10 12:29:02 http://192.168.6.173/select_report.aspx elapsed milliseconds:0000
2016-08-10 12:29:07 http://192.168.6.173/update_dashboard.aspx?rp_id=5&rp_chart_type=line&rp_col=1&actn=add&ses=443fdfb6-9fbb-407b-ac44-6c12363c52a4 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:29:07 http://192.168.6.173/update_dashboard.aspx?rp_id=5&rp_chart_type=line&rp_col=1&actn=add&ses=443fdfb6-9fbb-407b-ac44-6c12363c52a4 elapsed milliseconds:0000
2016-08-10 12:29:07 http://192.168.6.173/update_dashboard.aspx?rp_id=5&rp_chart_type=line&rp_col=1&actn=add&ses=443fdfb6-9fbb-407b-ac44-6c12363c52a4 sql=

declare @last_row int
set @last_row = -1

select @last_row = max(ds_row) from dashboard_items
where ds_user = 1
and ds_col = 1

if @last_row = -1 or @last_row is null
	set @last_row = 1
else
	set @last_row = @last_row + 1

insert into dashboard_items
(ds_user, ds_report, ds_chart_type, ds_col, ds_row)
values (1, 5, 'line', 1, @last_row)
2016-08-10 12:29:07 http://192.168.6.173/edit_dashboard.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:29:07 http://192.168.6.173/edit_dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:29:07 http://192.168.6.173/edit_dashboard.aspx sql=

select ds_id, ds_col, ds_row, ds_chart_type, rp_desc
from dashboard_items ds
inner join reports on rp_id = ds_report
where ds_user = 1
order by ds_col, ds_row
2016-08-10 12:29:07 http://192.168.6.173/edit_dashboard.aspx elapsed milliseconds:0006
2016-08-10 12:29:11 http://192.168.6.173/dashboard.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:29:11 http://192.168.6.173/dashboard.aspx elapsed milliseconds:0001
2016-08-10 12:29:11 http://192.168.6.173/dashboard.aspx sql=

select ds.*, rp_desc
from dashboard_items ds
inner join reports on rp_id = ds_report
where ds_user = 1
order by ds_col, ds_row
2016-08-10 12:29:11 http://192.168.6.173/dashboard.aspx elapsed milliseconds:0003
2016-08-10 12:29:11 http://192.168.6.173/view_report.aspx?scale=2&view=line&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:29:11 http://192.168.6.173/view_report.aspx?scale=2&view=line&id=5 elapsed milliseconds:0000
2016-08-10 12:29:11 http://192.168.6.173/view_report.aspx?scale=2&view=line&id=5 sql=
select rp_desc, rp_sql, rp_chart_type
		from reports
		where rp_id = 5
2016-08-10 12:29:11 http://192.168.6.173/view_report.aspx?scale=2&view=line&id=5 elapsed milliseconds:0000
2016-08-10 12:29:11 http://192.168.6.173/view_report.aspx?scale=2&view=line&id=5 sql=
select datepart(dy, bg_reported_date) [day of year], count(1) [count] 
 from bugs 
 group by datepart(dy, bg_reported_date), 
 datepart(dy,bg_reported_date) order by 1
2016-08-10 12:29:11 http://192.168.6.173/view_report.aspx?scale=2&view=line&id=5 elapsed milliseconds:0002
2016-08-10 12:29:18 http://192.168.6.173/edit_dashboard.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:29:18 http://192.168.6.173/edit_dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:29:18 http://192.168.6.173/edit_dashboard.aspx sql=

select ds_id, ds_col, ds_row, ds_chart_type, rp_desc
from dashboard_items ds
inner join reports on rp_id = ds_report
where ds_user = 1
order by ds_col, ds_row
2016-08-10 12:29:18 http://192.168.6.173/edit_dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:29:20 http://192.168.6.173/dashboard.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:29:20 http://192.168.6.173/dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:29:20 http://192.168.6.173/dashboard.aspx sql=

select ds.*, rp_desc
from dashboard_items ds
inner join reports on rp_id = ds_report
where ds_user = 1
order by ds_col, ds_row
2016-08-10 12:29:20 http://192.168.6.173/dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:29:20 http://192.168.6.173/view_report.aspx?scale=2&view=line&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:29:20 http://192.168.6.173/view_report.aspx?scale=2&view=line&id=5 elapsed milliseconds:0001
2016-08-10 12:29:20 http://192.168.6.173/view_report.aspx?scale=2&view=line&id=5 sql=
select rp_desc, rp_sql, rp_chart_type
		from reports
		where rp_id = 5
2016-08-10 12:29:20 http://192.168.6.173/view_report.aspx?scale=2&view=line&id=5 elapsed milliseconds:0000
2016-08-10 12:29:20 http://192.168.6.173/view_report.aspx?scale=2&view=line&id=5 sql=
select datepart(dy, bg_reported_date) [day of year], count(1) [count] 
 from bugs 
 group by datepart(dy, bg_reported_date), 
 datepart(dy,bg_reported_date) order by 1
2016-08-10 12:29:20 http://192.168.6.173/view_report.aspx?scale=2&view=line&id=5 elapsed milliseconds:0007
2016-08-10 12:29:22 http://192.168.6.173/edit_dashboard.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:29:22 http://192.168.6.173/edit_dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:29:22 http://192.168.6.173/edit_dashboard.aspx sql=

select ds_id, ds_col, ds_row, ds_chart_type, rp_desc
from dashboard_items ds
inner join reports on rp_id = ds_report
where ds_user = 1
order by ds_col, ds_row
2016-08-10 12:29:22 http://192.168.6.173/edit_dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:29:27 http://192.168.6.173/reports.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:29:27 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 12:29:27 http://192.168.6.173/reports.aspx sql=

select
rp_desc [отчет],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>круговая</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>график</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>столбцы</a>'
	else
		'&nbsp;' end [вид<br>диаграммы],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>данные</a>' [просмотр<br>данных]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>edit</a>' [редактировать], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>delete</a>' [удалить] 
from reports order by rp_desc
2016-08-10 12:29:27 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 12:29:48  threadproc_votes
2016-08-10 12:29:48  sql=

if exists (select * from dbo.sysobjects where id = object_id(N'[votes_view]'))
drop view [votes_view]
2016-08-10 12:29:48  sql=

create view votes_view as
select bu_bug as vote_bug, sum(bu_vote) as vote_total
from bug_user
group by bu_bug
having sum(bu_vote) > 0
2016-08-10 12:29:48  started creating Lucene index using folder C:\btnet364\www\App_Data\lucene_index
2016-08-10 12:29:48  sql=

select bu_bug, count(1)
from bug_user 
where bu_vote = 1
group by bu_bug
2016-08-10 12:29:48  elapsed milliseconds:0000
2016-08-10 12:29:48 http://192.168.6.173/dashboard.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:29:48 http://192.168.6.173/dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:29:48 http://192.168.6.173/dashboard.aspx sql=

/* custom columns */ select sc.name, st.[name] [datatype], 
case when st.[name] = 'nvarchar' or st.[name] = 'nchar' then sc.length/2 else sc.length end as [length], 
sc.xprec, sc.xscale, sc.isnullable,
mm.text [default value], 
dflts.name [default name], 
isnull(ccm_dropdown_type,'') [dropdown type],
isnull(ccm_dropdown_vals,'') [vals],
isnull(ccm_sort_seq, sc.colorder) [column order],
sc.colorder
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
left outer join syscomments mm on sc.cdefault = mm.id
left outer join custom_col_metadata on ccm_colorder = sc.colorder
left outer join sysobjects dflts on dflts.id = mm.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
order by sc.id, isnull(ccm_sort_seq,sc.colorder)
2016-08-10 12:29:48 http://192.168.6.173/dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:29:48 http://192.168.6.173/dashboard.aspx sql=

select ds.*, rp_desc
from dashboard_items ds
inner join reports on rp_id = ds_report
where ds_user = 1
order by ds_col, ds_row
2016-08-10 12:29:48 http://192.168.6.173/dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:29:48  sql=

/* get searchable cols */					
select sc.name
from syscolumns sc
inner join systypes st on st.xusertype = sc.xusertype
inner join sysobjects so on sc.id = so.id
where so.name = 'bugs'
and st.[name] <> 'sysname'
and sc.name not in ('rowguid',
'bg_id',
'bg_short_desc',
'bg_reported_user',
'bg_reported_date',
'bg_project',
'bg_org',
'bg_category',
'bg_priority',
'bg_status',
'bg_assigned_to_user',
'bg_last_updated_user',
'bg_last_updated_date',
'bg_user_defined_attribute',
'bg_project_custom_dropdown_value1',
'bg_project_custom_dropdown_value2',
'bg_project_custom_dropdown_value3',
'bg_tags')
and st.[name] in ('nvarchar','varchar')
and sc.length > 30
2016-08-10 12:29:48  elapsed milliseconds:0000
2016-08-10 12:29:48  sql=

select bg_id, 	

isnull(bg_tags,'') bg_tags,
bg_short_desc
from bugs
2016-08-10 12:29:48  elapsed milliseconds:0000
2016-08-10 12:29:48  sql=

select bp_bug, bp_id, 
isnull(bp_comment_search,bp_comment) [text] 
from bug_posts 
where bp_type <> 'update'
and bp_hidden_from_external_users = 0
2016-08-10 12:29:48  elapsed milliseconds:0000
2016-08-10 12:29:48 http://192.168.6.173/view_report.aspx?scale=2&view=line&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:29:48 http://192.168.6.173/view_report.aspx?scale=2&view=line&id=5 elapsed milliseconds:0000
2016-08-10 12:29:48 http://192.168.6.173/view_report.aspx?scale=2&view=line&id=5 sql=
select rp_desc, rp_sql, rp_chart_type
		from reports
		where rp_id = 5
2016-08-10 12:29:48 http://192.168.6.173/view_report.aspx?scale=2&view=line&id=5 elapsed milliseconds:0000
2016-08-10 12:29:48 http://192.168.6.173/view_report.aspx?scale=2&view=line&id=5 sql=
select datepart(dy, bg_reported_date) [day of year], count(1) [count] 
 from bugs 
 group by datepart(dy, bg_reported_date), 
 datepart(dy,bg_reported_date) order by 1
2016-08-10 12:29:48 http://192.168.6.173/view_report.aspx?scale=2&view=line&id=5 elapsed milliseconds:0000
2016-08-10 12:29:48  done creating Lucene index
2016-08-10 12:30:41 http://192.168.6.173/dashboard.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:30:41 http://192.168.6.173/dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:30:41 http://192.168.6.173/dashboard.aspx sql=

select ds.*, rp_desc
from dashboard_items ds
inner join reports on rp_id = ds_report
where ds_user = 1
order by ds_col, ds_row
2016-08-10 12:30:41 http://192.168.6.173/dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:30:42 http://192.168.6.173/view_report.aspx?scale=2&view=line&id=5 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:30:42 http://192.168.6.173/view_report.aspx?scale=2&view=line&id=5 elapsed milliseconds:0000
2016-08-10 12:30:42 http://192.168.6.173/view_report.aspx?scale=2&view=line&id=5 sql=
select rp_desc, rp_sql, rp_chart_type
		from reports
		where rp_id = 5
2016-08-10 12:30:42 http://192.168.6.173/view_report.aspx?scale=2&view=line&id=5 elapsed milliseconds:0000
2016-08-10 12:30:42 http://192.168.6.173/view_report.aspx?scale=2&view=line&id=5 sql=
select datepart(dy, bg_reported_date) [day of year], count(1) [count] 
 from bugs 
 group by datepart(dy, bg_reported_date), 
 datepart(dy,bg_reported_date) order by 1
2016-08-10 12:30:42 http://192.168.6.173/view_report.aspx?scale=2&view=line&id=5 elapsed milliseconds:0000
2016-08-10 12:31:34 http://192.168.6.173/edit_dashboard.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:31:34 http://192.168.6.173/edit_dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:31:34 http://192.168.6.173/edit_dashboard.aspx sql=

select ds_id, ds_col, ds_row, ds_chart_type, rp_desc
from dashboard_items ds
inner join reports on rp_id = ds_report
where ds_user = 1
order by ds_col, ds_row
2016-08-10 12:31:34 http://192.168.6.173/edit_dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:31:36 http://192.168.6.173/update_dashboard.aspx?actn=delete&ds_id=1&ses=443fdfb6-9fbb-407b-ac44-6c12363c52a4 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:31:36 http://192.168.6.173/update_dashboard.aspx?actn=delete&ds_id=1&ses=443fdfb6-9fbb-407b-ac44-6c12363c52a4 elapsed milliseconds:0000
2016-08-10 12:31:36 http://192.168.6.173/update_dashboard.aspx?actn=delete&ds_id=1&ses=443fdfb6-9fbb-407b-ac44-6c12363c52a4 sql=
delete from dashboard_items where ds_id = 1 and ds_user = 1
2016-08-10 12:31:36 http://192.168.6.173/edit_dashboard.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:31:36 http://192.168.6.173/edit_dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:31:36 http://192.168.6.173/edit_dashboard.aspx sql=

select ds_id, ds_col, ds_row, ds_chart_type, rp_desc
from dashboard_items ds
inner join reports on rp_id = ds_report
where ds_user = 1
order by ds_col, ds_row
2016-08-10 12:31:36 http://192.168.6.173/edit_dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:31:37 http://192.168.6.173/select_report.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:31:37 http://192.168.6.173/select_report.aspx elapsed milliseconds:0000
2016-08-10 12:31:37 http://192.168.6.173/select_report.aspx sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a href=''javascript:select_report("pie",' + convert(varchar, rp_id) + ')''>select pie</a>'
	when rp_chart_type = 'line' then
		'<a href=''javascript:select_report("line",' + convert(varchar, rp_id) + ')''>select line</a>'
	when rp_chart_type = 'bar' then
		'<a href=''javascript:select_report("bar",' + convert(varchar, rp_id) + ')''>select bar</a>'
	else
		'&nbsp;' end [chart],
'<a href=''javascript:select_report("data",' + convert(varchar, rp_id) + ')''>select data</a>' [data]
from reports order by rp_desc
2016-08-10 12:31:37 http://192.168.6.173/select_report.aspx elapsed milliseconds:0000
2016-08-10 12:31:46 http://192.168.6.173/update_dashboard.aspx?rp_id=6&rp_chart_type=data&rp_col=1&actn=add&ses=443fdfb6-9fbb-407b-ac44-6c12363c52a4 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:31:46 http://192.168.6.173/update_dashboard.aspx?rp_id=6&rp_chart_type=data&rp_col=1&actn=add&ses=443fdfb6-9fbb-407b-ac44-6c12363c52a4 elapsed milliseconds:0000
2016-08-10 12:31:46 http://192.168.6.173/update_dashboard.aspx?rp_id=6&rp_chart_type=data&rp_col=1&actn=add&ses=443fdfb6-9fbb-407b-ac44-6c12363c52a4 sql=

declare @last_row int
set @last_row = -1

select @last_row = max(ds_row) from dashboard_items
where ds_user = 1
and ds_col = 1

if @last_row = -1 or @last_row is null
	set @last_row = 1
else
	set @last_row = @last_row + 1

insert into dashboard_items
(ds_user, ds_report, ds_chart_type, ds_col, ds_row)
values (1, 6, 'data', 1, @last_row)
2016-08-10 12:31:47 http://192.168.6.173/edit_dashboard.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:31:47 http://192.168.6.173/edit_dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:31:47 http://192.168.6.173/edit_dashboard.aspx sql=

select ds_id, ds_col, ds_row, ds_chart_type, rp_desc
from dashboard_items ds
inner join reports on rp_id = ds_report
where ds_user = 1
order by ds_col, ds_row
2016-08-10 12:31:47 http://192.168.6.173/edit_dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:31:51 http://192.168.6.173/update_dashboard.aspx?actn=delete&ds_id=2&ses=443fdfb6-9fbb-407b-ac44-6c12363c52a4 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:31:51 http://192.168.6.173/update_dashboard.aspx?actn=delete&ds_id=2&ses=443fdfb6-9fbb-407b-ac44-6c12363c52a4 elapsed milliseconds:0000
2016-08-10 12:31:51 http://192.168.6.173/update_dashboard.aspx?actn=delete&ds_id=2&ses=443fdfb6-9fbb-407b-ac44-6c12363c52a4 sql=
delete from dashboard_items where ds_id = 2 and ds_user = 1
2016-08-10 12:31:51 http://192.168.6.173/edit_dashboard.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:31:51 http://192.168.6.173/edit_dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:31:51 http://192.168.6.173/edit_dashboard.aspx sql=

select ds_id, ds_col, ds_row, ds_chart_type, rp_desc
from dashboard_items ds
inner join reports on rp_id = ds_report
where ds_user = 1
order by ds_col, ds_row
2016-08-10 12:31:51 http://192.168.6.173/edit_dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:31:53 http://192.168.6.173/select_report.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:31:53 http://192.168.6.173/select_report.aspx elapsed milliseconds:0000
2016-08-10 12:31:53 http://192.168.6.173/select_report.aspx sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a href=''javascript:select_report("pie",' + convert(varchar, rp_id) + ')''>select pie</a>'
	when rp_chart_type = 'line' then
		'<a href=''javascript:select_report("line",' + convert(varchar, rp_id) + ')''>select line</a>'
	when rp_chart_type = 'bar' then
		'<a href=''javascript:select_report("bar",' + convert(varchar, rp_id) + ')''>select bar</a>'
	else
		'&nbsp;' end [chart],
'<a href=''javascript:select_report("data",' + convert(varchar, rp_id) + ')''>select data</a>' [data]
from reports order by rp_desc
2016-08-10 12:31:53 http://192.168.6.173/select_report.aspx elapsed milliseconds:0000
2016-08-10 12:31:58 http://192.168.6.173/update_dashboard.aspx?rp_id=1&rp_chart_type=pie&rp_col=1&actn=add&ses=443fdfb6-9fbb-407b-ac44-6c12363c52a4 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:31:58 http://192.168.6.173/update_dashboard.aspx?rp_id=1&rp_chart_type=pie&rp_col=1&actn=add&ses=443fdfb6-9fbb-407b-ac44-6c12363c52a4 elapsed milliseconds:0000
2016-08-10 12:31:58 http://192.168.6.173/update_dashboard.aspx?rp_id=1&rp_chart_type=pie&rp_col=1&actn=add&ses=443fdfb6-9fbb-407b-ac44-6c12363c52a4 sql=

declare @last_row int
set @last_row = -1

select @last_row = max(ds_row) from dashboard_items
where ds_user = 1
and ds_col = 1

if @last_row = -1 or @last_row is null
	set @last_row = 1
else
	set @last_row = @last_row + 1

insert into dashboard_items
(ds_user, ds_report, ds_chart_type, ds_col, ds_row)
values (1, 1, 'pie', 1, @last_row)
2016-08-10 12:31:58 http://192.168.6.173/edit_dashboard.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:31:58 http://192.168.6.173/edit_dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:31:58 http://192.168.6.173/edit_dashboard.aspx sql=

select ds_id, ds_col, ds_row, ds_chart_type, rp_desc
from dashboard_items ds
inner join reports on rp_id = ds_report
where ds_user = 1
order by ds_col, ds_row
2016-08-10 12:31:58 http://192.168.6.173/edit_dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:32:02 http://192.168.6.173/select_report.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:32:02 http://192.168.6.173/select_report.aspx elapsed milliseconds:0000
2016-08-10 12:32:02 http://192.168.6.173/select_report.aspx sql=

select
rp_desc [report],
case
	when rp_chart_type = 'pie' then
		'<a href=''javascript:select_report("pie",' + convert(varchar, rp_id) + ')''>select pie</a>'
	when rp_chart_type = 'line' then
		'<a href=''javascript:select_report("line",' + convert(varchar, rp_id) + ')''>select line</a>'
	when rp_chart_type = 'bar' then
		'<a href=''javascript:select_report("bar",' + convert(varchar, rp_id) + ')''>select bar</a>'
	else
		'&nbsp;' end [chart],
'<a href=''javascript:select_report("data",' + convert(varchar, rp_id) + ')''>select data</a>' [data]
from reports order by rp_desc
2016-08-10 12:32:02 http://192.168.6.173/select_report.aspx elapsed milliseconds:0000
2016-08-10 12:32:04 http://192.168.6.173/update_dashboard.aspx?rp_id=6&rp_chart_type=data&rp_col=2&actn=add&ses=443fdfb6-9fbb-407b-ac44-6c12363c52a4 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:32:04 http://192.168.6.173/update_dashboard.aspx?rp_id=6&rp_chart_type=data&rp_col=2&actn=add&ses=443fdfb6-9fbb-407b-ac44-6c12363c52a4 elapsed milliseconds:0000
2016-08-10 12:32:04 http://192.168.6.173/update_dashboard.aspx?rp_id=6&rp_chart_type=data&rp_col=2&actn=add&ses=443fdfb6-9fbb-407b-ac44-6c12363c52a4 sql=

declare @last_row int
set @last_row = -1

select @last_row = max(ds_row) from dashboard_items
where ds_user = 1
and ds_col = 2

if @last_row = -1 or @last_row is null
	set @last_row = 1
else
	set @last_row = @last_row + 1

insert into dashboard_items
(ds_user, ds_report, ds_chart_type, ds_col, ds_row)
values (1, 6, 'data', 2, @last_row)
2016-08-10 12:32:04 http://192.168.6.173/edit_dashboard.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:32:04 http://192.168.6.173/edit_dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:32:04 http://192.168.6.173/edit_dashboard.aspx sql=

select ds_id, ds_col, ds_row, ds_chart_type, rp_desc
from dashboard_items ds
inner join reports on rp_id = ds_report
where ds_user = 1
order by ds_col, ds_row
2016-08-10 12:32:04 http://192.168.6.173/edit_dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:32:06 http://192.168.6.173/dashboard.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:32:06 http://192.168.6.173/dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:32:06 http://192.168.6.173/dashboard.aspx sql=

select ds.*, rp_desc
from dashboard_items ds
inner join reports on rp_id = ds_report
where ds_user = 1
order by ds_col, ds_row
2016-08-10 12:32:06 http://192.168.6.173/dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:32:06 http://192.168.6.173/view_report.aspx?scale=2&view=pie&id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:32:06 http://192.168.6.173/view_report.aspx?scale=2&view=pie&id=1 elapsed milliseconds:0000
2016-08-10 12:32:06 http://192.168.6.173/view_report.aspx?scale=2&view=pie&id=1 sql=
select rp_desc, rp_sql, rp_chart_type
		from reports
		where rp_id = 1
2016-08-10 12:32:06 http://192.168.6.173/view_report.aspx?scale=2&view=pie&id=1 elapsed milliseconds:0000
2016-08-10 12:32:06 http://192.168.6.173/view_report.aspx?scale=2&view=pie&id=1 sql=
select st_name [status], count(1) [count] 
 from bugs 
 inner join statuses on bg_status = st_id 
 group by st_name 
 order by st_name
2016-08-10 12:32:06 http://192.168.6.173/view_report.aspx?scale=2&view=pie&id=1 elapsed milliseconds:0005
2016-08-10 12:32:06 http://192.168.6.173/view_report.aspx?view=data&id=6 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:32:06 http://192.168.6.173/view_report.aspx?view=data&id=6 elapsed milliseconds:0000
2016-08-10 12:32:06 http://192.168.6.173/view_report.aspx?view=data&id=6 sql=
select rp_desc, rp_sql, rp_chart_type
		from reports
		where rp_id = 6
2016-08-10 12:32:06 http://192.168.6.173/view_report.aspx?view=data&id=6 elapsed milliseconds:0000
2016-08-10 12:32:06 http://192.168.6.173/view_report.aspx?view=data&id=6 sql=
select bg_reported_user, count(1) [r] 
 into #t 
 from bugs 
 group by bg_reported_user; 
 select bg_assigned_to_user, count(1) [a] 
 into #t2 
 from bugs 
 group by bg_assigned_to_user; 
 select us_username, r [reported], a [assigned] 
 from users 
 left outer join #t on bg_reported_user = us_id 
 left outer join #t2 on bg_assigned_to_user = us_id 
 order by 1
2016-08-10 12:32:06 http://192.168.6.173/view_report.aspx?view=data&id=6 elapsed milliseconds:0008
2016-08-10 12:34:04 http://192.168.6.173/edit_dashboard.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:34:04 http://192.168.6.173/edit_dashboard.aspx elapsed milliseconds:0001
2016-08-10 12:34:04 http://192.168.6.173/edit_dashboard.aspx sql=

select ds_id, ds_col, ds_row, ds_chart_type, rp_desc
from dashboard_items ds
inner join reports on rp_id = ds_report
where ds_user = 1
order by ds_col, ds_row
2016-08-10 12:34:04 http://192.168.6.173/edit_dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:35:00 http://192.168.6.173/dashboard.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:35:00 http://192.168.6.173/dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:35:00 http://192.168.6.173/dashboard.aspx sql=

select ds.*, rp_desc
from dashboard_items ds
inner join reports on rp_id = ds_report
where ds_user = 1
order by ds_col, ds_row
2016-08-10 12:35:00 http://192.168.6.173/dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:35:01 http://192.168.6.173/view_report.aspx?scale=2&view=pie&id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:35:01 http://192.168.6.173/view_report.aspx?scale=2&view=pie&id=1 elapsed milliseconds:0000
2016-08-10 12:35:01 http://192.168.6.173/view_report.aspx?scale=2&view=pie&id=1 sql=
select rp_desc, rp_sql, rp_chart_type
		from reports
		where rp_id = 1
2016-08-10 12:35:01 http://192.168.6.173/view_report.aspx?scale=2&view=pie&id=1 elapsed milliseconds:0000
2016-08-10 12:35:01 http://192.168.6.173/view_report.aspx?scale=2&view=pie&id=1 sql=
select st_name [status], count(1) [count] 
 from bugs 
 inner join statuses on bg_status = st_id 
 group by st_name 
 order by st_name
2016-08-10 12:35:01 http://192.168.6.173/view_report.aspx?scale=2&view=pie&id=1 elapsed milliseconds:0000
2016-08-10 12:35:01 http://192.168.6.173/view_report.aspx?view=data&id=6 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:35:01 http://192.168.6.173/view_report.aspx?view=data&id=6 elapsed milliseconds:0000
2016-08-10 12:35:01 http://192.168.6.173/view_report.aspx?view=data&id=6 sql=
select rp_desc, rp_sql, rp_chart_type
		from reports
		where rp_id = 6
2016-08-10 12:35:01 http://192.168.6.173/view_report.aspx?view=data&id=6 elapsed milliseconds:0000
2016-08-10 12:35:01 http://192.168.6.173/view_report.aspx?view=data&id=6 sql=
select bg_reported_user, count(1) [r] 
 into #t 
 from bugs 
 group by bg_reported_user; 
 select bg_assigned_to_user, count(1) [a] 
 into #t2 
 from bugs 
 group by bg_assigned_to_user; 
 select us_username, r [reported], a [assigned] 
 from users 
 left outer join #t on bg_reported_user = us_id 
 left outer join #t2 on bg_assigned_to_user = us_id 
 order by 1
2016-08-10 12:35:01 http://192.168.6.173/view_report.aspx?view=data&id=6 elapsed milliseconds:0006
2016-08-10 12:35:02 http://192.168.6.173/edit_dashboard.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:35:02 http://192.168.6.173/edit_dashboard.aspx elapsed milliseconds:0001
2016-08-10 12:35:02 http://192.168.6.173/edit_dashboard.aspx sql=

select ds_id, ds_col, ds_row, ds_chart_type, rp_desc
from dashboard_items ds
inner join reports on rp_id = ds_report
where ds_user = 1
order by ds_col, ds_row
2016-08-10 12:35:02 http://192.168.6.173/edit_dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:35:10 http://192.168.6.173/dashboard.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:35:10 http://192.168.6.173/dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:35:10 http://192.168.6.173/dashboard.aspx sql=

select ds.*, rp_desc
from dashboard_items ds
inner join reports on rp_id = ds_report
where ds_user = 1
order by ds_col, ds_row
2016-08-10 12:35:10 http://192.168.6.173/dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:35:10 http://192.168.6.173/view_report.aspx?scale=2&view=pie&id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:35:10 http://192.168.6.173/view_report.aspx?scale=2&view=pie&id=1 elapsed milliseconds:0000
2016-08-10 12:35:10 http://192.168.6.173/view_report.aspx?scale=2&view=pie&id=1 sql=
select rp_desc, rp_sql, rp_chart_type
		from reports
		where rp_id = 1
2016-08-10 12:35:10 http://192.168.6.173/view_report.aspx?scale=2&view=pie&id=1 elapsed milliseconds:0000
2016-08-10 12:35:10 http://192.168.6.173/view_report.aspx?scale=2&view=pie&id=1 sql=
select st_name [status], count(1) [count] 
 from bugs 
 inner join statuses on bg_status = st_id 
 group by st_name 
 order by st_name
2016-08-10 12:35:10 http://192.168.6.173/view_report.aspx?scale=2&view=pie&id=1 elapsed milliseconds:0000
2016-08-10 12:35:11 http://192.168.6.173/view_report.aspx?view=data&id=6 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:35:11 http://192.168.6.173/view_report.aspx?view=data&id=6 elapsed milliseconds:0000
2016-08-10 12:35:11 http://192.168.6.173/view_report.aspx?view=data&id=6 sql=
select rp_desc, rp_sql, rp_chart_type
		from reports
		where rp_id = 6
2016-08-10 12:35:11 http://192.168.6.173/view_report.aspx?view=data&id=6 elapsed milliseconds:0000
2016-08-10 12:35:11 http://192.168.6.173/view_report.aspx?view=data&id=6 sql=
select bg_reported_user, count(1) [r] 
 into #t 
 from bugs 
 group by bg_reported_user; 
 select bg_assigned_to_user, count(1) [a] 
 into #t2 
 from bugs 
 group by bg_assigned_to_user; 
 select us_username, r [reported], a [assigned] 
 from users 
 left outer join #t on bg_reported_user = us_id 
 left outer join #t2 on bg_assigned_to_user = us_id 
 order by 1
2016-08-10 12:35:11 http://192.168.6.173/view_report.aspx?view=data&id=6 elapsed milliseconds:0008
2016-08-10 12:35:29 http://192.168.6.173/edit_dashboard.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:35:29 http://192.168.6.173/edit_dashboard.aspx elapsed milliseconds:0001
2016-08-10 12:35:29 http://192.168.6.173/edit_dashboard.aspx sql=

select ds_id, ds_col, ds_row, ds_chart_type, rp_desc
from dashboard_items ds
inner join reports on rp_id = ds_report
where ds_user = 1
order by ds_col, ds_row
2016-08-10 12:35:29 http://192.168.6.173/edit_dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:35:29 http://192.168.6.173/dashboard.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:35:29 http://192.168.6.173/dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:35:29 http://192.168.6.173/dashboard.aspx sql=

select ds.*, rp_desc
from dashboard_items ds
inner join reports on rp_id = ds_report
where ds_user = 1
order by ds_col, ds_row
2016-08-10 12:35:29 http://192.168.6.173/dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:35:29 http://192.168.6.173/view_report.aspx?scale=2&view=pie&id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:35:29 http://192.168.6.173/view_report.aspx?scale=2&view=pie&id=1 elapsed milliseconds:0000
2016-08-10 12:35:29 http://192.168.6.173/view_report.aspx?scale=2&view=pie&id=1 sql=
select rp_desc, rp_sql, rp_chart_type
		from reports
		where rp_id = 1
2016-08-10 12:35:29 http://192.168.6.173/view_report.aspx?scale=2&view=pie&id=1 elapsed milliseconds:0000
2016-08-10 12:35:29 http://192.168.6.173/view_report.aspx?scale=2&view=pie&id=1 sql=
select st_name [status], count(1) [count] 
 from bugs 
 inner join statuses on bg_status = st_id 
 group by st_name 
 order by st_name
2016-08-10 12:35:29 http://192.168.6.173/view_report.aspx?scale=2&view=pie&id=1 elapsed milliseconds:0001
2016-08-10 12:35:30 http://192.168.6.173/edit_dashboard.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:35:30 http://192.168.6.173/edit_dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:35:30 http://192.168.6.173/edit_dashboard.aspx sql=

select ds_id, ds_col, ds_row, ds_chart_type, rp_desc
from dashboard_items ds
inner join reports on rp_id = ds_report
where ds_user = 1
order by ds_col, ds_row
2016-08-10 12:35:30 http://192.168.6.173/edit_dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:35:30 http://192.168.6.173/view_report.aspx?view=data&id=6 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:35:30 http://192.168.6.173/view_report.aspx?view=data&id=6 elapsed milliseconds:0000
2016-08-10 12:35:30 http://192.168.6.173/view_report.aspx?view=data&id=6 sql=
select rp_desc, rp_sql, rp_chart_type
		from reports
		where rp_id = 6
2016-08-10 12:35:30 http://192.168.6.173/view_report.aspx?view=data&id=6 elapsed milliseconds:0000
2016-08-10 12:35:30 http://192.168.6.173/view_report.aspx?view=data&id=6 sql=
select bg_reported_user, count(1) [r] 
 into #t 
 from bugs 
 group by bg_reported_user; 
 select bg_assigned_to_user, count(1) [a] 
 into #t2 
 from bugs 
 group by bg_assigned_to_user; 
 select us_username, r [reported], a [assigned] 
 from users 
 left outer join #t on bg_reported_user = us_id 
 left outer join #t2 on bg_assigned_to_user = us_id 
 order by 1
2016-08-10 12:35:30 http://192.168.6.173/view_report.aspx?view=data&id=6 elapsed milliseconds:0006
2016-08-10 12:35:31 http://192.168.6.173/dashboard.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:35:32 http://192.168.6.173/dashboard.aspx elapsed milliseconds:1005
2016-08-10 12:35:32 http://192.168.6.173/dashboard.aspx sql=

select ds.*, rp_desc
from dashboard_items ds
inner join reports on rp_id = ds_report
where ds_user = 1
order by ds_col, ds_row
2016-08-10 12:35:32 http://192.168.6.173/dashboard.aspx elapsed milliseconds:0000
2016-08-10 12:35:32 http://192.168.6.173/view_report.aspx?scale=2&view=pie&id=1 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:35:32 http://192.168.6.173/view_report.aspx?scale=2&view=pie&id=1 elapsed milliseconds:0000
2016-08-10 12:35:32 http://192.168.6.173/view_report.aspx?scale=2&view=pie&id=1 sql=
select rp_desc, rp_sql, rp_chart_type
		from reports
		where rp_id = 1
2016-08-10 12:35:32 http://192.168.6.173/view_report.aspx?scale=2&view=pie&id=1 elapsed milliseconds:0000
2016-08-10 12:35:32 http://192.168.6.173/view_report.aspx?scale=2&view=pie&id=1 sql=
select st_name [status], count(1) [count] 
 from bugs 
 inner join statuses on bg_status = st_id 
 group by st_name 
 order by st_name
2016-08-10 12:35:32 http://192.168.6.173/view_report.aspx?scale=2&view=pie&id=1 elapsed milliseconds:0000
2016-08-10 12:35:32 http://192.168.6.173/view_report.aspx?view=data&id=6 sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:35:32 http://192.168.6.173/view_report.aspx?view=data&id=6 elapsed milliseconds:0000
2016-08-10 12:35:32 http://192.168.6.173/view_report.aspx?view=data&id=6 sql=
select rp_desc, rp_sql, rp_chart_type
		from reports
		where rp_id = 6
2016-08-10 12:35:32 http://192.168.6.173/view_report.aspx?view=data&id=6 elapsed milliseconds:0000
2016-08-10 12:35:32 http://192.168.6.173/view_report.aspx?view=data&id=6 sql=
select bg_reported_user, count(1) [r] 
 into #t 
 from bugs 
 group by bg_reported_user; 
 select bg_assigned_to_user, count(1) [a] 
 into #t2 
 from bugs 
 group by bg_assigned_to_user; 
 select us_username, r [reported], a [assigned] 
 from users 
 left outer join #t on bg_reported_user = us_id 
 left outer join #t2 on bg_assigned_to_user = us_id 
 order by 1
2016-08-10 12:35:32 http://192.168.6.173/view_report.aspx?view=data&id=6 elapsed milliseconds:0005
2016-08-10 12:35:40 http://192.168.6.173/admin.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:35:40 http://192.168.6.173/admin.aspx elapsed milliseconds:0001
2016-08-10 12:35:40 http://192.168.6.173/admin.aspx sql=
select count(1) from bugs
2016-08-10 12:35:43 http://192.168.6.173/reports.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:35:43 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 12:35:43 http://192.168.6.173/reports.aspx sql=

select
rp_desc [отчет],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>круговая</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>график</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>столбцы</a>'
	else
		'&nbsp;' end [вид<br>диаграммы],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>данные</a>' [просмотр<br>данных]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>edit</a>' [редактировать], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>delete</a>' [удалить] 
from reports order by rp_desc
2016-08-10 12:35:43 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 12:35:44 http://192.168.6.173/queries.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:35:44 http://192.168.6.173/queries.aspx elapsed milliseconds:0000
2016-08-10 12:35:44 http://192.168.6.173/queries.aspx sql=
select
			qu_desc [запрос],
			case
				when isnull(qu_user,0) = 0 and isnull(qu_org,0) is null then 'everybody'
				when isnull(qu_user,0) <> 0 then 'user:' + us_username
				when isnull(qu_org,0) <> 0 then 'org:' + og_name
				else ' '
				end [видимость],
			'<a href=bugs.aspx?qu_id=' + convert(varchar,qu_id) + '>view list</a>' [посмотреть список],
			'<a target=_blank href=print_bugs.aspx?qu_id=' + convert(varchar,qu_id) + '>print list</a>' [печать списка],
			'<a target=_blank href=print_bugs.aspx?format=excel&qu_id=' + convert(varchar,qu_id) + '>export as excel</a>' [экспорт в excel],
			'<a target=_blank href=print_bugs2.aspx?qu_id=' + convert(varchar,qu_id) + '>print detail</a>' [печать списка<br> с детализацией],
			'<a href=edit_query.aspx?id=' + convert(varchar,qu_id) + '>edit</a>' [редактировать],
			'<a href=delete_query.aspx?id=' + convert(varchar,qu_id) + '>delete</a>' [удалить],
			replace(convert(nvarchar(4000),qu_sql), char(10),'<br>') [sql]
			from queries
			left outer join users on qu_user = us_id
			left outer join orgs on qu_org = og_id
			where 1 = 0 /* all */
			or isnull(qu_user,0) = 1
			or isnull(qu_user,0) = 0
			order by qu_desc
2016-08-10 12:35:44 http://192.168.6.173/queries.aspx elapsed milliseconds:0001
2016-08-10 12:36:00 http://192.168.6.173/reports.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:36:00 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 12:36:00 http://192.168.6.173/reports.aspx sql=

select
rp_desc [отчет],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>круговая</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>график</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>столбцы</a>'
	else
		'&nbsp;' end [вид<br>диаграммы],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>данные</a>' [просмотр<br>данных]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>edit</a>' [редактировать], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>delete</a>' [удалить] 
from reports order by rp_desc
2016-08-10 12:36:00 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 12:42:33 http://192.168.6.173/reports.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:42:33 http://192.168.6.173/reports.aspx elapsed milliseconds:0000
2016-08-10 12:42:33 http://192.168.6.173/reports.aspx sql=

select
rp_desc [отчет],
case
	when rp_chart_type = 'pie' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>круговая</a>'
	when rp_chart_type = 'line' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>график</a>'
	when rp_chart_type = 'bar' then
		'<a target=''_blank'' href=''view_report.aspx?view=chart&id=' + convert(varchar, rp_id) + '''>столбцы</a>'
	else
		'&nbsp;' end [вид<br>диаграммы],
'<a target=''_blank'' href=''view_report.aspx?view=data&id=' + convert(varchar, rp_id) + '''>данные</a>' [просмотр<br>данных]
, '<a href=''edit_report.aspx?id=' + convert(varchar, rp_id) + '''>редактировать</a>' [редактировать], '<a href=''delete_report.aspx?id=' + convert(varchar, rp_id) + '''>удалить</a>' [удалить] 
from reports order by rp_desc
2016-08-10 12:42:33 http://192.168.6.173/reports.aspx elapsed milliseconds:0002
2016-08-10 12:42:36 http://192.168.6.173/queries.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:42:36 http://192.168.6.173/queries.aspx elapsed milliseconds:0000
2016-08-10 12:42:36 http://192.168.6.173/queries.aspx sql=
select
			qu_desc [запрос],
			case
				when isnull(qu_user,0) = 0 and isnull(qu_org,0) is null then 'everybody'
				when isnull(qu_user,0) <> 0 then 'user:' + us_username
				when isnull(qu_org,0) <> 0 then 'org:' + og_name
				else ' '
				end [видимость],
			'<a href=bugs.aspx?qu_id=' + convert(varchar,qu_id) + '>посмотреть список</a>' [посмотреть список],
			'<a target=_blank href=print_bugs.aspx?qu_id=' + convert(varchar,qu_id) + '>печать списка</a>' [печать списка],
			'<a target=_blank href=print_bugs.aspx?format=excel&qu_id=' + convert(varchar,qu_id) + '>экспорт в excel</a>' [экспорт в excel],
			'<a target=_blank href=print_bugs2.aspx?qu_id=' + convert(varchar,qu_id) + '>печать детализации</a>' [печать списка<br> с детализацией],
			'<a href=edit_query.aspx?id=' + convert(varchar,qu_id) + '>редактировать</a>' [редактировать],
			'<a href=delete_query.aspx?id=' + convert(varchar,qu_id) + '>удалить</a>' [удалить],
			replace(convert(nvarchar(4000),qu_sql), char(10),'<br>') [sql]
			from queries
			left outer join users on qu_user = us_id
			left outer join orgs on qu_org = og_id
			where 1 = 0 /* all */
			or isnull(qu_user,0) = 1
			or isnull(qu_user,0) = 0
			order by qu_desc
2016-08-10 12:42:36 http://192.168.6.173/queries.aspx elapsed milliseconds:0007
2016-08-10 12:42:40 http://192.168.6.173/search.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:42:40 http://192.168.6.173/search.aspx elapsed milliseconds:0000
2016-08-10 12:42:40 http://192.168.6.173/search.aspx sql=

/* get related users 2 */
select  pj_id, us_id,
case when 0 = 1 then
    case when len(isnull(us_firstname,'') + ' ' + isnull(us_lastname,'')) > 1
	then isnull(us_firstname,'') + ' ' + isnull(us_lastname,'')
    else us_username end
else us_username end us_username,
isnull(us_email,'') us_email
into #temp
from projects, users
where pj_id not in
(
	select pu_project from project_user_xref
	where pu_permission_level = 0 and pu_user = 1
)





if 0 = 1 -- external
and 2 = 0 -- other orgs
begin
	select distinct a.us_id, a.us_username, a.us_email
	from #temp a
	inner join users b on a.us_id = b.us_id
	inner join orgs on b.us_org = og_id
	where og_external_user = 0 or b.us_org = 6
	order by a.us_username
end
else
begin

	select distinct us_id, us_username, us_email
		from #temp
		left outer join project_user_xref on pj_id = pu_project
		and us_id = pu_user
		where isnull(pu_permission_level,2) <> 0
		order by us_username
end

drop table #temp
2016-08-10 12:42:40 http://192.168.6.173/search.aspx elapsed milliseconds:0013
2016-08-10 12:42:40 http://192.168.6.173/search.aspx sql=
/* drop downs */ select pj_id, pj_name from projects order by pj_name; select og_id, og_name from orgs order by og_name;
	select ct_id, ct_name from categories order by ct_sort_seq, ct_name;
	select pr_id, pr_name from priorities order by pr_sort_seq, pr_name;
	select st_id, st_name from statuses order by st_sort_seq, st_name;
	select udf_id, udf_name from user_defined_attribute order by udf_sort_seq, udf_name
2016-08-10 12:42:40 http://192.168.6.173/search.aspx elapsed milliseconds:0000
2016-08-10 12:42:40 http://192.168.6.173/search.aspx sql=

select count(1)
from projects
where isnull(pj_enable_custom_dropdown1,0) = 1
or isnull(pj_enable_custom_dropdown2,0) = 1
or isnull(pj_enable_custom_dropdown3,0) = 1
2016-08-10 12:42:43 http://192.168.6.173/bugs.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:42:43 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 12:42:43 http://192.168.6.173/bugs.aspx sql=
/* query dropdown */
select qu_id, qu_desc
from queries
where (isnull(qu_user,0) = 0 and isnull(qu_org,0) = 0)
or isnull(qu_user,0) = 1
or isnull(qu_org,0) = 6
order by qu_desc
2016-08-10 12:42:43 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 12:42:43 http://192.168.6.173/bugs.aspx sql=
select qu_id, qu_sql from queries where qu_id in
			(select us_default_query from users where us_id = 1)
2016-08-10 12:42:43 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 12:42:43 http://192.168.6.173/bugs.aspx sql=
select isnull(pr_background_color,'#ffffff'), bg_id [id], isnull(bu_flag,0) [$FLAG], 
 bg_short_desc [desc], isnull(pj_name,'') [project], isnull(og_name,'') [organization], isnull(ct_name,'') [category], rpt.us_username [reported by],
 bg_reported_date [reported on], isnull(pr_name,'') [priority], isnull(asg.us_username,'') [assigned to],
 isnull(st_name,'') [status], isnull(lu.us_username,'') [last updated by], bg_last_updated_date [last updated on]
 from bugs 
 left outer join bug_user on bu_bug = bg_id and bu_user = 1 
 left outer join users rpt on rpt.us_id = bg_reported_user
 left outer join users asg on asg.us_id = bg_assigned_to_user
 left outer join users lu on lu.us_id = bg_last_updated_user
 left outer join projects on pj_id = bg_project
 left outer join orgs on og_id = bg_org
 left outer join categories on ct_id = bg_category
 left outer join priorities on pr_id = bg_priority
 left outer join statuses on st_id = bg_status
  /* altered - just order by  */ WHERE  (bugs.bg_project not in (
					select pu_project
					from project_user_xref
					where pu_user = 1
					and pu_permission_level = 0)) order by bg_id desc
2016-08-10 12:42:43 http://192.168.6.173/bugs.aspx elapsed milliseconds:0000
2016-08-10 12:42:48 http://192.168.6.173/edit_self.aspx sql=

/* check session */
declare @project_admin int
select @project_admin = count(1)
	from sessions
	inner join project_user_xref on pu_user = se_user
	and pu_admin = 1
	where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4';

select us_id, us_admin,
us_username, us_firstname, us_lastname,
isnull(us_email,'') us_email,
isnull(us_bugs_per_page,10) us_bugs_per_page,
isnull(us_forced_project,0) us_forced_project,
us_use_fckeditor,
us_enable_bug_list_popups,
og.*,
isnull(us_forced_project, 0 ) us_forced_project,
isnull(pu_permission_level, 2) pu_permission_level,
@project_admin [project_admin]
from sessions
inner join users on se_user = us_id
inner join orgs og on us_org = og_id
left outer join project_user_xref
	on pu_project = us_forced_project
	and pu_user = us_id
where se_id = '443fdfb6-9fbb-407b-ac44-6c12363c52a4'
and us_active = 1
2016-08-10 12:42:48 http://192.168.6.173/edit_self.aspx elapsed milliseconds:0000
2016-08-10 12:42:48 http://192.168.6.173/edit_self.aspx sql=
declare @org int
			select @org = us_org from users where us_id = 1

			select qu_id, qu_desc
			from queries
			where (isnull(qu_user,0) = 0 and isnull(qu_org,0) = 0)
			or isnull(qu_user,0) = 1
			or isnull(qu_org,0) = @org
			order by qu_desc
2016-08-10 12:42:48 http://192.168.6.173/edit_self.aspx elapsed milliseconds:0000
2016-08-10 12:42:48 http://192.168.6.173/edit_self.aspx sql=
select pj_id, pj_name, isnull(pu_auto_subscribe,0) [pu_auto_subscribe]
			from projects
			left outer join project_user_xref on pj_id = pu_project and 1 = pu_user
			where isnull(pu_permission_level,2) <> 0
			order by pj_name
2016-08-10 12:42:48 http://192.168.6.173/edit_self.aspx elapsed milliseconds:0000
2016-08-10 12:42:48 http://192.168.6.173/edit_self.aspx sql=
select
			us_username [username],
			isnull(us_firstname,'') [firstname],
			isnull(us_lastname,'') [lastname],
			isnull(us_bugs_per_page,10) [us_bugs_per_page],
			us_use_fckeditor,
			us_enable_bug_list_popups,
			isnull(us_email,'') [email],
			us_enable_notifications,
			us_send_notifications_to_self,
            us_reported_notifications,
            us_assigned_notifications,
            us_subscribed_notifications,
			us_auto_subscribe,
			us_auto_subscribe_own_bugs,
			us_auto_subscribe_reported_bugs,
			us_default_query,
			isnull(us_signature,'') [signature]
			from users
			where us_id = 1
2016-08-10 12:42:48 http://192.168.6.173/edit_self.aspx elapsed milliseconds:0000
2016-08-10 12:43:40 http://192.168.6.173/logoff.aspx sql=
delete from sessions
			where se_id = N'443fdfb6-9fbb-407b-ac44-6c12363c52a4'
			or datediff(d, se_date, getdate()) > 2
2016-08-10 12:43:40 http://192.168.6.173/default.aspx?msg=logged+off sql=
select count(1) from users
2016-08-10 12:44:43 http://192.168.6.173/default.aspx?msg=logged+off sql=
select count(1) from users
